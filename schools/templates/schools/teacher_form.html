{% extends 'schools/base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block extra_css %}
<style>
.page-header {
    background: linear-gradient(135deg, #6B73FF 0%, #000DFF 100%);
    padding: 2rem 0;
    margin-bottom: 2rem;
    color: white;
    border-radius: 0 0 20px 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.form-section {
    background: white;
    border-radius: 15px;
    box-shadow: 0 2px 15px rgba(0,0,0,0.05);
    margin-bottom: 2rem;
}

.section-header {
    padding: 1.5rem;
    border-bottom: 1px solid #e0e6ff;
    display: flex;
    align-items: center;
}

.section-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    font-size: 1.2rem;
}

.personal-icon {
    background: linear-gradient(135deg, #FF6B6B 0%, #FF2D2D 100%);
    color: white;
}

.professional-icon {
    background: linear-gradient(135deg, #36D1DC 0%, #5B86E5 100%);
    color: white;
}

.section-body {
    padding: 1.5rem;
}

.profile-upload {
    position: relative;
    width: 150px;
    height: 150px;
    margin: 0 auto;
}

.profile-image {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 4px solid white;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    overflow: hidden;
    background: white;
    transition: all 0.3s ease;
}

.profile-image:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.upload-btn {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background: #4e73df;
    color: white;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(78,115,223,0.3);
}

.upload-btn:hover {
    transform: scale(1.1);
    background: #2e59d9;
}

.form-control, .form-select {
    border: 2px solid #e0e6ff;
    border-radius: 10px;
    padding: 0.8rem 1rem;
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    border-color: #4e73df;
    box-shadow: 0 0 0 0.2rem rgba(78,115,223,0.15);
}

.form-label {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.class-teacher-section {
    background: linear-gradient(to right, #f8f9fc, #f1f4ff);
    border: 2px solid #e0e6ff !important;
    transition: all 0.3s ease;
}

.class-teacher-section:hover {
    border-color: #4e73df !important;
    box-shadow: 0 5px 15px rgba(78,115,223,0.1);
}

.form-switch .form-check-input {
    width: 3em;
    height: 1.5em;
}

.form-switch .form-check-input:checked {
    background-color: #4e73df;
    border-color: #4e73df;
}

.btn-submit {
    padding: 0.8rem 2rem;
    font-weight: 600;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(78,115,223,0.2);
}

.assigned-class-section {
    padding-left: 3rem;
    margin-top: 1rem;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="page-header">
        <div class="container-fluid">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-2">
                    <li class="breadcrumb-item"><a href="{% url 'dashboard' %}" class="text-white">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'teacher_list' %}" class="text-white">Teachers</a></li>
                    <li class="breadcrumb-item active text-white-50" aria-current="page">{{ title }}</li>
                </ol>
            </nav>
            <h2 class="mb-0">{{ title }}</h2>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-10">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                
                <!-- Profile Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon personal-icon">
                            <i class="bi bi-person"></i>
                        </div>
                        <h5 class="mb-0">Personal Information</h5>
                    </div>
                    <div class="section-body">
                        <div class="row align-items-center">
                            <div class="col-md-4 text-center">
                                <div class="profile-upload">
                                    <div class="profile-image">
                                        {% if teacher.profile_picture %}
                                            <img src="{{ teacher.profile_picture.url }}" 
                                                 id="profile-preview"
                                                 alt="Profile Picture"
                                                 style="width: 100%; height: 100%; object-fit: cover;">
                                        {% else %}
                                            <div id="profile-preview" class="d-flex align-items-center justify-content-center h-100">
                                                <i class="bi bi-person display-4 text-muted"></i>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <label class="upload-btn">
                                        <i class="bi bi-camera"></i>
                                        {{ form.profile_picture|add_class:"d-none" }}
                                    </label>
                                </div>
                                <p class="text-muted small mt-2">Click the camera icon to change photo</p>
                            </div>
                            
                            <!-- Personal Information -->
                            <div class="col-md-8">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">First Name</label>
                                        {{ form.first_name|add_class:"form-control" }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Last Name</label>
                                        {{ form.last_name|add_class:"form-control" }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">TSC Number</label>
                                        {{ form.tsc_number|add_class:"form-control" }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">National ID</label>
                                        {{ form.national_id|add_class:"form-control" }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Email</label>
                                        {{ form.email|add_class:"form-control" }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Phone</label>
                                        {{ form.phone|add_class:"form-control" }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Date of Birth</label>
                                        {{ form.date_of_birth|add_class:"form-control" }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Gender</label>
                                        {{ form.gender|add_class:"form-select" }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Religion</label>
                                        {{ form.religion|add_class:"form-select" }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Marital Status</label>
                                        {{ form.marital_status|add_class:"form-select" }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Location</label>
                                        {{ form.location|add_class:"form-select" }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Nationality</label>
                                        {{ form.nationality|add_class:"form-control" }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Login Credentials -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon" style="background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);">
                            <i class="bi bi-key"></i>
                        </div>
                        <h5 class="mb-0">Login Credentials</h5>
                    </div>
                    <div class="section-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Password</label>
                                {{ form.password1|add_class:"form-control" }}
                                {% if form.password1.errors %}
                                    <div class="invalid-feedback d-block">{{ form.password1.errors.0 }}</div>
                                {% endif %}
                                <small class="text-muted">Password must be at least 8 characters long</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Confirm Password</label>
                                {{ form.password2|add_class:"form-control" }}
                                {% if form.password2.errors %}
                                    <div class="invalid-feedback d-block">{{ form.password2.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle me-2"></i>
                                    The teacher will use their email address as username and this password to login
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Professional Information -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon professional-icon">
                            <i class="bi bi-briefcase"></i>
                        </div>
                        <h5 class="mb-0">Professional Information</h5>
                    </div>
                    <div class="section-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Grade</label>
                                {{ form.grade|add_class:"form-select" }}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Years of Experience</label>
                                {{ form.years_of_experience|add_class:"form-control" }}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Highest Qualification</label>
                                {{ form.qualifications|add_class:"form-select" }}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Certificate</label>
                                <div class="custom-file">
                                    {{ form.certificate|add_class:"form-control" }}
                                    <small class="text-muted">Upload PDF or image of your highest qualification certificate</small>
                                    {% if form.certificate.errors %}
                                        <div class="invalid-feedback">{{ form.certificate.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Monthly Salary</label>
                                {{ form.basic_salary }}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Status</label>
                                {{ form.status|add_class:"form-select" }}
                            </div>
                            <div class="col-12">
                                <label class="form-label">Teaching Subjects</label>
                                {{ form.subjects|add_class:"form-select" }}
                                <small class="text-muted">Hold Ctrl/Cmd to select multiple subjects</small>
                            </div>
                            <div class="col-12">
                                <div class="class-teacher-section p-4 rounded-3">
                                    <div class="d-flex align-items-center">
                                        <div class="form-check form-switch">
                                            {{ form.is_class_teacher|add_class:"form-check-input" }}
                                            <label class="form-check-label ms-2" for="{{ form.is_class_teacher.id_for_label }}">
                                                <span class="fw-bold">Class Teacher</span>
                                                <small class="d-block text-muted">Designate this teacher as a class teacher</small>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="assigned-class-section mt-3" id="assignedClassSection" style="display: none;">
                                        <label class="form-label">Assigned Grade</label>
                                        {{ form.grade|add_class:"form-select" }}
                                        {% if form.grade.errors %}
                                            <div class="invalid-feedback">{{ form.grade.errors }}</div>
                                        {% endif %}
                                        <small class="text-muted">Select the grade this teacher will be in charge of</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="d-flex justify-content-end gap-3 mb-4">
                    <a href="{% url 'teacher_list' %}" class="btn btn-light btn-lg px-4">
                        <i class="bi bi-x me-2"></i>Cancel
                    </a>
                    <button type="submit" class="btn btn-primary btn-lg btn-submit px-4">
                        <i class="bi bi-check2 me-2"></i>Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="{% static 'js/teacher-form.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const classTeacherSwitch = document.getElementById('{{ form.is_class_teacher.id_for_label }}');
    const assignedClassSection = document.getElementById('assignedClassSection');

    function toggleAssignedClass() {
        assignedClassSection.style.display = classTeacherSwitch.checked ? 'block' : 'none';
    }

    // Initial state
    toggleAssignedClass();

    // Listen for changes
    classTeacherSwitch.addEventListener('change', toggleAssignedClass);
});
</script>
{% endblock %}
{% endblock %}
{% extends 'schools/base.html' %}
{% load static %}
{% load humanize %}
{% load school_filters %}

{% block title %}Dashboard - Bishop Dr Mando International School{% endblock %}

{% block content %}
<div class="mobile-app-container">
<script>
document.addEventListener('DOMContentLoaded', function() {
    function refreshRecentActivities() {
        fetch(window.location.href)
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Update recent students
                const studentsTable = document.querySelector('#recent-students tbody');
                const newStudentsTable = doc.querySelector('#recent-students tbody');
                if (studentsTable && newStudentsTable) {
                    studentsTable.innerHTML = newStudentsTable.innerHTML;
                }
                
                // Update recent payments
                const paymentsList = document.querySelector('#recent-payments');
                const newPaymentsList = doc.querySelector('#recent-payments');
                if (paymentsList && newPaymentsList) {
                    paymentsList.innerHTML = newPaymentsList.innerHTML;
                }
            });
    }

    // Refresh every 30 seconds
    setInterval(refreshRecentActivities, 30000);
});
</script>

    <!-- Modern Header with Gradient -->
    <div class="header-section bg-gradient-primary-to-secondary py-4 py-md-5 mb-3 mb-md-4">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-lg-7">
                <div class="d-flex align-items-center">
                    <div class="school-logo me-4">
                        <img src="{% static 'images/logo.png' %}" alt="Bishop Dr Mando International School" class="logo-img">
                    </div>
                    <div>
                        <h1 class="display-5 fw-bold text-white mb-2">Bishop Dr Mando International School</h1>
                        <p class="lead text-white-50 mb-0">
                            Academic Year {{ today|date:"Y" }} • Term {{ current_term }}
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-lg-5 text-lg-end mt-4 mt-lg-0">
                <div class="d-inline-flex align-items-center bg-white bg-opacity-10 rounded-pill px-4 py-3">
                    <i class="bi bi-calendar3 text-white fs-5 me-2"></i>
                    <span class="text-white fs-5">{{ today|date:"l, F j, Y" }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid px-3 px-md-4">
    <!-- Row 1: Student & Staff Overview -->
    <div class="row g-2 g-md-3 mb-3">
        <!-- Total Students (Combined) -->
        <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
            <div class="dashboard-card-compact dashboard-card-primary">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <div class="dashboard-icon-compact dashboard-icon-primary">
                            <i class="bi bi-mortarboard-fill"></i>
                        </div>
                                {% if new_students > 0 %}
                        <span class="dashboard-badge-compact dashboard-badge-success">
                            +{{ new_students }}
                                </span>
                                {% endif %}
                            </div>
                    <div class="mb-2">
                        <p class="dashboard-label-compact">Total Students</p>
                        <h3 class="dashboard-value-compact dashboard-value-primary">{{ total_students }}</h3>
                    </div>
                    <div class="dashboard-footer-compact">
                        <i class="bi bi-people-fill me-1"></i>
                        <span>Main + Annex</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main School Students -->
        <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
            <div class="dashboard-card-compact dashboard-card-danger">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <div class="dashboard-icon-compact dashboard-icon-danger">
                            <i class="bi bi-building"></i>
                        </div>
                        </div>
                    <div class="mb-2">
                        <p class="dashboard-label-compact">Main School</p>
                        <h3 class="dashboard-value-compact dashboard-value-danger">{{ main_school_students }}</h3>
                    </div>
                    <div class="dashboard-footer-compact">
                        <i class="bi bi-people-fill me-1"></i>
                        <span>Main campus</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Annex School Students -->
        <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
            <div class="dashboard-card-compact dashboard-card-success">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <div class="dashboard-icon-compact dashboard-icon-success">
                            <i class="bi bi-building-fill-check"></i>
                        </div>
                        </div>
                    <div class="mb-2">
                        <p class="dashboard-label-compact">Annex School</p>
                        <h3 class="dashboard-value-compact dashboard-value-success">{{ annex_school_students }}</h3>
                    </div>
                    <div class="dashboard-footer-compact">
                        <i class="bi bi-people-fill me-1"></i>
                        <span>Annex campus</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teaching Staff -->
        <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
            <div class="dashboard-card-compact dashboard-card-teal">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <div class="dashboard-icon-compact dashboard-icon-teal">
                            <i class="bi bi-person-video3"></i>
                        </div>
                        <span class="dashboard-badge-compact dashboard-badge-teal">
                            {{ active_teachers }}
                                </span>
                            </div>
                    <div class="mb-2">
                        <p class="dashboard-label-compact">Teaching Staff</p>
                        <h3 class="dashboard-value-compact dashboard-value-teal">{{ total_teachers }}</h3>
                    </div>
                    <div class="dashboard-footer-compact">
                        <i class="bi bi-person-badge me-1"></i>
                        <span>Faculty</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Row 2: Attendance, Finance & Transport -->
    <div class="row g-2 g-md-3 mb-3">
        <!-- Today's Attendance -->
        <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
            <div class="dashboard-card-compact dashboard-card-info">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <div class="dashboard-icon-compact dashboard-icon-info">
                            <i class="bi bi-calendar2-check"></i>
                        </div>
                        <span class="dashboard-badge-compact {% if attendance_rate >= 90 %}dashboard-badge-success{% elif attendance_rate >= 75 %}dashboard-badge-warning{% else %}dashboard-badge-danger{% endif %}">
                            {{ present_today }}/{{ total_students }}
                        </span>
                        </div>
                    <div class="mb-2">
                        <p class="dashboard-label-compact">Attendance</p>
                        <h3 class="dashboard-value-compact {% if attendance_rate >= 90 %}dashboard-value-success{% elif attendance_rate >= 75 %}dashboard-value-warning{% else %}dashboard-value-danger{% endif %}">
                            {{ attendance_rate|floatformat:1 }}%
                        </h3>
                    </div>
                    <div class="mt-2">
                        <div class="dashboard-progress-compact">
                            <div class="dashboard-progress-bar-compact {% if attendance_rate >= 90 %}dashboard-progress-success{% elif attendance_rate >= 75 %}dashboard-progress-warning{% else %}dashboard-progress-danger{% endif %}"
                                 style="width: {{ attendance_rate }}%"></div>
                            </div>
                        </div>
                            </div>
                        </div>
                    </div>

        <!-- Term Collection -->
        <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
            <div class="dashboard-card-compact dashboard-card-warning">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <div class="dashboard-icon-compact dashboard-icon-warning">
                            <i class="bi bi-cash-stack"></i>
                        </div>
                        <span class="dashboard-badge-compact dashboard-badge-primary">
                            {{ fees_percent|floatformat:1 }}%
                        </span>
                        </div>
                    <div class="mb-2">
                        <p class="dashboard-label-compact">Term Collection</p>
                        <h3 class="dashboard-value-compact dashboard-value-warning">{{ fees_percent|floatformat:1 }}%</h3>
                    </div>
                    <div class="dashboard-footer-compact">
                        <i class="bi bi-currency-exchange me-1"></i>
                        <span>KES {{ total_collected|intcomma }}</span>
                            </div>
                        </div>
                    </div>
                </div>

        <!-- Transport Card -->
        <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
            <div class="dashboard-card-compact dashboard-card-purple">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <div class="dashboard-icon-compact dashboard-icon-purple">
                            <i class="bi bi-bus-front"></i>
            </div>
                        <span class="dashboard-badge-compact dashboard-badge-purple">{{ total_transport_students }}</span>
        </div>
                    <div class="mb-2">
                        <p class="dashboard-label-compact">Transport</p>
                        <h3 class="dashboard-value-compact dashboard-value-purple">{{ total_transport_students }}</h3>
                        </div>
                    <div class="d-flex justify-content-between align-items-center mb-2" style="font-size: 0.7rem;">
                        <span class="text-muted">V: {{ active_vehicles }}/{{ total_vehicles }}</span>
                        <span class="text-muted">R: {{ total_routes }}</span>
                            </div>
                            <div class="mb-2">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <small class="text-muted" style="font-size: 0.6rem;">Capacity</small>
                            <small class="fw-bold text-purple" style="font-size: 0.65rem;">{{ capacity_percentage|floatformat:0 }}%</small>
                        </div>
                        <div class="dashboard-progress-compact">
                            <div class="dashboard-progress-bar-compact dashboard-progress-purple" style="width: {{ capacity_percentage }}%"></div>
                    </div>
                </div>
                    <div class="dashboard-footer-compact">
                        <i class="bi bi-cash-coin text-success me-1"></i>
                        <span style="font-size: 0.7rem;">KES {{ transport_revenue|intcomma }}</span>
            </div>
                </div>
                                </div>
                                </div>

        <!-- Outstanding Fees -->
        <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
            <div class="dashboard-card-compact dashboard-card-danger">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <div class="dashboard-icon-compact dashboard-icon-danger">
                            <i class="bi bi-exclamation-triangle"></i>
                            </div>
                        <span class="dashboard-badge-compact dashboard-badge-danger">{{ fee_stats.students_with_balance }}</span>
                            </div>
                    <div class="mb-2">
                        <p class="dashboard-label-compact">Outstanding Fees</p>
                        <h3 class="dashboard-value-compact dashboard-value-danger" style="font-size: 1.3rem; line-height: 1.2;">KES {{ fees_balance|intcomma }}</h3>
                        </div>
                    <div class="dashboard-footer-compact">
                        <i class="bi bi-people-fill me-1"></i>
                        <span>{{ fee_stats.students_with_balance }} students</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Records Section -->
    <div class="row g-4 mb-4">
        <!-- Recent Admissions -->
        <div class="col-lg-4 col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 border-bottom">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title mb-0 fw-bold">Recent Admissions</h5>
                            <small class="text-muted">Latest student enrollments</small>
                        </div>
                        <a href="{% url 'student_list' %}" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        {% for student in recent_admissions %}
                        <div class="list-group-item border-0 px-3 py-3">
                            <div class="d-flex align-items-center">
                                {% if student.photo %}
                                    <img src="{{ student.photo.url }}" alt="" class="rounded-circle me-3" 
                                         style="width: 40px; height: 40px; object-fit: cover;">
                                {% else %}
                                    <div class="rounded-circle bg-light me-3 d-flex align-items-center justify-content-center" 
                                         style="width: 40px; height: 40px;">
                                        <i class="bi bi-person text-secondary"></i>
                                    </div>
                                {% endif %}
                                <div class="flex-grow-1">
                                    <div class="fw-medium">{{ student.get_full_name }}</div>
                                    <small class="text-muted d-block">{{ student.admission_number }} • {{ student.grade.name }}</small>
                                    <small class="text-muted">{{ student.created_at|date:"M d, Y" }}</small>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="list-group-item border-0 text-center py-4">
                            <div class="text-muted">No recent admissions</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Payments -->
        <div class="col-lg-4 col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 border-bottom">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title mb-0 fw-bold">Recent Payments</h5>
                            <small class="text-muted">Latest fee payments</small>
                        </div>
                        <a href="{% url 'payment_list' %}" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        {% for payment in recent_payments %}
                        <div class="list-group-item border-0 px-3 py-3">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center flex-grow-1">
                                    <div class="stat-icon-box bg-soft-success me-3">
                                        <i class="bi bi-cash-coin text-success"></i>
                                    </div>
                                    <div>
                                        <div class="fw-medium">{{ payment.student.get_full_name }}</div>
                                        <small class="text-muted d-block">{{ payment.student.grade.name }}</small>
                                        <small class="text-muted">{{ payment.date|date:"M d, Y" }}</small>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <div class="text-success fw-bold">KES {{ payment.amount|intcomma }}</div>
                                    <span class="badge bg-light text-dark small">{{ payment.payment_method }}</span>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="list-group-item border-0 text-center py-4">
                            <div class="text-muted">No recent payments</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Transport Payments -->
        <div class="col-lg-4 col-md-12">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 border-bottom">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title mb-0 fw-bold">Transport</h5>
                            <small class="text-muted">Recent payments</small>
                        </div>
                        <div class="btn-group btn-group-sm">
                            <a href="{% url 'transport_dashboard' %}" class="btn btn-outline-primary" title="Transport">
                                <i class="bi bi-bus-front"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        {% for fee in recent_transport_fees|slice:":2" %}
                        <div class="list-group-item border-0 px-3 py-3">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center flex-grow-1">
                                    <div class="stat-icon-box bg-soft-purple me-3">
                                        <i class="bi bi-bus-front text-purple"></i>
                                    </div>
                                    <div>
                                        <div class="fw-medium">{{ fee.student.get_full_name }}</div>
                                        <small class="text-muted d-block">{{ fee.route.name }}</small>
                                        <small class="text-muted">{{ fee.date|date:"M d, Y" }}</small>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <div class="text-success fw-bold">KES {{ fee.amount|intcomma }}</div>
                                    <span class="badge bg-purple-subtle text-purple small">Transport</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% if not recent_transport_fees %}
                        <div class="list-group-item border-0 text-center py-4">
                            <div class="text-muted">No recent transport payments</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fee Collection Analytics -->
    <div class="row g-4 mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent border-0 p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="fw-semibold mb-1">Fee Collection Analytics</h5>
                            <p class="text-muted small mb-0">Financial overview for {{ current_term }}</p>
                        </div>
                        <div class="d-flex gap-2">
                            <select class="form-select form-select-sm" id="chartType">
                                <option value="bar">Bar Chart</option>
                                <option value="line">Line Chart</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="card-body p-4">
                    <!-- Quick Stats Cards -->
                    <div class="row g-3 mb-4">
                        <!-- Total Collection -->
                        <div class="col-md-3">
                            <div class="p-3 rounded-4 bg-soft-primary">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <p class="text-muted small mb-1">Total Collection</p>
                                        <h4 class="mb-0">KES {{ total_payments|floatformat:2|intcomma }}</h4>
                                        <span class="badge bg-primary-subtle text-primary mt-2">
                                            <i class="bi bi-arrow-up-short"></i>{{ fees_percent|floatformat:1 }}%
                                        </span>
                                    </div>
                                    <div class="icon-box">
                                        <i class="bi bi-cash-stack fs-3 text-primary"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Expected Fees -->
                        <div class="col-md-3">
                            <div class="p-3 rounded-4 bg-soft-success">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <p class="text-muted small mb-1">Expected Fees</p>
                                        <h4 class="mb-0">KES {{ expected_term_fees|floatformat:2|intcomma }}</h4>
                                        <span class="text-success small mt-2">{{ current_term }}</span>
                                    </div>
                                    <div class="icon-box">
                                        <i class="bi bi-check-circle fs-3 text-success"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Outstanding Balance -->
                        <div class="col-md-3">
                            <div class="p-3 rounded-4 bg-soft-warning">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <p class="text-muted small mb-1">Outstanding</p>
                                        <h4 class="mb-0">KES {{ fees_balance|floatformat:2|intcomma }}</h4>
                                        <span class="text-warning small mt-2">
                                            {{ fee_stats.students_with_balance }} Students
                                        </span>
                                    </div>
                                    <div class="icon-box">
                                        <i class="bi bi-exclamation-circle fs-3 text-warning"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Collection Rate -->
                        <div class="col-md-3">
                            <div class="p-3 rounded-4 bg-soft-info">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <p class="text-muted small mb-1">Collection Rate</p>
                                        <h4 class="mb-0">{{ fees_percent|floatformat:1 }}%</h4>
                                        <div class="progress mt-2" style="height: 4px;">
                                            <div class="progress-bar bg-info" 
                                                 style="width: {{ fees_percent }}%" 
                                                 title="KES {{ total_payments|floatformat:2|intcomma }} of {{ expected_term_fees|floatformat:2|intcomma }}">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="icon-box">
                                        <i class="bi bi-graph-up fs-3 text-info"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="row">
                        <!-- Monthly Collections Chart -->
                        <div class="col-md-8">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="feeCollectionChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Payment Methods Chart -->
                        <div class="col-md-4">
                            <h6 class="mb-3">Payment Methods</h6>
                            <div class="chart-container" style="height: 200px;">
                                <canvas id="paymentMethodsChart"></canvas>
                            </div>
                            
                            <!-- Payment Methods Legend -->
                            <div class="payment-methods-legend mt-3">
                                {% for label in payment_method_labels %}
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <div class="d-flex align-items-center">
                                        <span class="status-dot 
                                            {% if forloop.counter == 1 %}bg-primary
                                            {% elif forloop.counter == 2 %}bg-success
                                            {% elif forloop.counter == 3 %}bg-warning
                                            {% else %}bg-danger{% endif %} me-2">
                                        </span>
                                        <span class="small">{{ label }}</span>
                                    </div>
                                    <span class="badge bg-light text-dark">
                                        {{ payment_method_data|index:forloop.counter0 }}
                                    </span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<style>
/* Compact Dashboard Cards */
.dashboard-card-compact {
    border: none;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    position: relative;
    background: #ffffff;
    height: 100%;
}

.dashboard-card-compact::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, transparent, currentColor, transparent);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.dashboard-card-compact:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

.dashboard-card-compact:hover::before {
    opacity: 1;
}

/* Compact Icon Wrappers */
.dashboard-icon-compact {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.3s ease;
}

.dashboard-card-compact:hover .dashboard-icon-compact {
    transform: scale(1.1) rotate(3deg);
}

/* Compact Labels and Values */
.dashboard-label-compact {
    font-size: 0.65rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #6c757d;
    margin-bottom: 0.25rem;
}

.dashboard-value-compact {
    font-size: 1.6rem;
    font-weight: 700;
    line-height: 1.2;
    margin: 0;
    transition: all 0.3s ease;
}

.dashboard-card-compact:hover .dashboard-value-compact {
    transform: scale(1.03);
}

/* Compact Badges */
.dashboard-badge-compact {
    padding: 0.25rem 0.6rem;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.7rem;
    display: inline-flex;
    align-items: center;
    gap: 0.2rem;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
}

/* Compact Footer */
.dashboard-footer-compact {
    padding-top: 0.5rem;
    margin-top: 0.5rem;
    border-top: 1px solid rgba(0, 0, 0, 0.06);
    display: flex;
    align-items: center;
    font-size: 0.7rem;
    color: #6c757d;
}

/* Compact Progress Bars */
.dashboard-progress-compact {
    height: 6px;
    border-radius: 6px;
    background: rgba(0, 0, 0, 0.05);
    overflow: hidden;
    position: relative;
}

.dashboard-progress-bar-compact {
    height: 100%;
    border-radius: 6px;
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Compact Mini Stats */
.dashboard-mini-stat-compact {
    padding: 0.5rem;
    border-radius: 8px;
    background: rgba(0, 0, 0, 0.02);
    border: 1px solid rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

.dashboard-card-compact:hover .dashboard-mini-stat-compact {
    background: rgba(0, 0, 0, 0.04);
}

.dashboard-mini-label-compact {
    display: block;
    font-size: 0.6rem;
    color: #6c757d;
    margin-bottom: 0.25rem;
    font-weight: 500;
}

.dashboard-mini-value-compact {
    display: block;
    font-size: 0.85rem;
    color: #212529;
    font-weight: 700;
}

/* Modern Dashboard Cards */
.dashboard-card-modern {
    border: none;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    position: relative;
    background: #ffffff;
    height: 100%;
}

.dashboard-card-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, transparent, currentColor, transparent);
    opacity: 0;
    transition: opacity 0.4s ease;
}

.dashboard-card-modern:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}

.dashboard-card-modern:hover::before {
    opacity: 1;
}

/* Card Color Variants - Compact */
.dashboard-card-compact.dashboard-card-primary {
    background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);
    border-left: 4px solid #0d6efd;
}

.dashboard-card-compact.dashboard-card-danger {
    background: linear-gradient(135deg, #ffffff 0%, #fff5f5 100%);
    border-left: 4px solid #dc3545;
}

.dashboard-card-compact.dashboard-card-success {
    background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%);
    border-left: 4px solid #198754;
}

.dashboard-card-compact.dashboard-card-teal {
    background: linear-gradient(135deg, #ffffff 0%, #e6f7f7 100%);
    border-left: 4px solid #20c997;
}

.dashboard-card-compact.dashboard-card-info {
    background: linear-gradient(135deg, #ffffff 0%, #eff6ff 100%);
    border-left: 4px solid #0dcaf0;
}

.dashboard-card-compact.dashboard-card-warning {
    background: linear-gradient(135deg, #ffffff 0%, #fffbeb 100%);
    border-left: 4px solid #ffc107;
}

.dashboard-card-compact.dashboard-card-purple {
    background: linear-gradient(135deg, #ffffff 0%, #faf5ff 100%);
    border-left: 4px solid #8b5cf6;
}

/* Card Color Variants - Modern */
.dashboard-card-modern.dashboard-card-primary {
    background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);
    border-left: 5px solid #0d6efd;
}

.dashboard-card-modern.dashboard-card-danger {
    background: linear-gradient(135deg, #ffffff 0%, #fff5f5 100%);
    border-left: 5px solid #dc3545;
}

.dashboard-card-modern.dashboard-card-success {
    background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%);
    border-left: 5px solid #198754;
}

.dashboard-card-modern.dashboard-card-teal {
    background: linear-gradient(135deg, #ffffff 0%, #e6f7f7 100%);
    border-left: 5px solid #20c997;
}

.dashboard-card-modern.dashboard-card-info {
    background: linear-gradient(135deg, #ffffff 0%, #eff6ff 100%);
    border-left: 5px solid #0dcaf0;
}

.dashboard-card-modern.dashboard-card-warning {
    background: linear-gradient(135deg, #ffffff 0%, #fffbeb 100%);
    border-left: 5px solid #ffc107;
}

.dashboard-card-modern.dashboard-card-purple {
    background: linear-gradient(135deg, #ffffff 0%, #faf5ff 100%);
    border-left: 5px solid #8b5cf6;
}

/* Icon Wrappers */
.dashboard-icon-wrapper {
    width: 64px;
    height: 64px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.dashboard-icon-wrapper::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s ease, height 0.6s ease;
}

.dashboard-card-modern:hover .dashboard-icon-wrapper::before {
    width: 200px;
    height: 200px;
}

/* Compact Icon Colors */
.dashboard-icon-compact.dashboard-icon-primary {
    background: linear-gradient(135deg, rgba(13, 110, 253, 0.12) 0%, rgba(13, 110, 253, 0.2) 100%);
    color: #0d6efd;
}

.dashboard-icon-compact.dashboard-icon-danger {
    background: linear-gradient(135deg, rgba(220, 53, 69, 0.12) 0%, rgba(220, 53, 69, 0.2) 100%);
    color: #dc3545;
}

.dashboard-icon-compact.dashboard-icon-success {
    background: linear-gradient(135deg, rgba(25, 135, 84, 0.12) 0%, rgba(25, 135, 84, 0.2) 100%);
    color: #198754;
}

.dashboard-icon-compact.dashboard-icon-teal {
    background: linear-gradient(135deg, rgba(32, 201, 151, 0.12) 0%, rgba(32, 201, 151, 0.2) 100%);
    color: #20c997;
}

.dashboard-icon-compact.dashboard-icon-info {
    background: linear-gradient(135deg, rgba(13, 202, 240, 0.12) 0%, rgba(13, 202, 240, 0.2) 100%);
    color: #0dcaf0;
}

.dashboard-icon-compact.dashboard-icon-warning {
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.12) 0%, rgba(255, 193, 7, 0.2) 100%);
    color: #ffc107;
}

.dashboard-icon-compact.dashboard-icon-purple {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.12) 0%, rgba(139, 92, 246, 0.2) 100%);
    color: #8b5cf6;
}

/* Modern Icon Colors */
.dashboard-icon-wrapper.dashboard-icon-primary {
    background: linear-gradient(135deg, rgba(13, 110, 253, 0.15) 0%, rgba(13, 110, 253, 0.25) 100%);
    color: #0d6efd;
}

.dashboard-icon-wrapper.dashboard-icon-danger {
    background: linear-gradient(135deg, rgba(220, 53, 69, 0.15) 0%, rgba(220, 53, 69, 0.25) 100%);
    color: #dc3545;
}

.dashboard-icon-wrapper.dashboard-icon-success {
    background: linear-gradient(135deg, rgba(25, 135, 84, 0.15) 0%, rgba(25, 135, 84, 0.25) 100%);
    color: #198754;
}

.dashboard-icon-wrapper.dashboard-icon-teal {
    background: linear-gradient(135deg, rgba(32, 201, 151, 0.15) 0%, rgba(32, 201, 151, 0.25) 100%);
    color: #20c997;
}

.dashboard-icon-wrapper.dashboard-icon-info {
    background: linear-gradient(135deg, rgba(13, 202, 240, 0.15) 0%, rgba(13, 202, 240, 0.25) 100%);
    color: #0dcaf0;
}

.dashboard-icon-wrapper.dashboard-icon-warning {
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.15) 0%, rgba(255, 193, 7, 0.25) 100%);
    color: #ffc107;
}

.dashboard-icon-wrapper.dashboard-icon-purple {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(139, 92, 246, 0.25) 100%);
    color: #8b5cf6;
}

.dashboard-card-modern:hover .dashboard-icon-wrapper {
    transform: scale(1.1) rotate(5deg);
}

/* Labels and Values */
.dashboard-label {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #6c757d;
    margin-bottom: 0.5rem;
}

.dashboard-value {
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.2;
    margin: 0;
    transition: all 0.3s ease;
}

.dashboard-card-modern:hover .dashboard-value {
    transform: scale(1.05);
}

/* Compact Value Colors */
.dashboard-value-compact.dashboard-value-primary { color: #0d6efd; }
.dashboard-value-compact.dashboard-value-danger { color: #dc3545; }
.dashboard-value-compact.dashboard-value-success { color: #198754; }
.dashboard-value-compact.dashboard-value-teal { color: #20c997; }
.dashboard-value-compact.dashboard-value-info { color: #0dcaf0; }
.dashboard-value-compact.dashboard-value-warning { color: #ffc107; }
.dashboard-value-compact.dashboard-value-purple { color: #8b5cf6; }

/* Modern Value Colors */
.dashboard-value-primary { color: #0d6efd; }
.dashboard-value-danger { color: #dc3545; }
.dashboard-value-success { color: #198754; }
.dashboard-value-teal { color: #20c997; }
.dashboard-value-info { color: #0dcaf0; }
.dashboard-value-warning { color: #ffc107; }
.dashboard-value-purple { color: #8b5cf6; }

/* Badges */
.dashboard-badge {
    padding: 0.5rem 1rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.875rem;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.dashboard-card-modern:hover .dashboard-badge {
    transform: scale(1.05);
}

/* Compact Badge Colors */
.dashboard-badge-compact.dashboard-badge-success {
    background: linear-gradient(135deg, #198754 0%, #157347 100%);
    color: white;
}

.dashboard-badge-compact.dashboard-badge-danger {
    background: linear-gradient(135deg, #dc3545 0%, #bb2d3b 100%);
    color: white;
}

.dashboard-badge-compact.dashboard-badge-teal {
    background: linear-gradient(135deg, #20c997 0%, #1aa179 100%);
    color: white;
}

.dashboard-badge-compact.dashboard-badge-primary {
    background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
    color: white;
}

.dashboard-badge-compact.dashboard-badge-purple {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    color: white;
}

.dashboard-badge-compact.dashboard-badge-warning {
    background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
    color: #000;
}

/* Modern Badge Colors */
.dashboard-badge-success {
    background: linear-gradient(135deg, #198754 0%, #157347 100%);
    color: white;
}

.dashboard-badge-danger {
    background: linear-gradient(135deg, #dc3545 0%, #bb2d3b 100%);
    color: white;
}

.dashboard-badge-teal {
    background: linear-gradient(135deg, #20c997 0%, #1aa179 100%);
    color: white;
}

.dashboard-badge-primary {
    background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
    color: white;
}

.dashboard-badge-purple {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    color: white;
}

.dashboard-badge-warning {
    background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
    color: #000;
}

/* Footer */
.dashboard-footer {
    padding-top: 1rem;
    margin-top: 1rem;
    border-top: 1px solid rgba(0, 0, 0, 0.08);
    display: flex;
    align-items: center;
    font-size: 0.875rem;
    color: #6c757d;
}

/* Progress Bars */
.dashboard-progress {
    height: 10px;
    border-radius: 10px;
    background: rgba(0, 0, 0, 0.05);
    overflow: hidden;
    position: relative;
}

.dashboard-progress-bar {
    height: 100%;
    border-radius: 10px;
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.dashboard-progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    animation: shimmer 2s infinite;
}

/* Compact Progress Bar Colors */
.dashboard-progress-bar-compact.dashboard-progress-success {
    background: linear-gradient(90deg, #198754 0%, #20c997 100%);
}

.dashboard-progress-bar-compact.dashboard-progress-warning {
    background: linear-gradient(90deg, #ffc107 0%, #ffb300 100%);
}

.dashboard-progress-bar-compact.dashboard-progress-danger {
    background: linear-gradient(90deg, #dc3545 0%, #bb2d3b 100%);
}

.dashboard-progress-bar-compact.dashboard-progress-purple {
    background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%);
}

/* Modern Progress Bar Colors */
.dashboard-progress-success {
    background: linear-gradient(90deg, #198754 0%, #20c997 100%);
}

.dashboard-progress-warning {
    background: linear-gradient(90deg, #ffc107 0%, #ffb300 100%);
}

.dashboard-progress-danger {
    background: linear-gradient(90deg, #dc3545 0%, #bb2d3b 100%);
}

.dashboard-progress-purple {
    background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%);
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* Mini Stats */
.dashboard-mini-stat {
    padding: 1rem;
    border-radius: 12px;
    background: rgba(0, 0, 0, 0.02);
    border: 1px solid rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

.dashboard-card-modern:hover .dashboard-mini-stat {
    background: rgba(0, 0, 0, 0.04);
    transform: translateY(-2px);
}

.dashboard-mini-label {
    display: block;
    font-size: 0.7rem;
    color: #6c757d;
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.dashboard-mini-value {
    display: block;
    font-size: 1.1rem;
    color: #212529;
    font-weight: 700;
}

.bg-gradient-primary-to-secondary {
    background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
}

.modern-card {
    border-radius: 1.25rem;
    transition: all 0.3s ease;
    background: #ffffff;
    overflow: hidden;
}

.shadow-hover {
    box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.08);
    transition: all 0.3s ease;
}

.shadow-hover:hover {
    transform: translateY(-5px);
    box-shadow: 0 1rem 2rem rgba(0,0,0,0.12);
}

.stat-content {
    position: relative;
}

.stat-icon-wrapper {
    position: relative;
}

.stat-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.pulse {
    position: relative;
}

.pulse::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    animation: pulse 2s infinite;
    opacity: 0;
}

@keyframes pulse {
    0% {
        transform: scale(1);
        opacity: 0.5;
    }
    100% {
        transform: scale(1.5);
        opacity: 0;
    }
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.2;
    color: #2c3e50;
}

.tracking-wider {
    letter-spacing: 0.1em;
}

.stat-indicator {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    border-radius: 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
}

.stat-indicator i {
    font-size: 1.25rem;
    margin-right: 0.5rem;
}

.stat-indicator.positive {
    background-color: rgba(40, 167, 69, 0.1);
    color: #28a745;
}

.stat-indicator.neutral {
    background-color: rgba(23, 162, 184, 0.1);
    color: #17a2b8;
}

.stat-indicator.warning {
    background-color: rgba(255, 193, 7, 0.1);
    color: #ffc107;
}

.stat-indicator.info {
    background-color: rgba(13, 110, 253, 0.1);
    color: #0d6efd;
}

.modern-card:hover .stat-circle {
    transform: scale(1.1);
}

.modern-card:hover .stat-value {
    color: #1a237e;
}

.avatar-circle {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    font-weight: 600;
}

.letter-spacing-1 {
    letter-spacing: 1px;
}

.fs-7 {
    font-size: 0.875rem;
}

.table > :not(caption) > * > * {
    padding: 1.25rem 1.5rem;
}

.table thead th {
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 600;
    color: #6c757d;
}

.badge {
    font-weight: 500;
    padding: 0.5em 1em;
}

.btn {
    font-weight: 500;
}

.btn-sm {
    font-size: 0.875rem;
}

.card-title {
    font-weight: 600;
}

.header-section {
    margin: -1.5rem -1.5rem 2rem -1.5rem;
    padding-top: 2rem;
    padding-bottom: 2rem;
}

/* Custom scrollbar for tables */
.table-responsive::-webkit-scrollbar {
    height: 6px;
}

.table-responsive::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.table-responsive::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 3px;
}

.table-responsive::-webkit-scrollbar-thumb:hover {
    background: #999;
}

/* Improved text styles */
.text-muted {
    color: #6c757d !important;
}

.display-5 {
    font-size: 2.5rem;
    font-weight: 700;
}

.display-6 {
    font-size: 2rem;
    font-weight: 700;
}

.lead {
    font-size: 1.1rem;
    font-weight: 400;
}

/* Logo styling */
.school-logo {
    background: white;
    border-radius: 50%;
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border: 3px solid rgba(255,255,255,0.2);
}

.logo-img {
    width: 65px;
    height: 65px;
    object-fit: contain;
}

/* Responsive adjustments */
@media (max-width: 991.98px) {
    .school-logo {
        width: 70px;
        height: 70px;
    }
    
    .logo-img {
        width: 55px;
        height: 55px;
    }
    
    .display-5 {
        font-size: 2rem;
    }
    
    .lead {
        font-size: 1rem;
    }
}

@media (max-width: 575.98px) {
    .school-logo {
        width: 60px;
        height: 60px;
    }
    
    .logo-img {
        width: 45px;
        height: 45px;
    }
    
    .display-5 {
        font-size: 1.75rem;
    }
}

@media (max-width: 1200px) {
    .stat-value {
        font-size: 2rem;
    }
}

@media (max-width: 768px) {
    .stat-circle {
        width: 50px;
        height: 50px;
    }
    
    .stat-value {
        font-size: 1.75rem;
    }
}

/* Modern card styles */
.stat-card {
    border-radius: 16px;
    background: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(0,0,0,0.05);
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
}

.stat-card-modern {
    border-radius: 12px;
    background: #fff;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    position: relative;
}

.stat-card-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, transparent 0%, currentColor 50%, transparent 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.stat-card-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
}

.stat-card-modern:hover::before {
    opacity: 0.3;
}

.transport-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8f5ff 100%);
}

.stat-icon-box {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.stat-icon-modern {
    width: 56px;
    height: 56px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.stat-icon-modern i {
    font-size: 1.75rem;
}

.stat-card-modern:hover .stat-icon-modern {
    transform: scale(1.08) rotate(-2deg);
}

.stat-card:hover .stat-icon-box {
    transform: scale(1.1) rotate(5deg);
}

.stat-icon-box i {
    font-size: 1.5rem;
}

.badge-modern {
    padding: 0.35rem 0.7rem;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.75rem;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.progress-modern {
    position: relative;
    overflow: hidden;
}

.progress-bar-modern {
    position: relative;
    overflow: hidden;
}

.progress-bar-modern::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* Soft background colors */
.bg-soft-primary {
    background-color: rgba(13, 110, 253, 0.1);
}

.bg-soft-success {
    background-color: rgba(25, 135, 84, 0.1);
}

.bg-soft-info {
    background-color: rgba(13, 202, 240, 0.1);
}

.bg-soft-warning {
    background-color: rgba(255, 193, 7, 0.1);
}

.bg-soft-purple {
    background-color: rgba(139, 92, 246, 0.1);
}

.bg-soft-orange {
    background-color: rgba(255, 152, 0, 0.1);
}

.bg-soft-danger {
    background-color: rgba(220, 53, 69, 0.1);
}

/* Color classes */
.text-purple {
    color: #8b5cf6 !important;
}

.text-orange {
    color: #ff9800 !important;
}

.bg-purple {
    background-color: #8b5cf6 !important;
}

.bg-orange {
    background-color: #ff9800 !important;
}

.bg-purple-subtle {
    background-color: rgba(139, 92, 246, 0.1);
}

.bg-orange-subtle {
    background-color: rgba(255, 152, 0, 0.1);
}

.text-purple {
    color: #8b5cf6 !important;
}

.text-orange {
    color: #ff9800 !important;
}

/* Typography updates */
h3 {
    font-size: 1.5rem;
    font-weight: 600;
}

.small {
    font-size: 0.8125rem;
}

/* Table updates */
.table-modern {
    border-collapse: separate;
    border-spacing: 0 0.5rem;
}

.table-modern tbody tr {
    background: #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.02);
    border-radius: 8px;
    transition: transform 0.2s ease;
}

.table-modern tbody tr:hover {
    transform: translateX(4px);
}

.table-modern td {
    border: none;
    padding: 1rem;
}

.table-modern td:first-child {
    border-radius: 8px 0 0 8px;
}

.table-modern td:last-child {
    border-radius: 0 8px 8px 0;
}

/* Badge updates */
.badge-soft {
    font-weight: 500;
    padding: 0.35em 0.8em;
    border-radius: 6px;
}

.badge-soft-success {
    background-color: rgba(25, 135, 84, 0.1);
    color: #198754;
}

.badge-soft-warning {
    background-color: rgba(255, 193, 7, 0.1);
    color: #ffc107;
}

.badge-soft-danger {
    background-color: rgba(220, 53, 69, 0.1);
    color: #dc3545;
}

/* Layout adjustments */
.container-fluid {
    padding: 1rem 1.5rem;
}

.card {
    margin-bottom: 1rem;
}

/* Header refinements */
.header-section {
    padding: 1.5rem 0;
    margin-bottom: 1.5rem;
}

.header-section .display-5 {
    font-size: 1.75rem;
}

.header-section .lead {
    font-size: 0.9375rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .stat-icon-box {
        width: 36px;
        height: 36px;
    }
    
    .stat-icon-box i {
        font-size: 1rem;
    }
    
    h3 {
        font-size: 1.25rem;
    }
    
    .container-fluid {
        padding: 1rem;
    }
}

/* Button styles */
.btn-soft-primary {
    background-color: rgba(13, 110, 253, 0.1);
    color: #0d6efd;
    border: none;
}

.btn-soft-primary:hover {
    background-color: rgba(13, 110, 253, 0.2);
    color: #0d6efd;
}

/* Table styles */
.table-modern {
    margin: 0;
}

.table-modern thead th {
    background-color: #f8f9fa;
    font-weight: 600;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 0.75rem 1rem;
    border: none;
}

.table-modern tbody tr {
    transition: all 0.2s ease;
}

.table-modern tbody tr:hover {
    background-color: #f8f9fa;
}

/* Payment item styles */
.payment-item {
    transition: all 0.2s ease;
}

.payment-item:hover {
    background-color: #f8f9fa;
}

.payment-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.smaller {
    font-size: 0.75rem;
}

/* Avatar styles */
.avatar-circle {
    width: 38px;
    height: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    font-size: 0.875rem;
    font-weight: 600;
}

/* Badge refinements */
.badge {
    padding: 0.4em 0.8em;
    font-weight: 500;
}

.badge-soft {
    background-color: #f8f9fa;
    color: #6c757d;
}

/* Fade out animation */
@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

.fading-out {
    animation: fadeOut 0.5s ease-out forwards;
}

/* Empty state styling */
.text-center.text-muted {
    font-size: 0.875rem;
    color: #6c757d;
}

/* Analytics Cards */
.analytics-card {
    transition: all 0.3s ease;
    border-radius: 1rem;
}

.analytics-card:hover {
    transform: translateY(-5px);
}

.icon-box {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.analytics-card:hover .icon-box {
    transform: scale(1.1);
}

/* Attendance Sparkline */
.attendance-sparkline {
    display: flex;
    align-items: flex-end;
    gap: 3px;
    height: 40px;
    padding-top: 10px;
}

.sparkline-bar {
    flex: 1;
    background: #e9ecef;
    border-radius: 2px;
    position: relative;
    min-height: 4px;
    transition: all 0.3s ease;
}

.sparkline-bar::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: #0dcaf0;
    border-radius: 2px;
    height: calc(100% - 4px);
    transition: height 0.3s ease;
}

/* Chart Styles */
.chart-actions .form-select {
    border-radius: 20px;
    padding: 0.375rem 2rem 0.375rem 1rem;
    font-size: 0.875rem;
    border-color: #e9ecef;
}

/* Custom Colors */
.bg-primary-subtle { background-color: rgba(13, 110, 253, 0.1); }
.bg-success-subtle { background-color: rgba(25, 135, 84, 0.1); }
.bg-info-subtle { background-color: rgba(13, 202, 240, 0.1); }
.bg-warning-subtle { background-color: rgba(255, 193, 7, 0.1); }

.text-primary { color: #0d6efd !important; }
.text-success { color: #198754 !important; }
.text-info { color: #0dcaf0 !important; }
.text-warning { color: #ffc107 !important; }

/* Responsive Adjustments for Compact Cards */
@media (max-width: 768px) {
    .dashboard-card-compact {
        border-radius: 10px;
        margin-bottom: 0.75rem;
    }
    
    .dashboard-icon-compact {
        width: 36px;
        height: 36px;
        font-size: 16px;
    }
    
    .dashboard-value-compact {
        font-size: 1.4rem;
    }
    
    .dashboard-label-compact {
        font-size: 0.6rem;
    }
    
    .dashboard-badge-compact {
        padding: 0.2rem 0.5rem;
        font-size: 0.65rem;
    }
    
    .dashboard-mini-stat-compact {
        padding: 0.4rem;
    }
    
    .dashboard-mini-value-compact {
        font-size: 0.75rem;
    }
    
    .dashboard-footer-compact {
        font-size: 0.65rem;
    }
}

/* Responsive Adjustments for Modern Cards */
@media (max-width: 768px) {
    .dashboard-card-modern {
        border-radius: 16px;
        margin-bottom: 1rem;
    }
    
    .dashboard-icon-wrapper {
        width: 56px;
        height: 56px;
        font-size: 24px;
    }
    
    .dashboard-value {
        font-size: 2rem;
    }
    
    .dashboard-label {
        font-size: 0.7rem;
    }
    
    .dashboard-badge {
        padding: 0.4rem 0.8rem;
        font-size: 0.75rem;
    }
    
    .dashboard-mini-stat {
        padding: 0.75rem;
    }
    
    .dashboard-mini-value {
        font-size: 1rem;
    }
    
    .analytics-card .card-body {
        padding: 1rem;
    }

    .icon-box {
        width: 40px;
        height: 40px;
    }

    .analytics-card h3 {
        font-size: 1.5rem;
    }
}

/* Fee Analytics Styles */
.stat-item {
    transition: all 0.3s ease;
}

.stat-item:hover {
    background-color: #f8f9fa !important;
    transform: translateY(-2px);
}

.status-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    display: inline-block;
}

.status-legend {
    font-size: 0.875rem;
}

.chart-actions .form-select {
    min-width: 120px;
}

/* Chart colors */
.bg-success { background-color: #10b981 !important; }
.bg-warning { background-color: #f59e0b !important; }
.bg-danger { background-color: #ef4444 !important; }

/* Fee Analytics Additional Styles */
.bg-soft-primary {
    background-color: rgba(13, 110, 253, 0.1);
}

.bg-soft-success {
    background-color: rgba(16, 185, 129, 0.1);
}

.bg-soft-danger {
    background-color: rgba(239, 68, 68, 0.1);
}

.bg-soft-info {
    background-color: rgba(59, 130, 246, 0.1);
}

.stat-item {
    transition: all 0.3s ease;
}

.stat-item:hover {
    transform: translateY(-2px);
}

.chart-container {
    position: relative;
    margin: auto;
}

.status-legend .badge {
    font-weight: 500;
    padding: 0.5em 0.75em;
}

.avatar-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 500;
    font-size: 0.875rem;
}

.table-hover tbody tr:hover {
    background-color: rgba(0, 0, 0, 0.02);
}

/* Add this inside the existing styles */
.bg-soft-purple {
    background-color: rgba(139, 92, 246, 0.1);
}

.text-purple {
    color: #8b5cf6 !important;
}

/* Custom Styles */
.bg-soft-primary { background-color: rgba(59, 130, 246, 0.1); }
.bg-soft-success { background-color: rgba(16, 185, 129, 0.1); }
.bg-soft-danger { background-color: rgba(239, 68, 68, 0.1); }
.bg-soft-info { background-color: rgba(99, 102, 241, 0.1); }

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
}

.chart-container {
    position: relative;
    margin: auto;
}

.rounded-4 {
    border-radius: 1rem;
}

/* Card hover effects */
.card {
    transition: transform 0.2s ease-in-out;
}

.card:hover {
    transform: translateY(-5px);
}

/* Smooth animations */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.stat-card {
    animation: fadeInUp 0.6s ease-out;
}

.stat-card:nth-child(1) { animation-delay: 0.1s; }
.stat-card:nth-child(2) { animation-delay: 0.2s; }
.stat-card:nth-child(3) { animation-delay: 0.3s; }
.stat-card:nth-child(4) { animation-delay: 0.4s; }

/* List group item hover */
.list-group-item {
    transition: all 0.2s ease;
}

.list-group-item:hover {
    background-color: #f8f9fa;
    transform: translateX(4px);
}

/* Mobile-specific improvements */
@media (max-width: 768px) {
    /* Mobile container adjustments */
    .container-fluid {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
    }
    
    /* Mobile header adjustments */
    .header-section {
        margin: 0;
        padding: 1rem 0;
        border-radius: 0;
    }
    
    .header-section .display-5 {
        font-size: 1.5rem;
        line-height: 1.2;
    }
    
    .header-section .lead {
        font-size: 0.9rem;
    }
    
    /* Mobile stat cards */
    .stat-card {
        margin-bottom: 0.5rem;
        border-radius: 8px;
    }
    
    .stat-card .card-body {
        padding: 1rem;
    }
    
    .stat-icon-box {
        width: 36px;
        height: 36px;
    }
    
    .stat-icon-box i {
        font-size: 1rem;
    }
    
    h3 {
        font-size: 1.25rem;
    }
    
    /* Mobile table improvements */
    .table-responsive {
        border-radius: 8px;
        margin: 0 -0.75rem;
    }
    
    .table td, .table th {
        padding: 0.75rem;
        font-size: 0.875rem;
    }
    
    /* Mobile chart container */
    .chart-container {
        height: 250px !important;
    }
    
    /* Mobile analytics cards */
    .analytics-card .card-body {
        padding: 1rem;
    }
    
    .icon-box {
        width: 40px;
        height: 40px;
    }
    
    /* Mobile button adjustments */
    .btn-sm {
        font-size: 0.8rem;
        padding: 0.375rem 0.75rem;
    }
    
    /* Mobile spacing */
    .row.g-4 {
        --bs-gutter-y: 1rem;
    }
    
    /* Mobile text adjustments */
    .small {
        font-size: 0.75rem;
    }
    
    /* Mobile progress bars */
    .progress {
        height: 6px;
    }
    
    /* Mobile badge adjustments */
    .badge {
        font-size: 0.75rem;
        padding: 0.25em 0.5em;
    }
    
    /* Mobile avatar adjustments */
    .avatar-circle {
        width: 28px;
        height: 28px;
        font-size: 0.75rem;
    }
    
    /* Mobile logo adjustments */
    .school-logo {
        width: 50px;
        height: 50px;
    }
    
    .logo-img {
        width: 40px;
        height: 40px;
    }
    
    /* Mobile touch feedback */
    .stat-card:active,
    .card:active,
    .btn:active {
        transform: scale(0.98);
    }
    
    /* Mobile scroll optimizations */
    .table-responsive {
        -webkit-overflow-scrolling: touch;
    }
    
    /* Mobile empty states */
    .text-center.text-muted {
        padding: 2rem 1rem;
    }
    
    /* Mobile chart legend */
    .payment-methods-legend {
        font-size: 0.8rem;
    }
    
    .payment-methods-legend .badge {
        font-size: 0.7rem;
    }
}

/* iPhone notch and safe area handling */
@supports (padding: max(0px)) {
    @media (max-width: 768px) {
        .mobile-app-container {
            padding-top: max(0px, env(safe-area-inset-top));
            padding-bottom: max(0px, env(safe-area-inset-bottom));
            padding-left: max(0px, env(safe-area-inset-left));
            padding-right: max(0px, env(safe-area-inset-right));
        }
        
        .header-section {
            padding-top: max(1rem, env(safe-area-inset-top));
        }
    }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Check if mobile device
    const isMobile = window.innerWidth <= 768;
    
    // Fee Collection Chart
    const ctx = document.getElementById('feeCollectionChart').getContext('2d');
    let chartType = isMobile ? 'line' : 'bar'; // Use line chart on mobile for better touch interaction
    let chart = null;

    function createChart() {
        if (chart) {
            chart.destroy();
        }

        chart = new Chart(ctx, {
            type: chartType,
            data: {
                labels: {{ chart_labels|safe }},
                datasets: [{
                    label: 'Fee Collection',
                    data: {{ chart_data|safe }},
                    backgroundColor: 'rgba(13, 110, 253, 0.2)',
                    borderColor: '#0d6efd',
                    borderWidth: 2,
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        ticks: {
                            maxRotation: isMobile ? 45 : 0,
                            minRotation: isMobile ? 45 : 0,
                            font: {
                                size: isMobile ? 10 : 12
                            }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            font: {
                                size: isMobile ? 10 : 12
                            },
                            callback: function(value) {
                                return 'KES ' + value.toLocaleString(undefined, {
                                    minimumFractionDigits: 2,
                                    maximumFractionDigits: 2
                                });
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            font: {
                                size: isMobile ? 10 : 12
                            }
                        }
                    },
                    tooltip: {
                        titleFont: {
                            size: isMobile ? 11 : 13
                        },
                        bodyFont: {
                            size: isMobile ? 10 : 12
                        },
                        callbacks: {
                            label: function(context) {
                                return 'KES ' + context.raw.toLocaleString(undefined, {
                                    minimumFractionDigits: 2,
                                    maximumFractionDigits: 2
                                });
                            }
                        }
                    }
                }
            }
        });
    }

    createChart();

    // Chart type toggle
    document.getElementById('chartType').addEventListener('change', function(e) {
        chartType = e.target.value;
        createChart();
    });

    // Payment Methods Chart
    const methodsCtx = document.getElementById('paymentMethodsChart').getContext('2d');
    new Chart(methodsCtx, {
        type: 'doughnut',
        data: {
            labels: {{ payment_method_labels|safe }},
            datasets: [{
                data: {{ payment_method_data|safe }},
                backgroundColor: [
                    '#0d6efd',  // Primary
                    '#198754',  // Success
                    '#ffc107',  // Warning
                    '#dc3545'   // Danger
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    titleFont: {
                        size: isMobile ? 11 : 13
                    },
                    bodyFont: {
                        size: isMobile ? 10 : 12
                    }
                }
            },
            cutout: isMobile ? '60%' : '70%' // Smaller cutout on mobile for better visibility
        }
    });
    
    // Mobile-specific optimizations
    if (isMobile) {
        // Add touch feedback to interactive elements
        const touchElements = document.querySelectorAll('.stat-card, .card, .btn, .table tbody tr');
        touchElements.forEach(element => {
            element.addEventListener('touchstart', function() {
                this.style.transform = 'scale(0.98)';
                this.style.transition = 'transform 0.1s ease';
            });
            
            element.addEventListener('touchend', function() {
                this.style.transform = 'scale(1)';
            });
            
            element.addEventListener('touchcancel', function() {
                this.style.transform = 'scale(1)';
            });
        });
        
        // Optimize scrolling for mobile
        document.documentElement.style.scrollBehavior = 'smooth';
        document.body.style.webkitOverflowScrolling = 'touch';
        
        // Prevent pull-to-refresh on dashboard
        let startY = 0;
        document.addEventListener('touchstart', function(e) {
            startY = e.touches[0].clientY;
        }, { passive: true });
        
        document.addEventListener('touchmove', function(e) {
            const currentY = e.touches[0].clientY;
            const diff = startY - currentY;
            
            if (window.pageYOffset === 0 && diff < 0) {
                e.preventDefault();
            }
        }, { passive: false });
    }
});
</script>
{% endblock %} 
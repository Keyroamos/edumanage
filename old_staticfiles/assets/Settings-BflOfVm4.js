import{r as x,j as e,e as b}from"./vendor-Cr6tcs86.js";import{u as oe,B as h,I as o}from"./index-D6YSVT4s.js";import{n as R,g as C,l as Y,al as A,V as H,am as q,an as U,y as J,F as D,ao as L,P as S,h as N,Q as ne,R as M,a4 as de,$ as K,x as ie,ap as ce,aq as me,ac as pe,K as xe}from"./ui-kKL2mqtN.js";const p=({title:_,icon:y,children:E})=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-800 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 dark:border-slate-800 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-50 dark:bg-slate-800 rounded-lg",children:e.jsx(y,{size:20,className:"text-slate-600 dark:text-slate-400"})}),e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:_})]}),e.jsx("div",{className:"p-6",children:E})]}),ge=()=>{const _=JSON.parse(localStorage.getItem("user")||"{}"),{fetchConfig:y,updateConfig:E,hasFeature:f}=oe(),[m,F]=x.useState("profile"),[w,u]=x.useState(!1),[V,I]=x.useState(!0),[P,l]=x.useState(null),[a,v]=x.useState({first_name:_.first_name||"",last_name:_.last_name||"",email:_.email||"",current_password:"",new_password:"",confirm_password:"",school_name:"",school_code:"",school_email:"",school_phone:"",school_address:"",admission_number_format:"",admission_counter:0,school_logo:null,school_logo_preview:null,school_logo_file:null,portal_slug:"",teacher_portal_password:"",student_portal_password:"",accountant_portal_password:"",food_portal_password:"",transport_portal_password:"",driver_portal_password:"",admission_fee:0}),[z,Q]=x.useState([]),[g,k]=x.useState({name:"",address:"",phone:""}),[B,W]=x.useState([]),[X,G]=x.useState(!1),[n,j]=x.useState({first_name:"",last_name:"",email:"",phone:"",position:"ACCOUNTANT",national_id:"",date_of_birth:"1990-01-01"}),$=async()=>{G(!0);try{const s=await b.get("/api/hr/staff/"),r=["ACCOUNTANT","FOOD_MANAGER","TRANSPORT_MANAGER"],t=s.data.staff.filter(d=>r.includes(d.position));W(t)}catch(s){console.error("Error fetching portal users:",s)}finally{G(!1)}},Z=async()=>{if(!n.first_name||!n.email||!n.position){l({type:"error",text:"Please fill in all required fields"});return}u(!0);try{await b.post("/api/hr/staff/create/",{...n,staff_type:"SUPPORT",gender:"M",date_joined:new Date().toISOString().split("T")[0]}),l({type:"success",text:`${n.position.replace("_"," ")} user created successfully!`}),j({first_name:"",last_name:"",email:"",phone:"",position:"ACCOUNTANT",national_id:"",date_of_birth:"1990-01-01"}),$()}catch(s){l({type:"error",text:s.response?.data?.error||"Failed to create portal user"})}finally{u(!1),setTimeout(()=>l(null),3e3)}},T=async()=>{try{const s=await b.get("/api/branches/");Q(s.data.branches||[])}catch(s){console.error("Error fetching branches:",s)}},ee=async()=>{if(g.name)try{await b.post("/api/branches/",g),k({name:"",address:"",phone:""}),T(),l({type:"success",text:"Branch added successfully"}),setTimeout(()=>l(null),3e3)}catch(s){l({type:"error",text:s.response?.data?.error||"Failed to add branch"}),setTimeout(()=>l(null),3e3)}},se=async s=>{if(window.confirm("Are you sure you want to delete this branch?"))try{await b.delete(`/ api / branches / ${s}/`),T(),l({type:"success",text:"Branch deleted successfully"}),setTimeout(()=>l(null),3e3)}catch(r){console.error("Error deleting branch:",r),l({type:"error",text:"Failed to delete branch"}),setTimeout(()=>l(null),3e3)}};x.useEffect(()=>{m==="branches"?T():m==="portal-users"&&$()},[m]),x.useEffect(()=>{(async()=>{I(!0);try{const r=await b.get("/api/config/"),t=r.data?.config||r.data||{};v(d=>({...d,school_name:t?.school_name||"",school_code:t?.school_code||"",school_email:t?.school_email||"",school_phone:t?.school_phone||"",school_address:t?.school_address||"",admission_number_format:t?.admission_number_format||"",admission_counter:t?.admission_counter||0,school_logo:t?.school_logo||null,portal_slug:t?.portal_slug||"",teacher_portal_password:t?.teacher_portal_password||"",student_portal_password:t?.student_portal_password||"",accountant_portal_password:t?.accountant_portal_password||"",food_portal_password:t?.food_portal_password||"",transport_portal_password:t?.transport_portal_password||"",driver_portal_password:t?.driver_portal_password||"",admission_fee:t?.admission_fee||0}))}catch(r){console.error("Error fetching config:",r)}finally{I(!1)}})()},[]);const c=s=>{v(r=>({...r,[s.target.name]:s.target.value}))},ae=async()=>{u(!0);try{const s=await b.post("/api/auth/profile/update/",{first_name:a.first_name,last_name:a.last_name,email:a.email});if(s.data.success){const t={...JSON.parse(localStorage.getItem("user")||"{}"),...s.data.user};localStorage.setItem("user",JSON.stringify(t)),l({type:"success",text:"Profile updated successfully!"}),await y()}}catch(s){l({type:"error",text:s.response?.data?.error||"Failed to update profile"})}finally{u(!1),setTimeout(()=>l(null),3e3)}},te=async()=>{if(!a.current_password||!a.new_password){l({type:"error",text:"Please fill in all password fields"});return}if(a.new_password!==a.confirm_password){l({type:"error",text:"New passwords do not match"});return}u(!0);try{(await b.post("/api/auth/password/change/",{current_password:a.current_password,new_password:a.new_password})).data.success&&(l({type:"success",text:"Password changed successfully!"}),v(r=>({...r,current_password:"",new_password:"",confirm_password:""})))}catch(s){l({type:"error",text:s.response?.data?.error||"Failed to change password"})}finally{u(!1),setTimeout(()=>l(null),3e3)}},O=async()=>{u(!0);try{const s=new FormData;s.append("school_name",a.school_name),s.append("school_code",a.school_code),s.append("school_email",a.school_email),s.append("school_phone",a.school_phone),s.append("school_address",a.school_address),s.append("admission_number_format",a.admission_number_format),s.append("admission_fee",a.admission_fee),s.append("teacher_portal_password",a.teacher_portal_password),s.append("student_portal_password",a.student_portal_password),s.append("accountant_portal_password",a.accountant_portal_password),s.append("food_portal_password",a.food_portal_password),s.append("transport_portal_password",a.transport_portal_password),s.append("driver_portal_password",a.driver_portal_password),a.school_logo_file&&s.append("school_logo",a.school_logo_file);const r=await b.post("/api/config/update/",s),t=r.data?.config||r.data?.saved_data||r.data?.configuration;if(r.data?.success&&t){if(E(t),r.data.user){const i={...JSON.parse(localStorage.getItem("user")||"{}"),...r.data.user};localStorage.setItem("user",JSON.stringify(i))}v(d=>({...d,...r.data.user?{first_name:r.data.user.first_name||d.first_name,last_name:r.data.user.last_name||d.last_name,email:r.data.user.email||d.email}:{},school_name:t.school_name||"",school_code:t.school_code||"",school_email:t.school_email||"",school_phone:t.school_phone||"",school_address:t.school_address||"",admission_number_format:t.admission_number_format||"",admission_counter:t.admission_counter||0,school_logo:t.school_logo||null,school_logo_preview:null,school_logo_file:null,admission_fee:t.admission_fee||0})),l({type:"success",text:"Institutional settings saved successfully!"})}else if(console.warn("Config save returned unusual data:",r.data),r.data?.success)await y(),l({type:"success",text:"Institutional settings saved!"});else{const d=r.data?.error||r.data?.message||"Sync failed";l({type:"error",text:`Settings saved but sync issue: ${d}`})}setTimeout(()=>l(null),5e3)}catch(s){console.error("Error saving config:",s),l({type:"error",text:s.response?.data?.error||"Server error while saving configuration"}),setTimeout(()=>l(null),5e3)}finally{u(!1)}},re=()=>{const s=a.admission_number_format||"{SCHOOL_CODE}/{YEAR}/{COUNTER:04d}",r=a.school_code||"EDU",t=new Date().getFullYear(),d=(a.admission_counter||0)+1;let i=s;return i=i.replace("{SCHOOL_CODE}",r),i=i.replace("{YEAR}",t.toString()),i=i.replace("{COUNTER:04d}",d.toString().padStart(4,"0")),i=i.replace("{COUNTER:05d}",d.toString().padStart(5,"0")),i=i.replace("{COUNTER:03d}",d.toString().padStart(3,"0")),i=i.replace("{COUNTER}",d.toString()),i=i.replace("{GRADE}","Grade1"),i},le=[{id:"profile",label:"Profile",icon:R},{id:"security",label:"Security",icon:C},{id:"notifications",label:"Notifications",icon:Y},{id:"appearance",label:"Appearance",icon:A},...f("MULTI_BRANCH")?[{id:"branches",label:"Branches",icon:H}]:[],...f("FINANCE_MANAGEMENT")?[{id:"portals",label:"Portal Access",icon:q},{id:"portal-passwords",label:"Portal Passwords",icon:U},{id:"portal-users",label:"Portal Users",icon:J}]:[],{id:"admission",label:"Admission",icon:D},{id:"system",label:"System",icon:L}];return e.jsxs("div",{className:"p-4 max-w-7xl mx-auto space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-black text-slate-900 dark:text-white tracking-widest uppercase mb-0.5",children:"Settings"}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400 font-medium tracking-wide",children:"Manage your account and application preferences"})]}),P&&e.jsx("div",{className:`p-4 rounded-xl ${P.type==="success"?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:P.text}),e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-800 p-2",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:le.map(s=>e.jsxs("button",{onClick:()=>F(s.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${m===s.id?"bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-400":"text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[e.jsx(s.icon,{size:16}),s.label]},s.id))})}),m==="profile"&&e.jsx("div",{className:"space-y-6",children:e.jsx(p,{title:"Profile Information",icon:R,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-6 mb-6",children:[e.jsxs("div",{className:"h-20 w-20 rounded-full bg-primary-100 flex items-center justify-center text-primary-700 font-bold text-2xl",children:[_.first_name?.[0]||"U",_.last_name?.[0]||""]}),e.jsxs("div",{children:[e.jsx(h,{variant:"secondary",size:"sm",children:"Change Photo"}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"JPG, PNG or GIF. Max size 2MB"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"First Name",name:"first_name",value:a.first_name,onChange:c}),e.jsx(o,{label:"Last Name",name:"last_name",value:a.last_name,onChange:c})]}),e.jsx(o,{type:"email",label:"Email Address",name:"email",value:a.email,onChange:c}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(h,{onClick:ae,isLoading:w,children:[e.jsx(S,{size:18,className:"mr-2"}),"Save Changes"]})})]})})}),m==="security"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{title:"Change Password",icon:N,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{type:"password",label:"Current Password",name:"current_password",value:a.current_password,onChange:c}),e.jsx(o,{type:"password",label:"New Password",name:"new_password",value:a.new_password,onChange:c}),e.jsx(o,{type:"password",label:"Confirm New Password",name:"confirm_password",value:a.confirm_password,onChange:c}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(h,{onClick:te,isLoading:w,children:[e.jsx(N,{size:18,className:"mr-2"}),"Update Password"]})})]})}),e.jsx(p,{title:"Two-Factor Authentication",icon:C,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:"Enable 2FA"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Add an extra layer of security to your account"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"})]})]})})]}),m==="notifications"&&e.jsx(p,{title:"Notification Preferences",icon:Y,children:e.jsx("div",{className:"space-y-4",children:[{id:"email_notifications",label:"Email Notifications",description:"Receive email updates about important events"},{id:"sms_notifications",label:"SMS Notifications",description:"Get text messages for urgent alerts"},{id:"payment_alerts",label:"Payment Alerts",description:"Notify when payments are received"},{id:"attendance_alerts",label:"Attendance Alerts",description:"Daily attendance summary reports"}].map(s=>e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-slate-100 last:border-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:s.label}),e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"})]})]},s.id))})}),m==="appearance"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{title:"Theme Preferences",icon:A,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-4",children:"Choose Theme"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:()=>{localStorage.setItem("theme","light"),document.documentElement.classList.remove("dark"),l({type:"success",text:"Light theme applied!"}),setTimeout(()=>l(null),2e3)},className:`p-4 border-2 rounded-xl transition-all hover:scale-105 ${localStorage.getItem("theme")==="light"?"border-primary-500 bg-primary-50":"border-slate-200 hover:border-primary-300"}`,children:[e.jsx("div",{className:"h-24 rounded-lg mb-3 bg-white border-2 border-slate-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-lg mx-auto mb-2"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-2 w-16 bg-slate-200 rounded mx-auto"}),e.jsx("div",{className:"h-2 w-12 bg-slate-200 rounded mx-auto"})]})]})}),e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Light"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Clean and bright interface"})]}),e.jsxs("button",{onClick:()=>{localStorage.setItem("theme","dark"),document.documentElement.classList.add("dark"),l({type:"success",text:"Dark theme applied!"}),setTimeout(()=>l(null),2e3)},className:`p-4 border-2 rounded-xl transition-all hover:scale-105 ${!localStorage.getItem("theme")||localStorage.getItem("theme")==="dark"?"border-primary-500 bg-primary-50":"border-slate-200 hover:border-primary-300"}`,children:[e.jsx("div",{className:"h-24 rounded-lg mb-3 bg-slate-900 border-2 border-slate-700 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-lg mx-auto mb-2"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-2 w-16 bg-slate-700 rounded mx-auto"}),e.jsx("div",{className:"h-2 w-12 bg-slate-700 rounded mx-auto"})]})]})}),e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Dark"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Easy on the eyes"})]}),e.jsxs("button",{onClick:()=>{localStorage.setItem("theme","auto"),window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),l({type:"success",text:"Auto theme applied!"}),setTimeout(()=>l(null),2e3)},className:`p-4 border-2 rounded-xl transition-all hover:scale-105 ${localStorage.getItem("theme")==="auto"?"border-primary-500 bg-primary-50":"border-slate-200 hover:border-primary-300"}`,children:[e.jsx("div",{className:"h-24 rounded-lg mb-3 bg-gradient-to-br from-white via-slate-200 to-slate-900 border-2 border-slate-300 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-white/50 backdrop-blur rounded-lg mx-auto mb-2"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-2 w-16 bg-white/70 rounded mx-auto"}),e.jsx("div",{className:"h-2 w-12 bg-white/70 rounded mx-auto"})]})]})}),e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Auto"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Follows system settings"})]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:e.jsx(A,{className:"text-white",size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-900",children:"Current Theme"}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:localStorage.getItem("theme")==="dark"?"Dark Mode":localStorage.getItem("theme")==="auto"?"Auto (System Preference)":"Light Mode"})]})]})})]})}),e.jsx(p,{title:"Accent Color",icon:A,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Choose Accent Color"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:[{name:"Blue",color:"bg-blue-500",value:"blue"},{name:"Green",color:"bg-green-500",value:"green"},{name:"Violet",color:"bg-violet-500",value:"violet"},{name:"Red",color:"bg-red-500",value:"red"},{name:"Orange",color:"bg-orange-500",value:"orange"},{name:"Pink",color:"bg-pink-500",value:"pink"},{name:"Indigo",color:"bg-indigo-500",value:"indigo"},{name:"Teal",color:"bg-teal-500",value:"teal"}].map(({name:s,color:r,value:t})=>e.jsxs("button",{onClick:()=>{localStorage.setItem("accentColor",t),l({type:"success",text:`${s} accent applied!`}),setTimeout(()=>l(null),2e3)},className:"group relative",title:s,children:[e.jsx("div",{className:`w-12 h-12 rounded-full ${r} hover:scale-110 transition-transform shadow-lg ${localStorage.getItem("accentColor")===t?"ring-4 ring-offset-2 ring-slate-400":""}`}),e.jsx("span",{className:"absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs text-slate-600 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:s})]},t))}),e.jsx("p",{className:"text-xs text-slate-500 mt-4",children:"Note: Accent color changes will be applied in future updates"})]})})]}),m==="admission"&&e.jsx(p,{title:"Admission Number Configuration",icon:D,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Format Template"}),e.jsx(o,{name:"admission_number_format",value:a.admission_number_format||"",onChange:c,placeholder:"{SCHOOL_CODE}/{YEAR}/{COUNTER:04d}"}),e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Available placeholders: ",e.jsx("code",{className:"bg-slate-100 px-1 py-0.5 rounded",children:"{SCHOOL_CODE}"}),",",e.jsx("code",{className:"bg-slate-100 px-1 py-0.5 rounded ml-1",children:"{YEAR}"}),",",e.jsx("code",{className:"bg-slate-100 px-1 py-0.5 rounded ml-1",children:"{COUNTER:04d}"}),",",e.jsx("code",{className:"bg-slate-100 px-1 py-0.5 rounded ml-1",children:"{GRADE}"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Admission Fee (",a.default_currency||"KES",")"]}),e.jsx(o,{type:"number",name:"admission_fee",value:a.admission_fee,onChange:c,placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"This one-time fee will be charged to all new students upon registration."})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:e.jsx(D,{className:"text-white",size:20})}),e.jsx("p",{className:"text-sm font-semibold text-blue-900",children:"Live Preview"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 border-2 border-blue-300",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Next Admission Number:"}),e.jsx("div",{className:"font-mono text-2xl font-bold text-blue-700",children:re()})]}),e.jsxs("p",{className:"text-xs text-blue-700 mt-3 flex items-center gap-1",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"This format will be applied to all new student registrations"]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 border border-slate-200",children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-700 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"inline-block w-1 h-4 bg-primary-500 rounded"}),"Format Examples"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200",children:[e.jsxs("code",{className:"text-slate-600 text-sm",children:["{SCHOOL_CODE}","/","{YEAR}","/","{COUNTER:04d}"]}),e.jsx("span",{className:"text-slate-400 mx-3",children:"â†’"}),e.jsx("span",{className:"font-mono text-slate-900 font-semibold",children:"EDU/2024/0001"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200",children:[e.jsxs("code",{className:"text-slate-600 text-sm",children:["{YEAR}","-","{SCHOOL_CODE}","-","{COUNTER:05d}"]}),e.jsx("span",{className:"text-slate-400 mx-3",children:"â†’"}),e.jsx("span",{className:"font-mono text-slate-900 font-semibold",children:"2024-EDU-00001"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200",children:[e.jsxs("code",{className:"text-slate-600 text-sm",children:["{SCHOOL_CODE}","{YEAR}","{COUNTER:03d}"]}),e.jsx("span",{className:"text-slate-400 mx-3",children:"â†’"}),e.jsx("span",{className:"font-mono text-slate-900 font-semibold",children:"EDU2024001"})]})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-amber-900 mb-3",children:"Placeholder Guide:"}),e.jsxs("div",{className:"space-y-2 text-sm text-amber-800",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("code",{className:"bg-amber-100 px-2 py-0.5 rounded font-mono",children:"{SCHOOL_CODE}"}),e.jsx("span",{children:"- Your school's unique code (e.g., EDU, ABC)"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("code",{className:"bg-amber-100 px-2 py-0.5 rounded font-mono",children:"{YEAR}"}),e.jsx("span",{children:"- Current year (e.g., 2024, 2025)"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("code",{className:"bg-amber-100 px-2 py-0.5 rounded font-mono",children:"{COUNTER:04d}"}),e.jsx("span",{children:"- Auto-incrementing number with 4-digit padding (0001, 0002...)"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("code",{className:"bg-amber-100 px-2 py-0.5 rounded font-mono",children:"{GRADE}"}),e.jsx("span",{children:"- Student's grade/class (optional)"})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-slate-200",children:e.jsxs(h,{onClick:O,isLoading:w,children:[e.jsx(S,{size:18,className:"mr-2"}),"Save Admission Format"]})})]})}),m==="portals"&&e.jsx("div",{className:"space-y-6",children:e.jsx(p,{title:"Portal Access Links",icon:q,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-2 border-blue-200 dark:border-blue-800 rounded-2xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:e.jsx(C,{className:"text-white",size:20})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-blue-900 dark:text-blue-100 mb-1",children:"Secure Portal Access"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Each user role has a unique portal link. Share these links with the respective users to grant them access to their dedicated portals. You can regenerate the access code anytime for security purposes."})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{role:"Teachers",icon:"ðŸ‘¨â€ðŸ«",color:"blue",path:"teacher"},{role:"Students",icon:"ðŸŽ“",color:"green",path:"student"},{role:"Accountant",icon:"ðŸ’¼",color:"purple",path:"accountant"},...f("FOOD_MANAGEMENT")?[{role:"Food Manager",icon:"ðŸ½ï¸",color:"orange",path:"food"}]:[],...f("TRANSPORT_MANAGEMENT")?[{role:"Transport Manager",icon:"ðŸšŒ",color:"yellow",path:"transport"},{role:"Drivers",icon:"ðŸš—",color:"red",path:"driver"}]:[]].map(({role:s,icon:r,color:t,path:d})=>{const i=`${window.location.origin}/portal/${a.portal_slug||"loading"}/${d}`;return e.jsxs("div",{className:`bg-white dark:bg-slate-900 rounded-xl border-2 border-${t}-200 dark:border-${t}-800 p-5 hover:shadow-lg transition-all`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`text-3xl bg-${t}-50 dark:bg-${t}-900/20 p-2 rounded-lg`,children:r}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white",children:s}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Portal Access"})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 rounded-lg p-3 mb-3",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Portal Link:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 text-xs font-mono text-slate-700 dark:text-slate-300 truncate",children:i}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(i),l({type:"success",text:`${s} portal link copied!`}),setTimeout(()=>l(null),2e3)},className:`p-2 bg-${t}-500 hover:bg-${t}-600 text-white rounded-lg transition-colors`,title:"Copy link",children:e.jsx(ne,{size:14})})]})]}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Share this link with ",s.toLowerCase()," to access their portal"]})]},s)})}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500 rounded-lg",children:e.jsx(M,{className:"text-white",size:20})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-amber-900 dark:text-amber-100 mb-1",children:"Regenerate Access Code"}),e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mb-3",children:["Current Code: ",e.jsx("code",{className:"bg-amber-100 dark:bg-amber-900/40 px-2 py-1 rounded font-mono font-bold",children:a.portal_slug||"Not set"})]}),e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Regenerating will invalidate all existing portal links. You'll need to share the new links with all users."})]})]}),e.jsxs(h,{variant:"secondary",size:"sm",onClick:async()=>{if(window.confirm("Are you sure? This will change all portal access links."))try{u(!0);const s=await b.post("/api/config/regenerate-portal/");s.data.success&&(v(r=>({...r,portal_slug:s.data.portal_slug})),l({type:"success",text:s.data.message}))}catch(s){l({type:"error",text:s.response?.data?.error||"Failed to regenerate"})}finally{u(!1),setTimeout(()=>l(null),5e3)}},isLoading:w,children:[e.jsx(M,{size:16,className:"mr-2"}),"Regenerate"]})]})})]})})}),m==="portal-passwords"&&e.jsx("div",{className:"space-y-6",children:e.jsx(p,{title:"Portal Authentication Settings",icon:U,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4 flex gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg h-fit text-white",children:e.jsx(C,{size:18})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-blue-900 dark:text-blue-100",children:"Portal User Credentials"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Except for students who use their ",e.jsx("strong",{children:"Admission Numbers"})," as usernames, all other portal users use their ",e.jsx("strong",{children:"Email Addresses"})," as usernames. Set the default access passwords for each portal role below."]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white border-b pb-2",children:"Academic & Student Portals"}),e.jsx(o,{label:"Teacher Portal Password",name:"teacher_portal_password",type:"text",value:a.teacher_portal_password,onChange:c,placeholder:"Set password for teachers",icon:N}),e.jsx(o,{label:"Student Portal Password",name:"student_portal_password",type:"text",value:a.student_portal_password,onChange:c,placeholder:"Set password for students",icon:N})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white border-b pb-2",children:"Finance & Operations Portals"}),e.jsx(o,{label:"Accountant Portal Password",name:"accountant_portal_password",type:"text",value:a.accountant_portal_password,onChange:c,placeholder:"Set password for accountants",icon:N}),f("FOOD_MANAGEMENT")&&e.jsx(o,{label:"Food Manager Portal Password",name:"food_portal_password",type:"text",value:a.food_portal_password,onChange:c,placeholder:"Set password for food managers",icon:N})]}),f("TRANSPORT_MANAGEMENT")&&e.jsxs("div",{className:"space-y-4 md:col-span-2",children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white border-b pb-2",children:"Transport & Logistics Portals"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Transport Manager Password",name:"transport_portal_password",type:"text",value:a.transport_portal_password,onChange:c,placeholder:"Set password for transport managers",icon:N}),e.jsx(o,{label:"Driver Portal Password",name:"driver_portal_password",type:"text",value:a.driver_portal_password,onChange:c,placeholder:"Set password for drivers",icon:N})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-slate-100 dark:border-slate-800",children:e.jsxs(h,{onClick:O,isLoading:w,children:[e.jsx(S,{size:18,className:"mr-2"}),"Save Portal Passwords"]})})]})})}),m==="portal-users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{title:"Create Portal User",icon:J,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4 flex gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500 rounded-lg h-fit text-white",children:e.jsx(U,{size:18})}),e.jsxs("div",{className:"text-sm text-amber-800 dark:text-amber-200",children:[e.jsx("p",{className:"font-bold mb-1",children:"Password Connection"}),e.jsxs("p",{children:["New users will be created with the password: ",e.jsx("strong",{className:"bg-amber-100 dark:bg-amber-900/40 px-2 py-0.5 rounded font-mono",children:n.position==="ACCOUNTANT"?a.accountant_portal_password:n.position==="FOOD_MANAGER"?a.food_portal_password:a.transport_portal_password})]}),e.jsxs("p",{className:"mt-1",children:["You can change this default in the ",e.jsx("strong",{className:"cursor-pointer underline",onClick:()=>F("portal-passwords"),children:"Portal Passwords"})," tab."]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"First Name",value:n.first_name,onChange:s=>j({...n,first_name:s.target.value}),placeholder:"Enter first name",required:!0}),e.jsx(o,{label:"Last Name",value:n.last_name,onChange:s=>j({...n,last_name:s.target.value}),placeholder:"Enter last name"}),e.jsx(o,{label:"Email Address",type:"email",value:n.email,onChange:s=>j({...n,email:s.target.value}),placeholder:"user@example.com",required:!0,icon:de}),e.jsx(o,{label:"Phone Number",value:n.phone,onChange:s=>j({...n,phone:s.target.value}),placeholder:"+254..."}),e.jsx(o,{label:"National ID",value:n.national_id,onChange:s=>j({...n,national_id:s.target.value}),placeholder:"ID Number",required:!0}),e.jsx(o,{label:"Date of Birth",type:"date",value:n.date_of_birth,onChange:s=>j({...n,date_of_birth:s.target.value}),required:!0}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Role/Position"}),e.jsxs("select",{className:"w-full h-10 px-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm",value:n.position,onChange:s=>j({...n,position:s.target.value}),children:[e.jsx("option",{value:"ACCOUNTANT",children:"Accountant (Finance Portal)"}),f("FOOD_MANAGEMENT")&&e.jsx("option",{value:"FOOD_MANAGER",children:"Food Manager (Food Portal)"}),f("TRANSPORT_MANAGEMENT")&&e.jsx("option",{value:"TRANSPORT_MANAGER",children:"Transport Manager (Transport Portal)"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(h,{onClick:Z,isLoading:w,children:[e.jsx(K,{size:18,className:"mr-2"}),"Create User Account"]})})]})}),e.jsx(p,{title:"Existing Portal Users",icon:R,children:X?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(M,{className:"animate-spin text-primary-600",size:24})}):B.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:"No portal users created yet"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:[e.jsx("th",{className:"py-3 px-4 font-semibold text-sm text-slate-700 dark:text-slate-300",children:"Name"}),e.jsx("th",{className:"py-3 px-4 font-semibold text-sm text-slate-700 dark:text-slate-300",children:"Email"}),e.jsx("th",{className:"py-3 px-4 font-semibold text-sm text-slate-700 dark:text-slate-300",children:"Role"}),e.jsx("th",{className:"py-3 px-4 font-semibold text-sm text-slate-700 dark:text-slate-300",children:"Status"})]})}),e.jsx("tbody",{children:B.map(s=>e.jsxs("tr",{className:"border-b border-slate-50 dark:border-slate-800/50 last:border-0",children:[e.jsxs("td",{className:"py-3 px-4 text-sm text-slate-900 dark:text-white font-medium",children:[s.first_name," ",s.last_name]}),e.jsx("td",{className:"py-3 px-4 text-sm text-slate-500 dark:text-slate-400",children:s.email}),e.jsx("td",{className:"py-3 px-4 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.position==="ACCOUNTANT"?"bg-purple-100 text-purple-700 dark:bg-purple-900/30":s.position==="FOOD_MANAGER"?"bg-orange-100 text-orange-700 dark:bg-orange-900/30":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30"}`,children:s.position.replace("_"," ")})}),e.jsx("td",{className:"py-3 px-4 text-sm",children:e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(ie,{size:14}),"Active"]})})]},s.id))})]})})})]}),m==="system"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{title:"School Information",icon:ce,children:V?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary-600"}),e.jsx("p",{className:"text-sm font-medium text-slate-500",children:"Loading school configuration..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-6 pb-6 border-b border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"h-24 w-24 rounded-2xl bg-slate-100 dark:bg-slate-800 border-2 border-dashed border-slate-300 dark:border-slate-700 flex items-center justify-center overflow-hidden transition-all group-hover:border-primary-500",children:a.school_logo_preview||a.school_logo?e.jsx("img",{src:a.school_logo_preview||a.school_logo,alt:"School Logo",className:"h-full w-full object-contain"}):e.jsx(me,{className:"text-slate-400",size:32})}),e.jsxs("label",{className:"absolute -bottom-2 -right-2 p-2 bg-primary-600 hover:bg-primary-700 text-white rounded-xl shadow-lg cursor-pointer transition-all hover:scale-110",children:[e.jsx(pe,{size:14}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:s=>{const r=s.target.files[0];if(r){const t=new FileReader;t.onloadend=()=>{v(d=>({...d,school_logo_file:r,school_logo_preview:t.result}))},t.readAsDataURL(r)}}})]})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white",children:"Institution Logo"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1 max-w-xs",children:"This logo will appear on all sidebars, login pages, and official receipts. Recommended size: 512x512px."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{label:"School Name",name:"school_name",value:a.school_name||"",onChange:c}),e.jsx(o,{label:"School Code",name:"school_code",value:a.school_code||"",onChange:c}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Phone Number",name:"school_phone",value:a.school_phone||"",onChange:c}),e.jsx(o,{type:"email",label:"School Email",name:"school_email",value:a.school_email||"",onChange:c})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:"School Address"}),e.jsx("textarea",{name:"school_address",value:a.school_address||"",onChange:c,className:"w-full px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all outline-none min-h-[100px]",placeholder:"Enter school physical address..."})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(h,{onClick:O,children:[e.jsx(S,{size:18,className:"mr-2"}),"Save Changes"]})})]})]})}),e.jsx(p,{title:"Database & Backup",icon:L,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-slate-100",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:"Automatic Backups"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Daily database backups at 2:00 AM"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(h,{variant:"secondary",children:[e.jsx(L,{size:18,className:"mr-2"}),"Backup Now"]})})]})})]}),m==="branches"&&e.jsx("div",{className:"space-y-6",children:e.jsx(p,{title:"Manage Branches",icon:H,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700",children:[e.jsx(o,{placeholder:"Branch Name",value:g.name,onChange:s=>k({...g,name:s.target.value})}),e.jsx(o,{placeholder:"Address (Optional)",value:g.address,onChange:s=>k({...g,address:s.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{placeholder:"Phone (Optional)",value:g.phone,onChange:s=>k({...g,phone:s.target.value})}),e.jsx(h,{onClick:ee,disabled:!g.name,children:e.jsx(K,{size:18})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-slate-900 dark:text-white",children:"Existing Branches"}),z.length===0?e.jsx("p",{className:"text-slate-500 italic",children:"No branches added yet."}):e.jsx("div",{className:"grid gap-3",children:z.map(s=>e.jsxs("div",{className:"flex justify-between items-center p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white",children:s.name}),e.jsxs("div",{className:"flex gap-4 text-sm text-slate-500",children:[s.address&&e.jsx("span",{children:s.address}),s.phone&&e.jsx("span",{children:s.phone})]})]}),e.jsx(h,{variant:"ghost",className:"text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:()=>se(s.id),children:e.jsx(xe,{size:18})})]},s.id))})]})]})})})]})};export{ge as default};

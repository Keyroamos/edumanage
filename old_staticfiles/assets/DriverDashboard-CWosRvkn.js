import{r,e as m,j as e}from"./vendor-Cr6tcs86.js";import{M as N,T as k,a as v,P as w,L as h,i as y,b as z}from"./marker-shadow-DBlRTYcO.js";import{T as P,aA as S,V as l,a3 as A}from"./ui-kKL2mqtN.js";let M=h.icon({iconUrl:z,shadowUrl:y,iconSize:[25,41],iconAnchor:[12,41]});h.Marker.prototype.options.icon=M;const T=()=>{const[s,p]=r.useState(null),[g,b]=r.useState(!0),[n,f]=r.useState(null);r.useEffect(()=>{d()},[]);const d=async()=>{try{const t=await m.get("/api/transport/driver/dashboard/");p(t.data)}catch(t){console.error(t),f(t.response?.data?.error||"Failed to load dashboard. Ensure you are assigned a vehicle.")}finally{b(!1)}};if(g)return e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-indigo-600 border-t-transparent"})});if(n)return e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center text-red-500 mb-4",children:e.jsx(P,{size:32})}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-2",children:"Access Error"}),e.jsx("p",{className:"text-slate-500",children:n})]});const c=t=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}window.confirm("Are you at the student's pickup point right now? This will save your current GPS location.")&&navigator.geolocation.getCurrentPosition(async i=>{try{const{latitude:o,longitude:j}=i.coords;await m.post(`/api/transport/student/${t}/location/update/`,{lat:o,lng:j}),alert("Location saved successfully!"),d()}catch(o){console.error(o),alert("Failed to save location. Please try again.")}},i=>{console.error(i),alert("Unable to retrieve location. Please enable GPS permissions.")},{enableHighAccuracy:!0})},a=(s?.students||[]).filter(t=>t.lat&&t.lng&&(t.lat!==0||t.lng!==0)),u=a.length>0?[a[0].lat,a[0].lng]:[-1.2921,36.8219];return e.jsxs("div",{className:"space-y-6 pb-20 animate-fade-in-up",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-lg border border-slate-100 dark:border-slate-700 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-indigo-50 dark:bg-indigo-900/20 rounded-full blur-3xl -mr-10 -mt-10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("p",{className:"text-xs font-bold text-indigo-500 uppercase tracking-wider mb-2",children:"Assigned Vehicle"}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-1 font-mono tracking-tight",children:s?.vehicle?.plate||"N/A"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-medium",children:s?.vehicle?.model||"Unknown Model"})]}),e.jsx("div",{className:"flex flex-col items-end gap-1",children:e.jsxs("span",{className:"px-3 py-1 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 rounded-full text-xs font-bold",children:[s?.vehicle?.capacity||0," Seats"]})})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 dark:border-slate-700 flex items-center gap-2 text-slate-700 dark:text-slate-300",children:[e.jsx(S,{size:18,className:"text-indigo-500"}),e.jsx("span",{className:"font-bold",children:s?.route?.name||"Unassigned Route"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-lg border border-slate-100 dark:border-slate-700 overflow-hidden h-[400px] z-0 relative",children:[a.length>0?e.jsxs(N,{center:u,zoom:13,style:{height:"100%",width:"100%"},children:[e.jsx(k,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),a.map(t=>e.jsx(v,{position:[t.lat,t.lng],children:e.jsx(w,{children:e.jsxs("div",{className:"text-center min-w-[150px]",children:[e.jsx("b",{className:"block mb-1 text-sm",children:t.name}),e.jsx("span",{className:"text-xs text-slate-500 block",children:t.pickup_point}),t.phone!=="N/A"&&e.jsx("a",{href:`tel:${t.phone}`,className:"inline-block mt-2 text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-md font-bold",children:"Call Parent"})]})})},t.id))]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400 p-6 text-center bg-slate-50 dark:bg-slate-900/50",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-200 dark:bg-slate-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(l,{size:32,className:"opacity-50"})}),e.jsx("p",{className:"font-medium text-slate-600 dark:text-slate-300",children:"No GPS coordinates found"}),e.jsx("p",{className:"text-sm mt-1 mb-4",children:"Use the list below to set pickup locations."})]}),e.jsxs("div",{className:"absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-bold shadow-sm z-[400]",children:[a.length," Markers"]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-900 dark:text-white px-1 mb-4 flex items-center gap-2",children:[e.jsx(l,{size:20,className:"text-indigo-600"}),"Pickup List (",(s?.students||[]).length,")"]}),e.jsx("div",{className:"space-y-3",children:(s?.students||[]).map((t,x)=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 flex flex-col sm:flex-row sm:items-center gap-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-50 dark:bg-indigo-900/30 flex items-center justify-center font-bold text-indigo-600 dark:text-indigo-400 text-lg shadow-inner shrink-0",children:x+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white truncate",children:t.name}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 flex items-start gap-1 mt-0.5",children:[e.jsx(l,{size:14,className:"mt-0.5 shrink-0"}),e.jsx("span",{className:"truncate",children:t.pickup_point||"No point set"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pl-16 sm:pl-0",children:[!t.lat||!t.lng?e.jsxs("button",{onClick:()=>c(t.id),className:"flex items-center gap-1.5 px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-xs font-bold transition-colors shadow-sm",children:[e.jsx(l,{size:14}),"Set Location"]}):e.jsx("button",{onClick:()=>c(t.id),className:"flex items-center gap-1.5 px-3 py-2 bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 rounded-xl text-xs font-bold transition-colors",children:"Update"}),t.phone!=="N/A"&&e.jsx("a",{href:`tel:${t.phone}`,className:"w-10 h-10 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 rounded-xl flex items-center justify-center hover:bg-emerald-200 dark:hover:bg-emerald-900/50 transition-colors shadow-sm",children:e.jsx(A,{size:20})})]})]},t.id))})]})]})};export{T as default};

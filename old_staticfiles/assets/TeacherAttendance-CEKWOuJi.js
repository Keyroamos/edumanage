import{k as Z,r as l,e as g,j as e,A as G,m as T}from"./vendor-Cr6tcs86.js";import{aT as H,b as V,C as Y,U as q,x as v,_ as w,a9 as J,k as K,aU as W,z as I,Z as ee,r as z,P as se}from"./ui-kKL2mqtN.js";const re=()=>{const{id:N}=Z(),[d,L]=l.useState(null),[o,P]=l.useState([]),[R,D]=l.useState(!0),[$,k]=l.useState(!1),[b,y]=l.useState(!1),[n,B]=l.useState(new Date().toISOString().split("T")[0]),[f,M]=l.useState(""),[u,S]=l.useState("grid"),[O,ae]=l.useState(!0),[r,c]=l.useState({});l.useEffect(()=>{U()},[N]),l.useEffect(()=>{d?.professional?.grade_id&&o.length>0&&E(d.professional.grade_id,n,o)},[n]);const U=async()=>{try{const s=await g.get(`/api/teachers/${N}/`);L(s.data.teacher),s.data.teacher.professional.is_class_teacher&&s.data.teacher.professional.grade_id&&F(s.data.teacher.professional.grade_id)}catch(s){console.error("Error fetching teacher:",s)}finally{D(!1)}},F=async s=>{try{k(!0);const a=await g.get(`/api/students/?grade=${s}`);P(a.data.students),await E(s,n,a.data.students)}catch(a){console.error("Error fetching students:",a)}finally{k(!1)}},E=async(s,a,t)=>{try{const h=(await g.get(`/api/grades/${s}/attendance/?date=${a}`)).data.attendance||{},p={};t.forEach(_=>{const j=h[_.id];p[_.id]={status:j?j.status:"PRESENT",remarks:j?.remarks||""}}),c(p)}catch(x){console.error("Error fetching attendance:",x);const h={};t.forEach(p=>{h[p.id]={status:"PRESENT",remarks:""}}),c(h)}},m=(s,a)=>{c(t=>({...t,[s]:{...t[s],status:a}}))},A=(s,a)=>{c(t=>({...t,[s]:{...t[s],remarks:a}}))},Q=async()=>{if(d?.professional?.grade_id)try{y(!0);const s=Object.entries(r).map(([t,x])=>({student_id:parseInt(t),status:x.status,remarks:x.remarks,date:n,grade_id:d.professional.grade_id}));await g.post("/api/attendance/mark/batch/",{attendance:s,date:n,recorded_by:d.id});const a=document.createElement("div");a.className="fixed top-4 right-4 bg-emerald-500 text-white px-6 py-3 rounded-xl shadow-lg z-50 flex items-center gap-2",a.innerHTML='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><span class="font-semibold">Attendance saved successfully!</span>',document.body.appendChild(a),setTimeout(()=>a.remove(),3e3)}catch(s){console.error("Error saving attendance:",s),alert("Failed to save attendance. Please try again.")}finally{y(!1)}},X=s=>{const a={};o.forEach(t=>{a[t.id]={status:s,remarks:r[t.id]?.remarks||""}}),c(a)},C=o.filter(s=>s.full_name?.toLowerCase().includes(f.toLowerCase())||s.admission_number?.toLowerCase().includes(f.toLowerCase())),i={total:o.length,present:Object.values(r).filter(s=>s.status==="PRESENT").length,absent:Object.values(r).filter(s=>s.status==="ABSENT").length,late:Object.values(r).filter(s=>s.status==="LATE").length};return i.attendanceRate=i.total>0?(i.present/i.total*100).toFixed(1):0,R?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-primary-200 border-t-primary-600"}),e.jsx("p",{className:"text-slate-500 font-medium",children:"Loading..."})]})}):!d||!d.professional.is_class_teacher?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[80vh] text-center p-8",children:[e.jsx("div",{className:"bg-gradient-to-br from-rose-100 to-pink-100 dark:from-rose-900/20 dark:to-pink-900/20 p-12 rounded-3xl mb-6",children:e.jsx(H,{size:80,className:"text-rose-500"})}),e.jsx("h2",{className:"text-3xl font-black text-slate-900 dark:text-white mb-3",children:"Access Restricted"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 max-w-md mx-auto text-lg",children:"You must be assigned as a Class Teacher to mark attendance."})]}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 pb-32 font-sans",children:[e.jsxs("div",{className:"bg-slate-900 border-b border-slate-800 pb-12 pt-6 px-4 md:px-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-primary-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"}),e.jsxs("div",{className:"max-w-7xl mx-auto relative z-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center gap-4 md:gap-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 md:h-14 md:w-14 bg-gradient-to-br from-primary-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shadow-primary-500/20 ring-4 ring-slate-800 shrink-0",children:e.jsx(V,{size:24,"md:size":28,className:"text-white"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-black text-white flex items-center gap-2 tracking-tight",children:["Attendance",d?.professional?.grade_assigned&&e.jsx("span",{className:"px-2 py-0.5 rounded-lg bg-slate-800 border border-slate-700 text-primary-400 text-xs font-bold",children:d.professional.grade_assigned})]}),e.jsx("p",{className:"text-slate-400 font-medium text-sm md:text-base mt-1",children:new Date(n).toLocaleDateString(void 0,{weekday:"long",day:"numeric",month:"long"})})]})]})}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-800/50 backdrop-blur-md p-2.5 rounded-xl border border-slate-700/50 w-full md:w-auto",children:[e.jsx(Y,{size:18,className:"text-primary-400 shrink-0"}),e.jsx("input",{type:"date",value:n,onChange:s=>B(s.target.value),className:"bg-transparent border-none text-slate-200 focus:ring-0 font-semibold cursor-pointer text-sm w-full"})]})]}),e.jsx(G,{children:O&&e.jsxs(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4",children:[e.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700/50 relative overflow-hidden group",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-500/20 rounded-lg text-blue-400",children:e.jsx(q,{size:16})}),e.jsx("p",{className:"text-[10px] font-bold text-blue-300 uppercase tracking-wider",children:"Students"})]}),e.jsx("p",{className:"text-2xl font-black text-white",children:i.total})]})}),e.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700/50 relative overflow-hidden group",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-emerald-500/20 rounded-lg text-emerald-400",children:e.jsx(v,{size:16})}),e.jsx("p",{className:"text-[10px] font-bold text-emerald-300 uppercase tracking-wider",children:"Present"})]}),e.jsx("p",{className:"text-2xl font-black text-white",children:i.present})]})}),e.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700/50 relative overflow-hidden group",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-rose-500/20 rounded-lg text-rose-400",children:e.jsx(w,{size:16})}),e.jsx("p",{className:"text-[10px] font-bold text-rose-300 uppercase tracking-wider",children:"Absent"})]}),e.jsx("p",{className:"text-2xl font-black text-white",children:i.absent})]})}),e.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700/50 relative overflow-hidden group",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-amber-500/20 rounded-lg text-amber-400",children:e.jsx(J,{size:16})}),e.jsx("p",{className:"text-[10px] font-bold text-amber-300 uppercase tracking-wider",children:"Rate"})]}),e.jsxs("p",{className:"text-2xl font-black text-white",children:[i.attendanceRate,"%"]})]})})]})})]})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-6 -mt-6 relative z-20",children:[e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-xl shadow-xl shadow-slate-200/50 dark:shadow-black/20 border border-slate-200 dark:border-slate-800 p-3 mb-4 md:mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(K,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search students...",value:f,onChange:s=>M(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-100 dark:bg-slate-800/50 border-none rounded-lg text-sm focus:ring-2 focus:ring-primary-500 text-slate-900 dark:text-white placeholder-slate-500"})]}),e.jsxs("div",{className:"flex items-center justify-between md:justify-end gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>S("grid"),className:`p-2 rounded-lg transition-all ${u==="grid"?"bg-slate-800 text-white shadow-md":"text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800"}`,children:e.jsx(W,{size:18})}),e.jsx("button",{onClick:()=>S("list"),className:`p-2 rounded-lg transition-all ${u==="list"?"bg-slate-800 text-white shadow-md":"text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800"}`,children:e.jsx(I,{size:18})})]}),e.jsxs("button",{onClick:()=>X("PRESENT"),className:"px-3 py-2 bg-emerald-500 text-white text-xs md:text-sm font-bold rounded-lg hover:bg-emerald-600 transition-colors shadow-lg shadow-emerald-500/20 flex items-center gap-1.5",children:[e.jsx(ee,{size:16}),"Mark All Present"]})]})]})}),$?e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-slate-200 border-t-primary-600 mb-4"}),e.jsx("p",{className:"text-slate-500 font-medium",children:"Loading class list..."})]}):u==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:C.map((s,a)=>e.jsxs(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.02},className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4 shadow-sm hover:shadow-md transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs("div",{className:"h-10 w-10 shrink-0 rounded-lg bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500 dark:text-slate-400 font-bold text-lg group-hover:bg-primary-50 dark:group-hover:bg-primary-900/20 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors",children:[s.first_name?s.first_name[0]:(s.full_name||"?")[0],s.last_name?s.last_name[0]:(s.full_name?.split(" ")[1]||"")[0]]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white text-sm truncate",children:s.full_name}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-mono truncate",children:s.admission_number})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>m(s.id,"PRESENT"),className:`py-2 rounded-lg flex flex-col items-center justify-center gap-1 transition-all touch-manipulation ${r[s.id]?.status==="PRESENT"?"bg-emerald-500 text-white shadow-md shadow-emerald-500/25 ring-2 ring-emerald-500 ring-offset-2 dark:ring-offset-slate-900":"bg-slate-50 dark:bg-slate-800 text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:[e.jsx(v,{size:18}),e.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Present"})]}),e.jsxs("button",{onClick:()=>m(s.id,"LATE"),className:`py-2 rounded-lg flex flex-col items-center justify-center gap-1 transition-all touch-manipulation ${r[s.id]?.status==="LATE"?"bg-amber-500 text-white shadow-md shadow-amber-500/25 ring-2 ring-amber-500 ring-offset-2 dark:ring-offset-slate-900":"bg-slate-50 dark:bg-slate-800 text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:[e.jsx(z,{size:18}),e.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Late"})]}),e.jsxs("button",{onClick:()=>m(s.id,"ABSENT"),className:`py-2 rounded-lg flex flex-col items-center justify-center gap-1 transition-all touch-manipulation ${r[s.id]?.status==="ABSENT"?"bg-rose-500 text-white shadow-md shadow-rose-500/25 ring-2 ring-rose-500 ring-offset-2 dark:ring-offset-slate-900":"bg-slate-50 dark:bg-slate-800 text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:[e.jsx(w,{size:18}),e.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Absent"})]})]}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"text",placeholder:"Add remark...",value:r[s.id]?.remarks||"",onChange:t=>A(s.id,t.target.value),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border-none rounded-lg text-xs focus:ring-1 focus:ring-primary-500 text-slate-700 dark:text-slate-300 placeholder-slate-400 transition-all"})})]},s.id))}):e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden shadow-sm",children:e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:C.map(s=>e.jsxs("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"h-10 w-10 shrink-0 rounded-lg bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500 text-xs font-bold",children:[s.first_name?.[0],s.last_name?.[0]]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-slate-900 dark:text-white",children:s.full_name}),e.jsx("p",{className:"text-xs text-slate-500 font-mono",children:s.admission_number})]})]}),e.jsx("div",{className:"flex gap-2 self-start sm:self-auto w-full sm:w-auto overflow-x-auto pb-1 sm:pb-0 hide-scrollbar",children:["PRESENT","LATE","ABSENT"].map(a=>e.jsxs("button",{onClick:()=>m(s.id,a),className:`flex-1 sm:flex-none px-3 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1.5 transition-all w-24 sm:w-auto shrink-0 ${r[s.id]?.status===a?a==="PRESENT"?"bg-emerald-500 text-white":a==="LATE"?"bg-amber-500 text-white":"bg-rose-500 text-white":"bg-slate-100 dark:bg-slate-800 text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:[a==="PRESENT"?e.jsx(v,{size:14}):a==="LATE"?e.jsx(z,{size:14}):e.jsx(w,{size:14}),a==="PRESENT"?"Present":a==="LATE"?"Late":"Absent"]},a))})]}),e.jsx("input",{type:"text",placeholder:"Add remark...",value:r[s.id]?.remarks||"",onChange:a=>A(s.id,a.target.value),className:"mt-3 w-full px-3 py-2 bg-slate-50 dark:bg-slate-800/50 border-none rounded-lg text-xs text-slate-700 dark:text-slate-300"})]},s.id))})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-40 p-4 pointer-events-none",children:e.jsxs("div",{className:"max-w-xl mx-auto bg-slate-900/90 backdrop-blur-xl border border-slate-700 text-white p-3 rounded-2xl shadow-2xl flex flex-col xs:flex-row items-center justify-between gap-3 pointer-events-auto",children:[e.jsxs("div",{className:"flex w-full xs:w-auto items-center justify-around xs:justify-start gap-4 xs:gap-6 text-xs pl-2",children:[e.jsxs("div",{className:"flex flex-col xs:flex-row items-center gap-1 xs:gap-2",children:[e.jsx("span",{className:"text-slate-400 hidden xs:inline",children:"Present"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500 block"}),e.jsx("span",{className:"font-bold text-white text-base",children:i.present})]}),e.jsx("span",{className:"text-[10px] text-slate-500 xs:hidden",children:"Present"})]}),e.jsx("div",{className:"h-4 w-px bg-slate-700 hidden xs:block"}),e.jsxs("div",{className:"flex flex-col xs:flex-row items-center gap-1 xs:gap-2",children:[e.jsx("span",{className:"text-slate-400 hidden xs:inline",children:"Absent"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-rose-500 block"}),e.jsx("span",{className:"font-bold text-white text-base",children:i.absent})]}),e.jsx("span",{className:"text-[10px] text-slate-500 xs:hidden",children:"Absent"})]}),e.jsx("div",{className:"h-4 w-px bg-slate-700 hidden xs:block"}),e.jsxs("div",{className:"flex flex-col xs:flex-row items-center gap-1 xs:gap-2",children:[e.jsx("span",{className:"text-slate-400 hidden xs:inline",children:"Late"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-amber-500 block"}),e.jsx("span",{className:"font-bold text-white text-base",children:i.late})]}),e.jsx("span",{className:"text-[10px] text-slate-500 xs:hidden",children:"Late"})]})]}),e.jsxs("button",{onClick:Q,disabled:b,className:"w-full xs:w-auto bg-primary-600 hover:bg-primary-500 text-white px-6 py-2.5 rounded-xl font-bold text-sm shadow-lg shadow-primary-900/50 flex items-center justify-center gap-2 transition-all active:scale-95 disabled:opacity-50",children:[b?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(se,{size:18}),b?"Saving...":"Save"]})]})})]})};export{re as default};

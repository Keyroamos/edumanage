import{k as K,u as U,r as t,e as o,j as e}from"./vendor-Cr6tcs86.js";import{B as y}from"./index-eBdLMQe5.js";import{q as F,aj as H,w as _,n as p,ad as G,$ as S,aB as i,K as O,D as q,a6 as A,X as C,i as W}from"./ui-kKL2mqtN.js";import{R as V,A as X,T as J,a as Q}from"./charts-Fmv3L88u.js";const re=()=>{const{id:r}=K(),T=U(),[u,E]=t.useState(null),[P,M]=t.useState(!0),[Z,ee]=t.useState("overview"),[z,c]=t.useState(!1),[D,d]=t.useState(!1),[g,f]=t.useState(""),[j,B]=t.useState("CASH"),[N,k]=t.useState(""),[l,v]=t.useState("PAYMENT"),[x,w]=t.useState("");t.useEffect(()=>{n()},[r]);const n=async()=>{try{const s=await o.get(`/api/food/students/${r}/`);E(s.data)}catch(s){console.error(s)}finally{M(!1)}},R=async s=>{s.preventDefault();try{await o.post(`/api/food/students/${r}/`,{action:"TRANSACTION",type:l,amount:parseFloat(g),method:j,description:N||(l==="PAYMENT"?"Payment Received":"Manual Charge")}),c(!1),f(""),k(""),n()}catch{alert("Transaction failed")}},$=async()=>{try{await o.post(`/api/food/students/${r}/`,{action:"SUBSCRIBE",meal_item_id:x}),d(!1),w(""),n()}catch{alert("Subscription failed")}},Y=async s=>{if(confirm("Are you sure you want to cancel this subscription?"))try{await o.post(`/api/food/students/${r}/`,{action:"UNSUBSCRIBE",subscription_id:s}),n()}catch{alert("Failed to unsubscribe")}};if(P)return e.jsx("div",{className:"h-screen flex items-center justify-center bg-slate-50 dark:bg-slate-900",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 animate-pulse",children:"Loading student profile..."})]})});if(!u)return e.jsx("div",{className:"p-8 text-center text-slate-500",children:"Student not found"});const{student:a,transactions:m,subscriptions:h,available_items:L}=u,I=[...m].reverse().map((s,b)=>({name:`Tx ${b+1}`,amount:s.type==="PAYMENT"?s.amount:-s.amount,type:s.type,date:s.date}));return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 pb-20 animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>T("/food-portal/students"),className:"flex items-center text-slate-500 hover:text-orange-600 transition-colors group",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 p-2 rounded-full border border-slate-200 dark:border-slate-700 mr-2 group-hover:border-orange-200 shadow-sm",children:e.jsx(F,{size:16})}),e.jsx("span",{className:"font-medium",children:"Back to Students"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors shadow-sm",children:[e.jsx(H,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Statement"})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors shadow-sm",children:[e.jsx(_,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 md:p-8 shadow-xl shadow-slate-200/50 dark:shadow-none border border-slate-100 dark:border-slate-700 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-orange-50 dark:bg-orange-900/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 items-start relative z-10",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[a.photo?e.jsx("img",{src:a.photo,alt:a.name,className:"w-32 h-32 rounded-2xl object-cover shadow-lg border-4 border-white dark:border-slate-700"}):e.jsx("div",{className:"w-32 h-32 rounded-2xl bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-400 shadow-lg border-4 border-white dark:border-slate-700",children:e.jsx(p,{size:48})}),e.jsx("div",{className:"absolute -bottom-3 -right-3 bg-emerald-500 text-white p-2 rounded-xl shadow-lg border-4 border-white dark:border-slate-800",children:e.jsx(G,{size:20})})]})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"inline-block px-3 py-1 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs font-bold uppercase tracking-wider rounded-lg mb-2",children:"Student Profile"}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-slate-900 dark:text-white",children:a.name}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-3 text-slate-500 dark:text-slate-400 text-sm font-medium",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(p,{size:16})," ADM: ",a.adm]}),e.jsx("span",{className:"w-1 h-1 bg-slate-300 rounded-full self-center"}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(p,{size:16})," Grade: ",a.grade]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>c(!0),className:"px-6 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold shadow-lg shadow-emerald-600/20 active:scale-95 transition-all flex items-center gap-2",children:[e.jsx(S,{size:18})," Add Funds / Pay"]}),e.jsxs("button",{onClick:()=>d(!0),className:"px-6 py-2.5 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-600 text-slate-700 dark:text-white rounded-xl font-bold shadow-sm transition-all flex items-center gap-2",children:[e.jsx(i,{size:18})," Add Meal Plan"]})]})]}),e.jsx("div",{className:"w-full md:w-auto min-w-[240px] space-y-3",children:e.jsxs("div",{className:"p-5 bg-slate-50 dark:bg-slate-900/50 rounded-2xl border border-slate-100 dark:border-slate-700 text-center",children:[e.jsx("p",{className:"text-xs uppercase font-bold text-slate-400 mb-1 tracking-wider",children:"Available Balance"}),e.jsxs("div",{className:`text-4xl font-black font-mono tracking-tight ${a.balance>0?"text-red-500":"text-emerald-500"}`,children:[e.jsx("span",{className:"text-lg text-slate-400 mr-1",children:"KES"}),Math.abs(a.balance).toLocaleString()]}),e.jsx("p",{className:`text-xs font-bold mt-2 ${a.balance>0?"text-red-500 bg-red-50 dark:bg-red-900/20 py-1 px-2 rounded-full inline-block":"text-emerald-500 bg-emerald-50 dark:bg-emerald-900/20 py-1 px-2 rounded-full inline-block"}`,children:a.balance>0?"Outstanding Debt":"In Credit / Paid"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-sm border border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(i,{size:20,className:"text-orange-500"}),"Active Plans"]}),e.jsxs("span",{className:"text-xs font-bold bg-orange-100 text-orange-700 px-2 py-1 rounded-full",children:[h.length," Active"]})]}),e.jsxs("div",{className:"space-y-3",children:[h.map(s=>e.jsx("div",{className:"p-4 bg-orange-50/50 dark:bg-slate-700/30 rounded-2xl border border-orange-100 dark:border-slate-700 group relative overflow-hidden transition-all hover:border-orange-200 dark:hover:border-slate-600",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white",children:s.item_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-slate-500 font-medium",children:[e.jsx("span",{className:"bg-white dark:bg-slate-800 px-1.5 py-0.5 rounded border border-slate-200 dark:border-slate-600",children:s.cycle}),e.jsxs("span",{children:["KES ",s.cost.toLocaleString()]})]})]}),e.jsx("button",{onClick:()=>Y(s.id),className:"p-2 bg-white dark:bg-slate-800 text-slate-400 hover:text-red-500 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 transition-colors",title:"Cancel Subscription",children:e.jsx(O,{size:16})})]})},s.id)),h.length===0&&e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-slate-100 dark:border-slate-700 rounded-2xl",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-slate-50 dark:bg-slate-800 rounded-full flex items-center justify-center text-slate-300 mb-2",children:e.jsx(i,{size:24})}),e.jsx("p",{className:"text-slate-400 text-sm",children:"No active meal plans"}),e.jsx("button",{onClick:()=>d(!0),className:"mt-2 text-orange-600 text-xs font-bold hover:underline",children:"+ Assign Plan"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(q,{size:20,className:"text-emerald-500"}),"Recent Activity Trend"]}),e.jsx("div",{className:"h-40 -mx-2",children:e.jsx(V,{width:"100%",height:"100%",minWidth:0,children:e.jsxs(X,{data:I,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorAmt",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:0})]})}),e.jsx(J,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 4px 20px rgba(0,0,0,0.1)"}}),e.jsx(Q,{type:"monotone",dataKey:"amount",stroke:"#10B981",fillOpacity:1,fill:"url(#colorAmt)",strokeWidth:2})]})})})]})]}),e.jsx("div",{className:"xl:col-span-2",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden flex flex-col h-full min-h-[500px]",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(A,{size:20,className:"text-orange-500"}),"Transaction Ledger"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{className:"text-sm bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{children:"All Types"}),e.jsx("option",{children:"Payments"}),e.jsx("option",{children:"Charges"})]})})]}),e.jsx("div",{className:"flex-1 overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50",children:e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-700",children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wide",children:"Date & ID"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wide",children:"Description"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wide",children:"Type / Method"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wide text-right",children:"Amount"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-50 dark:divide-slate-700/50",children:[m.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/40 transition-colors group",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("p",{className:"font-mono text-xs font-bold text-slate-500",children:["#",s.id]}),e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-white",children:s.date})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 font-medium",children:s.description})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-md text-[10px] font-bold uppercase tracking-wider ${s.type==="PAYMENT"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}`,children:s.type}),s.method&&s.method!=="SYSTEM"&&e.jsx("span",{className:"text-xs text-slate-400 border border-slate-200 dark:border-slate-700 px-2 py-0.5 rounded-md",children:s.method})]})}),e.jsxs("td",{className:`px-6 py-4 text-right font-mono text-sm font-bold ${s.type==="PAYMENT"?"text-emerald-600":"text-slate-800 dark:text-slate-300"}`,children:[s.type==="PAYMENT"?"+":"-"," ",s.amount.toLocaleString()]})]},s.id)),m.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-20 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center opacity-40",children:[e.jsx(A,{size:48,className:"mb-2"}),e.jsx("p",{children:"No transaction history found"})]})})})]})]})})]})})]}),z&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm transition-all",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl w-full max-w-lg p-0 shadow-2xl animate-scale-in overflow-hidden",children:[e.jsxs("div",{className:"p-6 bg-slate-50 dark:bg-slate-900 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Record Transaction"}),e.jsx("button",{onClick:()=>c(!1),className:"text-slate-400 hover:text-red-500 transition-colors",children:e.jsx(C,{size:24})})]}),e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 p-1 bg-slate-100 dark:bg-slate-700 rounded-xl",children:[e.jsxs("button",{type:"button",onClick:()=>v("PAYMENT"),className:`py-3 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2 ${l==="PAYMENT"?"bg-white dark:bg-slate-800 text-emerald-600 shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700"}`,children:[e.jsx(S,{size:16})," RECIEVE FUNDS"]}),e.jsxs("button",{type:"button",onClick:()=>v("CHARGE"),className:`py-3 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2 ${l==="CHARGE"?"bg-white dark:bg-slate-800 text-red-600 shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700"}`,children:[e.jsx(i,{size:16})," CHARGE STUDENT"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1",children:"Amount (KES)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold",children:"KES"}),e.jsx("input",{type:"number",value:g,onChange:s=>f(s.target.value),required:!0,placeholder:"0.00",className:"w-full pl-12 pr-4 py-3.5 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none text-lg font-bold text-slate-900 dark:text-white transition-all"})]})]}),l==="PAYMENT"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1",children:"Payment Method"}),e.jsxs("select",{value:j,onChange:s=>B(s.target.value),className:"w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-orange-500 outline-none dark:text-white",children:[e.jsx("option",{value:"CASH",children:"Cash Payment"}),e.jsx("option",{value:"MPESA",children:"M-Pesa Transaction"}),e.jsx("option",{value:"BANK",children:"Bank Deposit"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1",children:"Description"}),e.jsx("input",{type:"text",value:N,placeholder:l==="PAYMENT"?"e.g. Term 1 Lunch Payment":"e.g. Lost Cutlery Fine",onChange:s=>k(s.target.value),className:"w-full px-4 py-3.5 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-orange-500 outline-none dark:text-white"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx(y,{type:"submit",className:"w-full py-4 bg-orange-600 hover:bg-orange-700 text-white rounded-xl font-bold text-lg shadow-lg shadow-orange-600/20",children:"Confirm Transaction"})})]})})]})}),D&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl w-full max-w-md p-0 shadow-2xl animate-scale-in overflow-hidden",children:[e.jsxs("div",{className:"p-6 bg-slate-50 dark:bg-slate-900 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Assign Meal Plan"}),e.jsx("button",{onClick:()=>d(!1),className:"text-slate-400 hover:text-red-500 transition-colors",children:e.jsx(C,{size:24})})]}),e.jsxs("div",{className:"p-6 md:p-8 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1.5 ml-1",children:"Choose Plan"}),e.jsxs("select",{value:x,onChange:s=>w(s.target.value),className:"w-full px-4 py-3.5 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-orange-500 outline-none dark:text-white",children:[e.jsx("option",{value:"",children:"-- Select Available Item --"}),L.map(s=>e.jsxs("option",{value:s.id,children:[s.name," â€” KES ",s.cost.toLocaleString()," (",s.billing_cycle,")"]},s.id))]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl flex gap-3 text-blue-700 dark:text-blue-400 text-sm",children:[e.jsx(W,{size:20,className:"shrink-0"}),e.jsxs("p",{children:["Note: Selecting a plan will ",e.jsx("strong",{children:"immediately charge"})," the student's account with the item cost."]})]}),e.jsx(y,{onClick:$,disabled:!x,className:"w-full py-3.5 bg-orange-600 hover:bg-orange-700 text-white rounded-xl font-bold shadow-lg shadow-orange-600/20 disabled:opacity-50 disabled:shadow-none",children:"Confirm Subscription"})]})]})})]})};export{re as default};

import{r as x,j as e,A as R,m as y,e as S}from"./vendor-Cr6tcs86.js";import{u as B,B as h}from"./index-eBdLMQe5.js";import{o as K,p as Y,Z as O,r as j,ad as I,av as w,t as q,i as $,X as G,a3 as W}from"./ui-kKL2mqtN.js";const H=()=>{const{config:N}=B(),{subscription:s}=N,[P,u]=x.useState(!1),[k,C]=x.useState(""),[v,p]=x.useState(!1),[b,d]=x.useState("idle"),[A,z]=x.useState(""),[E,L]=x.useState(""),f={Basic:{icon:O,color:"emerald",price:1499,priceLabel:"1,499"},Standard:{icon:Y,color:"blue",price:2499,priceLabel:"2,499"},Enterprise:{icon:K,color:"violet",price:3499,priceLabel:"3,499"}},n=s?.plan||"Basic",[a,T]=x.useState(n),r=f[n],l=f[a],U=l.icon,m=!s||s.status!=="Active"&&s.status!=="Trial"||s.status==="Trial"?l.price:l.price>r.price?l.price-r.price:l.price,D=s?.trial_end?Math.ceil((new Date(s.trial_end)-new Date)/(1e3*60*60*24)):0,M=async i=>{i.preventDefault(),p(!0),d("processing");try{const t=await S.post("/api/mpesa/stk-push/",{phone:k,amount:m,account_ref:N.school_name?.substring(0,12)||"SUB_UPGRADE",description:`Upgrade to ${a} Plan`,is_subscription:!0,target_plan:a});if(t.data.success||t.data.message){const c=t.data.reference;L(c),d("waiting"),p(!1),_(c)}else d("error"),p(!1)}catch(t){console.error("Payment Error:",t);const c=t.response?.data?.error||t.response?.data?.message||"Something went wrong while initiating the payment.";d("error"),z(c),p(!1)}},_=async i=>{let t=0;const c=40,o=async()=>{try{const g=await S.post("/api/paystack/verify-subscription/",{reference:i||E});if(g.data.success&&g.data.upgraded){d("success"),setTimeout(()=>{window.location.reload()},2e3);return}t++,t<c?setTimeout(o,3e3):d("success")}catch(g){console.error("Error checking payment status:",g),t++,t<c?setTimeout(o,3e3):d("success")}};setTimeout(o,5e3)};return e.jsxs("div",{className:"p-6 lg:p-10 max-w-6xl mx-auto space-y-8",children:[e.jsx("header",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black text-slate-900 dark:text-white tracking-tight",children:"Subscription Plan"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Manage your institution's subscription and billing."})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-[2.5rem] p-8 border border-slate-100 dark:border-slate-800 shadow-sm relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 right-0 w-64 h-64 bg-${r.color}-500/5 blur-[100px] -z-10`}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:`w-20 h-20 rounded-3xl flex items-center justify-center bg-${r.color}-50 dark:bg-${r.color}-900/20 text-${r.color}-600 dark:text-${r.color}-400 shadow-sm shadow-${r.color}-500/10`,children:e.jsx(U,{size:40})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h2",{className:"text-2xl font-black text-slate-900 dark:text-white",children:[s?.plan," Edition"]}),e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider bg-${r.color}-100 dark:bg-${r.color}-900/30 text-${r.color}-700 dark:text-${r.color}-400`,children:s?.status})]}),e.jsxs("p",{className:"text-slate-500 dark:text-slate-400 font-medium leading-relaxed",children:["Your institution is currently on the ",e.jsx("b",{children:s?.plan})," plan."]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-1",children:"Monthly Billing"}),e.jsxs("p",{className:"text-3xl font-black text-slate-900 dark:text-white leading-none",children:["KES ",r.priceLabel,e.jsx("span",{className:"text-sm font-medium text-slate-400",children:"/mo"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-12",children:[e.jsxs("div",{className:"p-5 rounded-3xl bg-slate-50 dark:bg-slate-800/50 border border-slate-100 dark:border-slate-800 flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-white dark:bg-slate-900 flex items-center justify-center text-slate-400 shadow-sm",children:e.jsx(j,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Next Billing Date"}),e.jsx("p",{className:"font-bold text-slate-900 dark:text-white",children:s?.trial_end?new Date(s.trial_end).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}):"N/A"})]})]}),e.jsxs("div",{className:"p-5 rounded-3xl bg-slate-50 dark:bg-slate-800/50 border border-slate-100 dark:border-slate-800 flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-white dark:bg-slate-900 flex items-center justify-center text-slate-400 shadow-sm",children:e.jsx(I,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Payment Status"}),e.jsxs("p",{className:"font-bold text-emerald-600 dark:text-emerald-400 flex items-center gap-1",children:["Active ",s?.status==="Trial"?"Trial":"Subscription",e.jsx(w,{size:14})]})]})]})]})]}),s?.status==="Active"&&a!==n&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/10 border border-amber-200 dark:border-amber-800 p-6 rounded-[2.5rem] flex items-center gap-4 animate-in fade-in slide-in-from-top-4 duration-500",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-white dark:bg-slate-900 flex items-center justify-center text-amber-500 shadow-sm shrink-0",children:e.jsx(q,{size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-amber-900 dark:text-amber-400",children:"Pro-rated Upgrade"}),e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-500 leading-relaxed font-medium",children:["You are upgrading from ",n," to ",a,". You'll only pay the difference:",e.jsxs("span",{className:"font-bold ml-1",children:["KES ",m.toLocaleString()]}),"."]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white shrink-0",children:"Available Plans"}),e.jsx("div",{className:"h-px flex-1 bg-slate-100 dark:bg-slate-800"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:Object.entries(f).map(([i,t])=>{const c=i===n,o=a===i;return e.jsxs("button",{onClick:()=>T(i),className:`p-6 rounded-[2.5rem] border-2 transition-all flex flex-col items-center text-center gap-4 relative overflow-hidden group
                                            ${o?`border-${t.color}-500 bg-${t.color}-50 dark:bg-${t.color}-900/10`:`border-slate-100 dark:border-slate-800 hover:border-${t.color}-200 dark:hover:border-${t.color}-800 bg-white dark:bg-slate-900`}`,children:[e.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg transition-transform group-hover:scale-110
                                            ${o?`bg-${t.color}-500 text-white shadow-${t.color}-500/20`:`bg-${t.color}-50 dark:bg-${t.color}-900/20 text-${t.color}-600 dark:text-${t.color}-400`}`,children:e.jsx(t.icon,{size:28})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-black text-slate-900 dark:text-white tracking-tight",children:i}),e.jsxs("p",{className:`text-[10px] font-bold uppercase tracking-widest ${o?`text-${t.color}-600`:"text-slate-400"}`,children:["KES ",t.priceLabel,"/mo"]})]}),c&&e.jsx("div",{className:"absolute top-3 right-3 px-2 py-0.5 rounded-full bg-slate-900 text-[8px] font-black uppercase text-white",children:"Current"})]},i)})})]})]}),e.jsxs("div",{className:"space-y-6",children:[s?.status==="Trial"&&e.jsxs("div",{className:"bg-slate-900 rounded-[2.5rem] p-8 text-white relative overflow-hidden shadow-2xl shadow-blue-500/20 border border-white/5",children:[e.jsx("div",{className:"absolute -top-12 -right-12 w-32 h-32 bg-blue-600/20 rounded-full blur-2xl"}),e.jsx("div",{className:"absolute -bottom-12 -left-12 w-32 h-32 bg-violet-600/20 rounded-full blur-2xl"}),e.jsxs("div",{className:"relative z-10 flex flex-col",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 text-white text-[10px] font-black uppercase tracking-widest mb-6 border border-white/10",children:[e.jsx(j,{size:12}),"Trial Countdown"]}),e.jsxs("h3",{className:"text-4xl font-black mb-2 tracking-tighter",children:[D," ",e.jsx("span",{className:"text-lg font-bold text-slate-400 tracking-normal uppercase",children:"days"})]}),e.jsxs("p",{className:"text-slate-400 text-sm font-medium leading-relaxed mb-8",children:["Your trial expires on ",e.jsx("b",{children:new Date(s.trial_end).toLocaleDateString()}),". Upgrade now to activate your full ",e.jsx("b",{children:a})," subscription."]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(h,{onClick:()=>u(!0),className:"w-full py-4 text-base shadow-xl shadow-indigo-600/30 bg-indigo-600 hover:bg-indigo-500",children:a===n?"Activate Plan":`Upgrade to ${a}`}),e.jsx("p",{className:"text-[10px] text-center text-slate-500 font-medium",children:"Secure payment via M-Pesa"})]})]})]}),s?.status==="Active"&&a!==n&&e.jsxs("div",{className:"bg-indigo-600 rounded-[2.5rem] p-8 text-white shadow-2xl shadow-indigo-600/20",children:[e.jsx("h3",{className:"text-xl font-black mb-4",children:"Confirm Upgrade"}),e.jsxs("p",{className:"text-indigo-100 text-sm mb-6 leading-relaxed",children:["Switch to the ",e.jsx("b",{children:a})," plan immediately. Your features will update as soon as the payment is confirmed."]}),e.jsxs(h,{onClick:()=>u(!0),className:"w-full bg-white text-indigo-600 hover:bg-white/90 py-4 shadow-xl",children:["Pay KES ",m.toLocaleString()]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-[2.5rem] p-8 border border-slate-100 dark:border-slate-800 shadow-sm",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-50 dark:bg-slate-800 flex items-center justify-center text-slate-400 mb-6 shadow-sm",children:e.jsx($,{size:24})}),e.jsx("h4",{className:"text-lg font-bold text-slate-900 dark:text-white mb-2",children:"Need help?"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm leading-relaxed mb-6",children:"Questions about our plans? Our team is here to help you scale your institution."}),e.jsx(h,{variant:"outline",className:"w-full py-3 rounded-2xl",children:"Contact Support"})]})]})]}),e.jsx(R,{children:P&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>u(!1),className:"absolute inset-0 bg-slate-950/60 backdrop-blur-md"}),e.jsx(y.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"relative w-full max-w-lg bg-white dark:bg-slate-900 rounded-[3rem] shadow-2xl border border-white/10 overflow-hidden",children:e.jsxs("div",{className:"p-8 sm:p-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-8",children:[e.jsx("div",{className:`w-14 h-14 rounded-2xl bg-${l.color}-100 dark:bg-${l.color}-900/30 text-${l.color}-600 dark:text-${l.color}-400 flex items-center justify-center`,children:e.jsx(l.icon,{size:32})}),e.jsx("button",{onClick:()=>u(!1),className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:e.jsx(G,{size:20,className:"text-slate-400"})})]}),e.jsx("h2",{className:"text-3xl font-black text-slate-900 dark:text-white mb-2 tracking-tight",children:a===n?"Renew Sub":`Upgrade to ${a}`}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-8 font-medium",children:s?.status==="Active"?`Confirm your upgrade to the ${a} edition.`:`Experience the full power of EduManage ${a} edition.`}),b==="idle"||b==="processing"?e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"p-6 rounded-3xl bg-slate-50 dark:bg-slate-800/50 border border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest",children:s?.status==="Active"&&a!==n?"Upgrade Pay":"Payable"}),e.jsxs("span",{className:"text-2xl font-black text-slate-900 dark:text-white",children:["KES ",m.toLocaleString()]})]}),e.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 mb-4"}),e.jsxs("div",{className:"flex items-center gap-3 text-xs font-bold text-emerald-600 dark:text-emerald-400",children:[e.jsx(w,{size:14}),e.jsx("span",{children:"Instant Activation after Payment"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-black text-slate-400 uppercase tracking-widest ml-1",children:"M-Pesa Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",children:e.jsx(W,{size:18})}),e.jsx("input",{type:"tel",required:!0,value:k,onChange:i=>C(i.target.value),placeholder:"e.g. 0712345678",className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-2xl py-4 pl-12 pr-4 text-slate-900 dark:text-white font-bold placeholder:text-slate-500 focus:ring-2 focus:ring-violet-500 transition-all shadow-inner"})]})]}),e.jsx(h,{type:"submit",isLoading:v,className:"w-full py-4 text-base bg-emerald-600 hover:bg-emerald-500 shadow-xl shadow-emerald-600/20",children:v?"Sending Request...":`Pay KES ${m.toLocaleString()}`})]}):b==="waiting"?e.jsxs("div",{className:"text-center py-8 space-y-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center mx-auto",children:e.jsx("div",{className:"w-12 h-12 border-4 border-blue-200 dark:border-blue-800 border-t-blue-600 dark:border-t-blue-400 rounded-full animate-spin"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-black text-slate-900 dark:text-white mb-2",children:"Waiting for Payment..."}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-medium",children:"Please complete the M-Pesa payment on your phone. We're monitoring your payment and will upgrade your account automatically once confirmed."})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-slate-400",children:[e.jsx(j,{size:14,className:"animate-pulse"}),e.jsx("span",{children:"This may take up to 2 minutes"})]})]}):b==="success"?e.jsxs("div",{className:"text-center py-8 space-y-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 flex items-center justify-center mx-auto animate-bounce",children:e.jsx(w,{size:48})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-black text-slate-900 dark:text-white mb-2",children:"Upgrade Complete!"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-medium",children:"Your subscription has been upgraded successfully. Refreshing your dashboard..."})]})]}):e.jsxs("div",{className:"text-center py-8 space-y-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-rose-100 dark:bg-rose-900/30 text-rose-600 dark:text-rose-400 flex items-center justify-center mx-auto",children:e.jsx($,{size:48})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-black text-slate-900 dark:text-white mb-2",children:"Payment Failed"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-medium",children:A||"Something went wrong while initiating the payment."})]}),e.jsx(h,{onClick:()=>d("idle"),variant:"outline",className:"w-full",children:"Try Again"})]})]})})]})})]})};export{H as default};

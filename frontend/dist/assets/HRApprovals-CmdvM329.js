import{r,e as c,j as e,m as g,A as _}from"./vendor-Cr6tcs86.js";import{I as T,B as v}from"./index-BxkJ-YYo.js";import{d as $,C as j,D as f,j as O,aa as A,X as E,q as D}from"./ui-BBn2VFCU.js";const P=({request:t,type:d,onApprove:k,onReject:N,userRole:x})=>{const[w,m]=r.useState(!1),[p,l]=r.useState(""),[h,b]=r.useState(null),y=o=>{switch(o){case"APPROVED":return"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400";case"REJECTED":return"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400";case"PENDING":return"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400";default:return"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-400"}},u=o=>{b(o),m(!0)},R=()=>{h==="approve"?k(t.id,p):N(t.id,p),m(!1),l("")},i=()=>x==="ADMIN"?t.status==="PENDING"||t.hr_status==="PENDING":x==="SUPERVISOR"?t.supervisor_status==="PENDING":x==="HR"?t.supervisor_status==="APPROVED"&&t.hr_status==="PENDING":!1;return e.jsxs(e.Fragment,{children:[e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 p-5 md:p-6 hover:shadow-lg transition-all relative group",children:[e.jsx("div",{className:"flex items-start justify-between mb-5",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("div",{className:`h-14 w-14 md:h-16 md:w-16 rounded-2xl flex items-center justify-center border ${d==="leave"?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-blue-100 dark:border-blue-800/50":"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 border-emerald-100 dark:border-emerald-800/50"}`,children:d==="leave"?e.jsx(j,{size:24}):e.jsx(f,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-bold text-slate-900 dark:text-white leading-tight",children:t.employee_name}),e.jsx("p",{className:"text-[10px] md:text-xs font-bold text-slate-400 uppercase tracking-widest mt-1",children:d==="leave"?t.leave_type_display:"Salary Advance"})]})]})}),d==="leave"?e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs font-bold text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-800/50 p-3 rounded-xl border border-slate-100 dark:border-slate-800/50",children:[e.jsx(j,{size:14,className:"text-indigo-500"}),e.jsxs("span",{children:[t.start_date," â†’ ",t.end_date]}),e.jsxs("span",{className:"ml-auto bg-indigo-50 dark:bg-indigo-900/30 px-2 py-0.5 rounded text-[10px] text-indigo-600",children:[t.duration," days"]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-800/50",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5",children:"Reason for leave"}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 leading-relaxed italic",children:['"',t.reason,'"']})]})]}):e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs font-bold text-slate-500 dark:text-slate-400 bg-emerald-50 dark:bg-emerald-900/10 p-3 rounded-xl border border-emerald-100 dark:border-emerald-800/20",children:[e.jsx(f,{size:14,className:"text-emerald-500"}),e.jsx("span",{className:"text-emerald-600 dark:text-emerald-400",children:"Advance Amount:"}),e.jsxs("span",{className:"ml-auto text-sm",children:["KES ",parseFloat(t.amount).toLocaleString()]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-800/50",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5",children:"Justification"}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 leading-relaxed italic",children:['"',t.reason,'"']})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-800 pt-5 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Verification Status"}),e.jsx("span",{className:`px-2.5 py-1 rounded-lg text-[10px] font-bold uppercase tracking-widest ${y(t.status)}`,children:t.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1.5 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-xl flex items-center justify-center shadow-sm border ${t.supervisor_status==="APPROVED"?"bg-emerald-500 border-emerald-400 text-white":t.supervisor_status==="REJECTED"?"bg-rose-500 border-rose-400 text-white":"bg-slate-100 dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-400"}`,children:t.supervisor_status==="APPROVED"?e.jsx(A,{size:16}):t.supervisor_status==="REJECTED"?e.jsx(E,{size:16}):e.jsx(D,{size:16})}),e.jsx("span",{className:"text-[9px] font-bold uppercase tracking-tighter text-slate-500",children:"Supervisor"})]}),e.jsx("div",{className:"w-8 h-px bg-slate-100 dark:bg-slate-800 mt-[-14px]"}),e.jsxs("div",{className:"flex flex-col items-center gap-1.5 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-xl flex items-center justify-center shadow-sm border ${t.hr_status==="APPROVED"?"bg-emerald-500 border-emerald-400 text-white":t.hr_status==="REJECTED"?"bg-rose-500 border-rose-400 text-white":"bg-slate-100 dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-400"}`,children:t.hr_status==="APPROVED"?e.jsx(A,{size:16}):t.hr_status==="REJECTED"?e.jsx(E,{size:16}):e.jsx(D,{size:16})}),e.jsx("span",{className:"text-[9px] font-bold uppercase tracking-tighter text-slate-500",children:"HR/Finance"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-6",children:[e.jsx("span",{children:"Date Requested"}),e.jsx("span",{children:new Date(t.date_requested).toLocaleDateString()})]}),i()&&e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-100 dark:border-slate-800",children:[e.jsxs(v,{variant:"outline",className:"flex-1 h-11 rounded-xl border-rose-200 text-rose-600 hover:bg-rose-50 font-bold text-xs uppercase",onClick:()=>u("reject"),children:[e.jsx(E,{size:16,className:"mr-2"})," Reject"]}),e.jsxs(v,{className:"flex-1 h-11 rounded-xl bg-emerald-600 shadow-lg shadow-emerald-500/10 font-bold text-xs uppercase",onClick:()=>u("approve"),children:[e.jsx(A,{size:16,className:"mr-2"})," Approve"]})]})]}),e.jsx(_,{children:w&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md shadow-2xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800",children:e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white",children:h==="approve"?"Approve Request":"Reject Request"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Comments (Optional)"}),e.jsx("textarea",{value:p,onChange:o=>l(o.target.value),className:"w-full rounded-lg border-slate-200 dark:border-slate-700 dark:bg-slate-800 focus:ring-primary-500 p-3",rows:"4",placeholder:"Add any comments or notes..."})]}),e.jsxs("div",{className:"p-6 border-t border-slate-100 dark:border-slate-800 flex gap-3 justify-end",children:[e.jsx(v,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(v,{onClick:R,children:h==="approve"?"Approve":"Reject"})]})]})})})]})},F=()=>{const[t,d]=r.useState("leave"),[k,N]=r.useState([]),[x,w]=r.useState([]),[m,p]=r.useState(!0),[l,h]=r.useState("PENDING"),[b,y]=r.useState(""),[u,R]=r.useState("ADMIN");r.useEffect(()=>{i()},[]);const i=async()=>{try{const[s,a]=await Promise.all([c.get("/api/hr/leave-requests/"),c.get("/api/hr/advance-requests/")]);N(s.data.requests||[]),w(a.data.requests||[])}catch(s){console.error("Error fetching requests:",s)}finally{p(!1)}},o=async(s,a)=>{try{await c.post(`/api/hr/leave-requests/${s}/approve/`,{comments:a}),i()}catch{alert("Error approving request")}},z=async(s,a)=>{try{await c.post(`/api/hr/leave-requests/${s}/reject/`,{comments:a}),i()}catch{alert("Error rejecting request")}},L=async(s,a)=>{try{await c.post(`/api/hr/advance-requests/${s}/approve/`,{comments:a}),i()}catch{alert("Error approving request")}},I=async(s,a)=>{try{await c.post(`/api/hr/advance-requests/${s}/reject/`,{comments:a}),i()}catch{alert("Error rejecting request")}},S=(k||[]).filter(s=>{const a=(s.employee_name||"").toLowerCase().includes(b.toLowerCase()),n=l==="ALL"||s.status===l;return a&&n}),C=(x||[]).filter(s=>{const a=(s.employee_name||"").toLowerCase().includes(b.toLowerCase()),n=l==="ALL"||s.status===l;return a&&n});return m?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):e.jsx("div",{className:"p-6 md:p-8 bg-slate-50 dark:bg-slate-950 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-14 w-14 md:h-16 md:w-16 bg-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shadow-indigo-500/20",children:e.jsx($,{size:28,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900 dark:text-white tracking-tight",children:"Staff Approvals"}),e.jsx("p",{className:"text-[10px] md:text-xs font-bold text-slate-400 uppercase tracking-widest mt-1",children:"Review and action staff requests"})]})]})}),e.jsxs("div",{className:"flex gap-2 border-b border-slate-100 dark:border-slate-800 overflow-x-auto no-scrollbar scroll-smooth",children:[e.jsxs("button",{onClick:()=>d("leave"),className:`px-6 py-4 text-xs font-bold uppercase tracking-widest transition-all relative shrink-0 ${t==="leave"?"text-indigo-600 dark:text-indigo-400":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e.jsx(j,{size:18,className:"inline mr-2"}),"Leave Requests",t==="leave"&&e.jsx(g.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary-600 dark:bg-primary-400"})]}),e.jsxs("button",{onClick:()=>d("advance"),className:`px-6 py-4 text-xs font-bold uppercase tracking-widest transition-all relative shrink-0 ${t==="advance"?"text-indigo-600 dark:text-indigo-400":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e.jsx(f,{size:18,className:"inline mr-2"}),"Salary Advances",t==="advance"&&e.jsx(g.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary-600 dark:bg-primary-400"})]})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-2xl border border-slate-100 dark:border-slate-800 p-5 md:p-6 mb-8 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx(T,{placeholder:"Search by employee name...",value:b,onChange:s=>y(s.target.value),icon:O,className:"h-11 md:h-12 rounded-xl font-bold"}),e.jsxs("select",{value:l,onChange:s=>h(s.target.value),className:"w-full h-11 md:h-12 rounded-xl border-slate-200 dark:border-slate-800 dark:bg-slate-800 focus:ring-indigo-500 font-bold text-xs px-4",children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"REJECTED",children:"Rejected"})]})]})}),e.jsx(_,{mode:"wait",children:e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:t==="leave"?S.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(s=>e.jsx(P,{request:s,type:"leave",onApprove:o,onReject:z,userRole:u},s.id))}):e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-12 text-center",children:[e.jsx(j,{size:48,className:"mx-auto text-slate-300 dark:text-slate-700 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"No leave requests found"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"All caught up!"})]}):C.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:C.map(s=>e.jsx(P,{request:s,type:"advance",onApprove:L,onReject:I,userRole:u},s.id))}):e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-12 text-center",children:[e.jsx(f,{size:48,className:"mx-auto text-slate-300 dark:text-slate-700 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"No advance requests found"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"All caught up!"})]})},t)})]})})};export{F as default};

import{u as B,r as i,j as e,A as E,m as x,e as p,d as M}from"./vendor-Cr6tcs86.js";import{u as q,I as n,B as y}from"./index-41VSs_U4.js";import{h as F,w as D,N as R,m as G,B as z,U as H,c as L}from"./ui-BBn2VFCU.js";const O=({currentStep:o})=>{const d=[{id:1,label:"Personal",icon:G},{id:2,label:"Academic",icon:z},{id:3,label:"Guardian",icon:H},{id:4,label:"Payment",icon:L}];return e.jsx("div",{className:"flex items-center justify-between w-full mb-8",children:d.map((t,m)=>e.jsxs(M.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center relative z-10",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-colors duration-300 ${o>=t.id?"bg-primary-600 text-white shadow-lg shadow-primary-500/30":"bg-slate-100 text-slate-400"}`,children:e.jsx(t.icon,{size:18})}),e.jsx("span",{className:`text-xs mt-2 font-medium ${o>=t.id?"text-primary-700":"text-slate-400"}`,children:t.label})]}),m<d.length-1&&e.jsx("div",{className:`flex-1 h-1 mx-2 rounded-full -mt-6 transition-colors duration-300 ${o>t.id?"bg-primary-500":"bg-slate-100"}`})]},t.id))})},U=()=>{const{config:o}=q(),d=B(),[t,m]=i.useState(1),[v,f]=i.useState(!1),[N,_]=i.useState([]),[C,w]=i.useState([]),[b,c]=i.useState(null),[a,g]=i.useState({first_name:"",last_name:"",date_of_birth:"",gender:"M",photo:null,grade:"",current_term:1,academic_year:new Date().getFullYear(),location:"MAIN",branch:"",parent_name:"",parent_phone:"",parent_email:"",payment_method:"CASH",reference_number:""});i.useEffect(()=>{(async()=>{try{const[r,u]=await Promise.all([p.get("/api/grades/"),p.get("/api/branches/")]);_(r.data.grades),w(u.data.branches)}catch(r){console.error(r)}})()},[]);const l=s=>{const{name:r,value:u,files:P}=s.target;g(r==="photo"?h=>({...h,photo:P[0]}):h=>({...h,[r]:u}))},j=s=>s===1?a.first_name&&a.last_name:s===2?a.grade:s===3?a.parent_name&&a.parent_phone:!(s===4&&a.payment_method!=="CASH"&&!a.reference_number),k=()=>{j(t)?(m(s=>s+1),c(null)):c("Please fill in all required fields")},S=()=>m(s=>s-1),A=async()=>{if(!j(t)){c("Please fill in all required fields");return}f(!0),c(null);const s=new FormData;Object.keys(a).forEach(r=>{a[r]!==null&&s.append(r,a[r])});try{(await p.post("/api/students/create/",s)).data.success&&d("/students?success=true")}catch(r){c(r.response?.data?.error||"Failed to create admission"),r.response?.data?.errors&&(console.error(r.response.data.errors),alert(`Validation Error: ${JSON.stringify(r.response.data.errors)}`))}finally{f(!1)}};return e.jsx("div",{className:"p-6 max-w-3xl mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"bg-primary-900 px-8 py-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"New Student Admission"}),e.jsx("p",{className:"text-primary-200 text-sm mt-1",children:"Complete the steps below to register a new student"})]}),e.jsxs("div",{className:"p-8",children:[e.jsx(O,{currentStep:t}),b&&e.jsxs("div",{className:"mb-6 bg-red-50 text-red-600 p-4 rounded-xl flex items-center gap-2 text-sm",children:[e.jsx(F,{size:18}),b]}),e.jsx("div",{className:"min-h-[320px]",children:e.jsxs(E,{mode:"wait",children:[t===1&&e.jsxs(x.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n,{label:"First Name",name:"first_name",value:a.first_name,onChange:l,required:!0}),e.jsx(n,{label:"Last Name",name:"last_name",value:a.last_name,onChange:l,required:!0}),e.jsx(n,{type:"date",label:"Date of Birth",name:"date_of_birth",value:a.date_of_birth,onChange:l}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Gender"}),e.jsxs("select",{name:"gender",value:a.gender,onChange:l,className:"w-full h-11 rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 focus:ring-2 focus:ring-primary-100 focus:border-primary-500 transition-all outline-none",children:[e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(n,{type:"file",label:"Photo",name:"photo",onChange:l,className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"})})]},"step1"),t===2&&e.jsxs(x.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Grade / Class"}),e.jsxs("select",{name:"grade",value:a.grade,onChange:l,className:"w-full h-11 rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 focus:ring-2 focus:ring-primary-100 focus:border-primary-500 transition-all outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Grade"}),N.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Branch (Optional)"}),e.jsxs("select",{name:"branch",value:a.branch,onChange:l,className:"w-full h-11 rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 focus:ring-2 focus:ring-primary-100 focus:border-primary-500 transition-all outline-none",children:[e.jsx("option",{value:"",children:"Main School (Default)"}),C.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx(n,{type:"number",label:"Academic Year",name:"academic_year",value:a.academic_year,onChange:l}),e.jsx(n,{type:"number",label:"Current Term",name:"current_term",value:a.current_term,onChange:l,min:1,max:3})]},"step2"),t===3&&e.jsxs(x.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsx(n,{label:"Parent / Guardian Name",name:"parent_name",value:a.parent_name,onChange:l,required:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n,{label:"Phone Number",name:"parent_phone",value:a.parent_phone,onChange:l,required:!0}),e.jsx(n,{type:"email",label:"Email Address",name:"parent_email",value:a.parent_email,onChange:l})]})]},"step3"),t===4&&e.jsxs(x.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100 flex items-start gap-3",children:[e.jsx(D,{className:"text-blue-600 shrink-0 mt-1",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900",children:"Admission Fee Required"}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["A fee of ",o?.currency||"KES"," ",(o?.admission_fee||0).toLocaleString()," is required to complete admission."]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Payment Method"}),e.jsxs("select",{name:"payment_method",value:a.payment_method,onChange:l,className:"w-full h-11 rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 focus:ring-2 focus:ring-primary-100 focus:border-primary-500 transition-all outline-none",children:[e.jsx("option",{value:"CASH",children:"Cash"}),e.jsx("option",{value:"MPESA",children:"M-Pesa"}),e.jsx("option",{value:"BANK",children:"Bank Transfer"})]})]}),a.payment_method!=="CASH"&&e.jsx(n,{label:a.payment_method==="MPESA"?"M-Pesa Transaction Code":"Bank Reference Number",name:"reference_number",value:a.reference_number,onChange:l,placeholder:a.payment_method==="MPESA"?"e.g. QWE123TY":"e.g. REF-123456",required:!0})]})]},"step4")]})}),e.jsxs("div",{className:"flex justify-between pt-8 border-t border-slate-100 mt-8",children:[e.jsx(y,{variant:"secondary",onClick:t===1?()=>d("/students"):S,children:t===1?"Cancel":"Back"}),e.jsxs(y,{onClick:t===4?A:k,isLoading:v,className:"w-32",children:[t===4?"Complete":"Next",t!==4&&e.jsx(R,{size:18,className:"ml-2"})]})]})]})]})})};export{U as default};

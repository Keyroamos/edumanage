import{r,e as h,j as e}from"./vendor-Cr6tcs86.js";import{l as L}from"./index-D0pjtuUa.js";import{B as E}from"./index-41VSs_U4.js";import{aB as z,aj as F,j as B,m as j,w as v,ah as D}from"./ui-BBn2VFCU.js";const T=()=>{const[n,N]=r.useState([]),[l,f]=r.useState(""),[d,b]=r.useState([]),[g,c]=r.useState(!0),[x,w]=r.useState(""),[i,m]=r.useState({}),u=r.useRef(),k=L.useReactToPrint({content:()=>u.current,documentTitle:`Serving_List_${new Date().toISOString().split("T")[0]}`});r.useEffect(()=>{y()},[]),r.useEffect(()=>{l?_(l):b([])},[l]);const y=async()=>{try{const s=await h.get("/api/food/serving-list/");N(s.data.items),s.data.items.length>0&&f(s.data.items[0].id)}catch(s){console.error(s)}finally{c(!1)}},_=async s=>{c(!0);try{const a=await h.get(`/api/food/serving-list/?item_id=${s}`);b(a.data.students);const t={};a.data.students.forEach(o=>{o.served_today&&(t[o.id]=!0)}),m(t)}catch(a){console.error("Failed to fetch serving list",a)}finally{c(!1)}},S=async s=>{const a=i[s];if(m(t=>({...t,[s]:!t[s]})),!a&&l)try{const t=await h.post("/api/food/mark-served/",{student_id:s,item_id:l});t.data.success&&console.log(`Charged KES ${t.data.charged}. New balance: KES ${t.data.new_balance}`)}catch(t){console.error("Failed to charge student",t),m(o=>({...o,[s]:!1})),alert("Failed to mark student as served. Please try again.")}},p=d.filter(s=>s.name.toLowerCase().includes(x.toLowerCase())||s.adm.toLowerCase().includes(x.toLowerCase())),C=()=>{const s=n.find(a=>a.id==l);return s?s.name:"Selected Meal"};return g&&n.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 flex flex-col h-[calc(100vh-120px)] animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(z,{className:"text-orange-600"}),"Kitchen Serving List"]}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"Select a meal to generate the serving checklist"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:[e.jsxs("select",{value:l,onChange:s=>f(s.target.value),className:"px-4 py-2.5 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 dark:text-white min-w-[200px]",children:[e.jsx("option",{value:"",children:"-- Select Meal --"}),n.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.billing_cycle,")"]},s.id))]}),e.jsxs(E,{onClick:k,disabled:d.length===0,className:"bg-slate-900 dark:bg-slate-700 text-white hover:bg-slate-800 dark:hover:bg-slate-600 shadow-md flex items-center gap-2 justify-center",children:[e.jsx(F,{size:18})," Print List"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-6 min-h-0",children:[e.jsxs("div",{className:"lg:w-80 flex-shrink-0 flex flex-col bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50",children:e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e.jsx("input",{type:"text",placeholder:"Find student...",value:x,onChange:s=>w(s.target.value),className:"w-full pl-9 pr-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:g?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-orange-500"})}):p.length>0?p.map(s=>e.jsxs("div",{onClick:()=>S(s.id),className:`p-3 rounded-xl flex items-center gap-3 cursor-pointer transition-colors border ${i[s.id]?"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800":"hover:bg-slate-50 dark:hover:bg-slate-700 border-transparent hover:border-slate-100"}`,children:[s.photo?e.jsx("img",{src:s.photo,alt:s.name,className:"w-10 h-10 rounded-full object-cover border border-slate-200"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-400",children:e.jsx(j,{size:18})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-bold text-slate-900 dark:text-white truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[s.adm," • ",s.grade]})]}),i[s.id]&&e.jsx(v,{size:18,className:"text-emerald-500 flex-shrink-0"})]},s.id)):e.jsxs("div",{className:"p-8 text-center text-slate-400 text-sm",children:[e.jsx(D,{size:24,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No students found"})]})}),e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-900 border-t border-slate-100 dark:border-slate-700 text-center text-xs text-slate-500",children:[Object.keys(i).filter(s=>i[s]).length," of ",d.length," served"]})]}),e.jsx("div",{className:"flex-1 bg-white shadow-sm border border-slate-200 rounded-3xl overflow-hidden flex flex-col",children:e.jsxs("div",{className:"flex-1 overflow-y-auto p-8",ref:u,children:[e.jsxs("div",{className:"mb-8 border-b-2 border-slate-900 pb-4",children:[e.jsx("h2",{className:"text-3xl font-black text-slate-900 uppercase tracking-tighter mb-2",children:"Meal Serving List"}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-slate-700",children:["Meal: ",e.jsx("span",{className:"text-orange-600",children:C()})]}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Date: ",new Date().toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold text-slate-400 uppercase tracking-wider",children:"Total Count"}),e.jsx("p",{className:"text-3xl font-black text-slate-900",children:d.length})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-x-8 gap-y-4",children:d.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-4 py-2 border-b border-dotted border-slate-300 break-inside-avoid",children:[e.jsxs("span",{className:"font-mono text-slate-400 w-6 text-sm",children:[a+1,"."]}),s.photo?e.jsx("img",{src:s.photo,alt:"",className:"w-10 h-10 rounded-full object-cover border border-slate-200"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-400",children:e.jsx(j,{size:16})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-slate-800 text-sm leading-tight",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-500 font-mono",children:[s.adm," • ",s.grade]})]}),i[s.id]?e.jsx("div",{className:"w-6 h-6 border-2 border-emerald-500 bg-emerald-500 rounded-md flex items-center justify-center",children:e.jsx(v,{size:16,className:"text-white",strokeWidth:3})}):e.jsx("div",{className:"w-6 h-6 border-2 border-slate-300 rounded-md"})]},s.id))}),d.length===0&&e.jsx("div",{className:"py-20 text-center text-slate-400 font-bold uppercase tracking-widest text-lg",children:"No Subscriptions Found for this Item"}),e.jsxs("div",{className:"mt-12 pt-4 border-t border-slate-200 flex justify-between text-xs text-slate-400 font-mono",children:[e.jsx("p",{children:"Authorized Signature: __________________________"}),e.jsx("p",{children:"Generated by EduManage System"})]})]})})]})]})};export{T as default};

import{j as e,m as u,r,e as o,A as Q}from"./vendor-Cr6tcs86.js";import{u as W,n as x,B as X}from"./index-Db5g7dLZ.js";import{S as y}from"./SearchableSelect-B_sdlaF3.js";import{e as S,au as b,av as _,h as E,a4 as J,a6 as T,U as p,aw as Y,G as Z,ax as ee,m as g,ay as se,$ as ae,az as te,P as le,N as re,q as ie,_ as de}from"./ui-BBn2VFCU.js";const ne=({title:m,subtitle:i,icon:d,gradient:n="from-primary-600 to-primary-700"})=>e.jsxs(u.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:`bg-gradient-to-r ${n} rounded-3xl p-8 text-white shadow-xl relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -mr-20 -mt-20"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-black/10 rounded-full blur-3xl -ml-10 -mb-10"}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row md:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[d&&e.jsx("div",{className:"p-4 bg-white/20 backdrop-blur-md rounded-2xl shadow-inner border border-white/30",children:d}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-black tracking-tight mb-2",children:m}),i&&e.jsx("p",{className:"text-white/80 font-medium text-sm md:text-base max-w-xl leading-relaxed",children:i})]})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"px-4 py-2 bg-white/10 backdrop-blur-sm rounded-xl border border-white/20 text-xs font-bold uppercase tracking-widest",children:new Date().toLocaleDateString("en-US",{month:"long",year:"numeric"})})})]})]}),c=({children:m,className:i="",hover:d=!1})=>e.jsx("div",{className:`
            bg-white dark:bg-slate-900 
            rounded-3xl border border-slate-100 dark:border-slate-800/50 
            shadow-sm transition-all duration-300
            ${d?"hover:shadow-xl hover:border-primary-500/30":""}
            ${i}
        `,children:m}),be=()=>{const{config:m}=W(),[i,d]=r.useState("send"),[n,A]=r.useState([]),[C,D]=r.useState([]),[oe,f]=r.useState(!1),[j,N]=r.useState(!1),[a,l]=r.useState({recipient_type:"ALL_STUDENTS",message:"",specific_grade:"",specific_student:"",specific_employee:"",fee_min:"",fee_max:"",assessment_term:1,assessment_type:"mid-term"}),[R,z]=r.useState([]),[M,I]=r.useState([]),[L,F]=r.useState([]);r.useEffect(()=>{k(),$()},[]);const k=async()=>{f(!0);try{const[s,t,q,O]=await Promise.all([o.get("/api/sms/"),o.get("/api/grades/"),o.get("/api/students/"),o.get("/api/hr/staff/")]);A(s.data.messages||[]);const K=t.data.grades||[],v=[],w=new Set;for(const h of K)w.has(h.name)||(w.add(h.name),v.push(h));z(v),I(q.data.students||[]),F(O.data.staff||[])}catch(s){console.error("Error fetching communication data:",s),x.error("Failed to load data")}finally{f(!1)}},$=async()=>{try{const s=await o.get("/api/communication/templates/");D(s.data.templates||[])}catch(s){console.error("Error fetching templates:",s)}},U=async s=>{if(s&&s.preventDefault(),!a.message){x.error("Please enter a message");return}N(!0);try{const t=await o.post("/api/sms/send/bulk/",a);t.data.success&&(x.success(`Message sent to ${t.data.recipients} recipients`),l({...a,message:""}),k(),d("history"))}catch(t){console.error("Error sending SMS:",t),x.error(t.response?.data?.error||"Failed to send message")}finally{N(!1)}},P=s=>{l(t=>({...t,message:s.message})),x.success(`Template "${s.name}" applied`)},G=s=>{l(t=>({...t,message:t.message+s}))},B=[{id:"ALL_STUDENTS",label:"All Parents",icon:p,color:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},{id:"GRADE",label:"Specific Class",icon:Z,color:"text-indigo-500",bg:"bg-indigo-50 dark:bg-indigo-900/20"},{id:"FEES_REMINDER",label:"Fee Reminders",icon:E,color:"text-amber-500",bg:"bg-amber-50 dark:bg-amber-900/20"},{id:"ASSESSMENT_RESULTS",label:"Assessment Results",icon:ee,color:"text-emerald-500",bg:"bg-emerald-50 dark:bg-emerald-900/20"},{id:"ALL_TEACHERS",label:"All Teachers",icon:g,color:"text-violet-500",bg:"bg-violet-50 dark:bg-violet-900/20"},{id:"ALL_STAFF",label:"All Staff",icon:se,color:"text-rose-500",bg:"bg-rose-50 dark:bg-rose-900/20"},{id:"INDIVIDUAL",label:"Individual Student",icon:g,color:"text-sky-500",bg:"bg-sky-50 dark:bg-sky-900/20"},{id:"INDIVIDUAL_STAFF",label:"Individual Staff",icon:g,color:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"}],H=[{tag:"{student_name}",label:"Student Name"},{tag:"{parent_name}",label:"Parent Name"},{tag:"{balance}",label:"Fee Balance"},{tag:"{results}",label:"Exam Results"},{tag:"{term}",label:"Term"},{tag:"{exam_type}",label:"Exam Type"},{tag:"{school_name}",label:"School Name"}],V=s=>{switch(s){case"SENT":return e.jsxs("span",{className:"bg-emerald-50 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-400 px-2.5 py-1 rounded-full text-xs font-semibold flex items-center gap-1",children:[e.jsx(_,{size:12})," Sent"]});case"FAILED":return e.jsxs("span",{className:"bg-rose-50 text-rose-700 dark:bg-rose-900/20 dark:text-rose-400 px-2.5 py-1 rounded-full text-xs font-semibold flex items-center gap-1",children:[e.jsx(de,{size:12})," Failed"]});case"PENDING":return e.jsxs("span",{className:"bg-amber-50 text-amber-700 dark:bg-amber-900/20 dark:text-amber-400 px-2.5 py-1 rounded-full text-xs font-semibold flex items-center gap-1",children:[e.jsx(ie,{size:12})," Pending"]});default:return s}};return e.jsxs("div",{className:"p-4 md:p-8 space-y-8 min-h-screen bg-slate-50 dark:bg-slate-900/50",children:[e.jsx(ne,{title:"Communication Portal",subtitle:"Manage mass SMS and school-wide communications",icon:e.jsx(S,{className:"text-white"}),gradient:"from-indigo-600 via-violet-600 to-purple-700"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[{label:"Messages Sent",val:n.filter(s=>s.status==="SENT").length,icon:b,color:"indigo"},{label:"Deliveries",val:n.reduce((s,t)=>s+(t.status==="SENT"?t.recipients_count:0),0),icon:_,color:"emerald"},{label:"Failed",val:n.filter(s=>s.status==="FAILED").length,icon:E,color:"rose"},{label:"SMS Balance",val:"Unlimited",icon:J,color:"amber"}].map((s,t)=>e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},children:e.jsx(c,{className:"p-6 border-none bg-white dark:bg-slate-800 shadow-sm hover:shadow-md transition-all group",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 font-bold uppercase tracking-wider",children:s.label}),e.jsx("h3",{className:"text-3xl font-black mt-2 text-slate-900 dark:text-white tabular-nums",children:s.val})]}),e.jsx("div",{className:`p-4 bg-${s.color}-50 dark:bg-${s.color}-900/20 rounded-2xl text-${s.color}-600 dark:text-${s.color}-400 group-hover:scale-110 transition-transform`,children:e.jsx(s.icon,{size:24})})]})})},t))}),e.jsxs("div",{className:"flex p-1 bg-white dark:bg-slate-800 rounded-2xl w-fit border border-slate-200 dark:border-slate-700",children:[e.jsxs("button",{onClick:()=>d("send"),className:`px-8 py-3 rounded-xl font-bold transition-all flex items-center gap-2 ${i==="send"?"bg-indigo-600 text-white shadow-lg shadow-indigo-200 dark:shadow-indigo-900/50":"text-slate-500 hover:text-slate-800 dark:hover:text-slate-200"}`,children:[e.jsx(b,{size:18})," Compose"]}),e.jsxs("button",{onClick:()=>d("history"),className:`px-8 py-3 rounded-xl font-bold transition-all flex items-center gap-2 ${i==="history"?"bg-indigo-600 text-white shadow-lg shadow-indigo-200 dark:shadow-indigo-900/50":"text-slate-500 hover:text-slate-800 dark:hover:text-slate-200"}`,children:[e.jsx(T,{size:18})," Logs"]})]}),i==="send"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-8",children:[e.jsxs(c,{className:"p-8 bg-white dark:bg-slate-800 border-none shadow-sm relative z-20 overflow-visible",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-5 overflow-hidden",children:e.jsx(p,{size:120})}),e.jsxs("h3",{className:"text-xl font-black text-slate-900 dark:text-white mb-8 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-600 rounded-lg",children:e.jsx(Y,{size:20,className:"text-white"})}),"Target Audience"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:B.map(s=>e.jsxs("button",{onClick:()=>l({...a,recipient_type:s.id}),className:`flex flex-col items-center justify-center p-6 rounded-2xl border-2 transition-all gap-3 group relative overflow-hidden ${a.recipient_type===s.id?"border-indigo-600 bg-indigo-50 dark:bg-indigo-900/20 shadow-inner":"border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 hover:border-slate-300 dark:hover:border-slate-500"}`,children:[e.jsx("div",{className:`p-3 rounded-xl ${a.recipient_type===s.id?"bg-indigo-600 text-white":s.bg+" "+s.color}`,children:e.jsx(s.icon,{size:24})}),e.jsx("span",{className:`text-xs font-black text-center ${a.recipient_type===s.id?"text-indigo-900 dark:text-indigo-100":"text-slate-600 dark:text-slate-400"}`,children:s.label})]},s.id))}),e.jsx(Q,{mode:"wait",children:e.jsxs(u.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-8 pt-8 border-t border-slate-100 dark:border-slate-700",children:[(a.recipient_type==="GRADE"||a.recipient_type==="FEES_REMINDER"||a.recipient_type==="ASSESSMENT_RESULTS")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-black text-slate-400 uppercase mb-2",children:"Target Grade / Class"}),e.jsxs("select",{value:a.specific_grade,onChange:s=>l({...a,specific_grade:s.target.value}),className:"w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-700 focus:border-indigo-500 text-slate-900 dark:text-white font-bold outline-none transition-all",children:[e.jsx("option",{value:"",children:"All Classes"}),R.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),a.recipient_type==="FEES_REMINDER"&&e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-black text-slate-400 uppercase mb-2",children:"Min Owed Balance (KES)"}),e.jsx("input",{type:"number",value:a.fee_min,onChange:s=>l({...a,fee_min:s.target.value}),placeholder:"0",className:"w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-700 focus:border-indigo-500 text-slate-900 dark:text-white font-bold outline-none"})]})}),a.recipient_type==="ASSESSMENT_RESULTS"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-black text-slate-400 uppercase mb-2",children:"Academic Term"}),e.jsxs("select",{value:a.assessment_term,onChange:s=>l({...a,assessment_term:s.target.value}),className:"w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-700 focus:border-indigo-500 text-slate-900 dark:text-white font-bold outline-none",children:[e.jsx("option",{value:"1",children:"Term 1"}),e.jsx("option",{value:"2",children:"Term 2"}),e.jsx("option",{value:"3",children:"Term 3"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-black text-slate-400 uppercase mb-2",children:"Assessment Type"}),e.jsxs("select",{value:a.assessment_type,onChange:s=>l({...a,assessment_type:s.target.value}),className:"w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-700 focus:border-indigo-500 text-slate-900 dark:text-white font-bold outline-none",children:[e.jsx("option",{value:"opener",children:"Opener Results"}),e.jsx("option",{value:"mid-term",children:"Mid-Term Results"}),e.jsx("option",{value:"end-term",children:"End-Term Results"})]})]})]}),a.recipient_type==="INDIVIDUAL"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-black text-slate-400 uppercase mb-2",children:"Select Student"}),e.jsx(y,{options:M.map(s=>({value:s.id,label:`${s.full_name} (${s.admission_number})`})),value:a.specific_student,onChange:s=>l({...a,specific_student:s}),placeholder:"Type to search student...",className:"z-50"})]}),a.recipient_type==="INDIVIDUAL_STAFF"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-black text-slate-400 uppercase mb-2",children:"Select Staff member"}),e.jsx(y,{options:L.map(s=>({value:s.id,label:`${s.first_name} ${s.last_name} (${s.position})`})),value:a.specific_employee,onChange:s=>l({...a,specific_employee:s}),placeholder:"Type to search staff...",className:"z-50"})]})]},a.recipient_type)})]}),e.jsxs(c,{className:"p-8 bg-white dark:bg-slate-800 border-none shadow-sm relative",children:[e.jsxs("h3",{className:"text-xl font-black text-slate-900 dark:text-white mb-8 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-600 rounded-lg",children:e.jsx(S,{size:20,className:"text-white"})}),"Compose Message"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-2",children:[e.jsx("label",{className:"block text-xs font-black text-slate-400 uppercase",children:"Message Content"}),e.jsxs("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded-full ${a.message.length>160?"bg-amber-100 text-amber-700":"bg-slate-100 text-slate-500"}`,children:[a.message.length," / 160 (",Math.ceil(a.message.length/160)||1," SMS)"]})]}),e.jsx("textarea",{value:a.message,onChange:s=>l({...a,message:s.target.value}),placeholder:"Type your message here...",className:"w-full h-48 p-6 rounded-2xl bg-slate-50 dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-800 focus:border-indigo-500 text-slate-900 dark:text-white font-medium outline-none resize-none transition-all placeholder:text-slate-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-black text-slate-400 uppercase mb-3",children:"Quick Insert Placeholders"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:H.map((s,t)=>e.jsxs("button",{onClick:()=>G(s.tag),className:"px-3 py-1.5 bg-slate-100 dark:bg-slate-700 hover:bg-indigo-600 hover:text-white text-slate-600 dark:text-slate-300 rounded-lg text-xs font-bold transition-all flex items-center gap-1 group",children:[e.jsx(ae,{size:12,className:"group-hover:rotate-90 transition-transform"}),s.label]},t))})]}),e.jsx(X,{onClick:U,disabled:j||!a.message,className:"w-full py-4 text-lg font-black bg-indigo-600 hover:bg-indigo-700 shadow-xl shadow-indigo-200 dark:shadow-none flex items-center justify-center gap-3 transition-all active:scale-[0.98]",children:j?e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(b,{size:24}),"SEND MESSAGE NOW"]})})]})]})]}),e.jsxs("div",{className:"lg:col-span-4 space-y-8",children:[e.jsxs(c,{className:"p-6 bg-indigo-600 text-white border-none shadow-xl overflow-hidden relative",children:[e.jsx("div",{className:"absolute -bottom-8 -right-8 opacity-20 rotate-12",children:e.jsx(te,{size:160})}),e.jsx("h4",{className:"text-lg font-black mb-1",children:"AI Smart Templates"}),e.jsx("p",{className:"text-indigo-100 text-sm mb-6 font-medium",children:"Ready-made formats for common school scenarios."}),e.jsx("div",{className:"space-y-3 relative z-10",children:C.map(s=>e.jsxs("button",{onClick:()=>P(s),className:"w-full text-left p-4 rounded-xl bg-white/10 hover:bg-white/20 border border-white/5 transition-all group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"text-xs font-black uppercase tracking-widest text-indigo-200",children:s.category}),e.jsx(le,{size:12,className:"opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("p",{className:"font-bold text-sm mb-2",children:s.name}),e.jsxs("p",{className:"text-[11px] text-indigo-100 line-clamp-2 italic",children:['"',s.message,'"']})]},s.id))})]}),e.jsxs(c,{className:"p-6 bg-white dark:bg-slate-800 border-none shadow-sm",children:[e.jsx("h4",{className:"text-sm font-black text-slate-400 uppercase mb-4",children:"Tips for Results"}),e.jsxs("ul",{className:"space-y-3 text-xs font-bold text-slate-600 dark:text-slate-400",children:[e.jsxs("li",{className:"flex gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-emerald-500 mt-1.5 shrink-0"}),e.jsx("span",{children:"The system automatically pulls the latest marks for the selected term & type."})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-emerald-500 mt-1.5 shrink-0"}),e.jsxs("span",{children:["Use ",e.jsx("b",{children:"{results}"})," to insert the list of subjects and marks."]})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-emerald-500 mt-1.5 shrink-0"}),e.jsx("span",{children:"Individual messages are sent to parents of the selected class."})]})]})]})]})]}):e.jsx(c,{className:"bg-white dark:bg-slate-800 border-none shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 dark:bg-slate-900/50 text-[10px] font-black uppercase tracking-widest text-slate-500 dark:text-slate-400",children:[e.jsx("th",{className:"p-6",children:"Time & Author"}),e.jsx("th",{className:"p-6",children:"Audience"}),e.jsx("th",{className:"p-6",children:"Content"}),e.jsx("th",{className:"p-6",children:"Recipients"}),e.jsx("th",{className:"p-6 text-center",children:"Status"}),e.jsx("th",{className:"p-6 text-center",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[n.map((s,t)=>e.jsxs("tr",{className:"group hover:bg-slate-50/50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-black text-slate-900 dark:text-white uppercase",children:new Date(s.sent_at||s.created_at).toLocaleDateString("en-GB")}),e.jsx("span",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-tighter mt-1",children:s.sent_by})]})}),e.jsx("td",{className:"p-6",children:e.jsx("span",{className:"text-[10px] font-black uppercase tracking-wider text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900/20 px-3 py-1.5 rounded-lg border border-indigo-100 dark:border-indigo-800",children:s.recipient_type_display})}),e.jsx("td",{className:"p-6",children:e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 truncate max-w-[280px] font-medium",title:s.message,children:s.message})}),e.jsx("td",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-slate-100 dark:bg-slate-900 rounded-lg text-slate-500",children:e.jsx(p,{size:14})}),e.jsx("span",{className:"text-sm font-black text-slate-900 dark:text-white",children:s.recipients_count})]})}),e.jsx("td",{className:"p-6 text-center",children:e.jsx("div",{className:"flex justify-center",children:V(s.status)})}),e.jsx("td",{className:"p-6 text-center",children:e.jsx("button",{className:"p-2 hover:bg-white dark:hover:bg-slate-700 border border-transparent hover:border-slate-200 dark:hover:border-slate-600 rounded-xl text-slate-400 hover:text-indigo-600 transition-all shadow-sm",children:e.jsx(re,{size:18})})})]},t)),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-20 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx("div",{className:"w-24 h-24 bg-slate-50 dark:bg-slate-900 rounded-3xl flex items-center justify-center",children:e.jsx(T,{size:48,className:"text-slate-300"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-900 dark:text-white font-black text-2xl",children:"No Message Logs"}),e.jsx("p",{className:"text-slate-500 font-medium max-w-xs mx-auto mt-2",children:"Historical communication records will be displayed here for auditing purposes."})]})]})})})]})]})})})]})};export{be as default};

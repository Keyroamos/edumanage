import{k as P,u as D,r as o,j as e,A as $,m as g,e as b,d as B}from"./vendor-Cr6tcs86.js";import{I as d,B as y}from"./index-DR2ymqTX.js";import{h as q,N as G,O as I,m as L,B as z,U as R}from"./ui-BBn2VFCU.js";const U=({currentStep:n})=>{const c=[{id:1,label:"Personal",icon:L},{id:2,label:"Academic",icon:z},{id:3,label:"Guardian",icon:R}];return e.jsx("div",{className:"flex items-center justify-between w-full mb-8 max-w-lg mx-auto",children:c.map((t,u)=>e.jsxs(B.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center relative z-10",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-colors duration-300 ${n>=t.id?"bg-primary-600 text-white shadow-lg shadow-primary-500/30":"bg-slate-100 dark:bg-slate-800 text-slate-400"}`,children:e.jsx(t.icon,{size:18})}),e.jsx("span",{className:`text-xs mt-2 font-medium ${n>=t.id?"text-primary-700 dark:text-primary-400":"text-slate-400"}`,children:t.label})]}),u<c.length-1&&e.jsx("div",{className:`flex-1 h-1 mx-2 rounded-full -mt-6 transition-colors duration-300 ${n>t.id?"bg-primary-500":"bg-slate-100 dark:bg-slate-800"}`})]},t.id))})},X=()=>{const{id:n}=P(),c=D(),[t,u]=o.useState(1),[N,j]=o.useState(!1),[_,w]=o.useState(!0),[k,C]=o.useState([]),[v,m]=o.useState(null),[a,p]=o.useState({first_name:"",last_name:"",date_of_birth:"",gender:"M",photo:null,grade:"",current_term:1,academic_year:new Date().getFullYear(),location:"MAIN",parent_name:"",parent_phone:"",parent_email:""});o.useEffect(()=>{(async()=>{try{const[r,h]=await Promise.all([b.get("/api/grades/"),b.get(`/api/students/${n}/`)]);C(r.data.grades||[]);const x=h.data.student||{},i=x.personal||{},M=x.academic||{},f=x.guardian||{};p({first_name:(i.full_name||"").split(" ")[0],last_name:(i.full_name||"").split(" ").slice(1).join(" "),date_of_birth:i.dob||"",gender:i.gender==="Male"?"M":"F",photo:null,grade:M.grade_id||"",current_term:1,academic_year:new Date().getFullYear(),location:i.location||"MAIN",parent_name:f.name||"",parent_phone:f.phone||"",parent_email:f.email||""})}catch(r){console.error(r),m("Failed to load student data")}finally{w(!1)}})()},[n]);const l=s=>{const{name:r,value:h,files:x}=s.target;p(r==="photo"?i=>({...i,photo:x[0]}):i=>({...i,[r]:h}))},F=s=>s===1?a.first_name&&a.last_name:s===2?!0:s===3?a.parent_name&&a.parent_phone:!0,S=()=>{F(t)?(u(s=>s+1),m(null)):m("Please fill in all required fields")},A=()=>u(s=>s-1),E=async()=>{j(!0),m(null);const s=new FormData;Object.keys(a).forEach(r=>{if(a[r]!==null&&a[r]!==void 0){if(r==="photo"&&!(a[r]instanceof File))return;s.append(r,a[r])}});try{await b.post(`/api/students/${n}/`,s),c(`/students/${n}`)}catch(r){m(r.response?.data?.error||"Failed to update profile")}finally{j(!1)}};return _?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-slate-50 dark:bg-slate-950",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-slate-200 border-t-primary-600"})}):e.jsx("div",{className:"p-6 max-w-3xl mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-3xl shadow-xl overflow-hidden border border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"bg-slate-900 dark:bg-slate-950 px-8 py-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Edit Profile"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Update student information"})]}),e.jsx("button",{onClick:()=>c(`/students/${n}`),className:"text-slate-400 hover:text-white transition-colors",children:"Cancel"})]}),e.jsxs("div",{className:"p-8",children:[e.jsx(U,{currentStep:t}),v&&e.jsxs("div",{className:"mb-6 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-4 rounded-xl flex items-center gap-2 text-sm",children:[e.jsx(q,{size:18}),v]}),e.jsx("div",{className:"min-h-[320px]",children:e.jsxs($,{mode:"wait",children:[t===1&&e.jsxs(g.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(d,{label:"First Name",name:"first_name",value:a.first_name,onChange:l,required:!0}),e.jsx(d,{label:"Last Name",name:"last_name",value:a.last_name,onChange:l,required:!0}),e.jsx(d,{type:"date",label:"Date of Birth",name:"date_of_birth",value:a.date_of_birth,onChange:l}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Gender"}),e.jsxs("select",{name:"gender",value:a.gender,onChange:l,className:"w-full h-11 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 px-4 focus:ring-2 focus:ring-primary-100 focus:border-primary-500 transition-all outline-none text-slate-900 dark:text-white",children:[e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(d,{type:"file",label:"Update Photo",name:"photo",onChange:l,className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100 dark:file:bg-primary-900/30 dark:file:text-primary-400"})})]},"step1"),t===2&&e.jsxs(g.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Grade / Class"}),e.jsxs("select",{name:"grade",value:a.grade,onChange:l,className:"w-full h-11 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 px-4 focus:ring-2 focus:ring-primary-100 focus:border-primary-500 transition-all outline-none text-slate-900 dark:text-white",required:!0,children:[e.jsx("option",{value:"",children:"Select Grade"}),k.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"School Location"}),e.jsxs("select",{name:"location",value:a.location,onChange:l,className:"w-full h-11 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 px-4 focus:ring-2 focus:ring-primary-100 focus:border-primary-500 transition-all outline-none text-slate-900 dark:text-white",children:[e.jsx("option",{value:"MAIN",children:"Main Campus"}),e.jsx("option",{value:"ANNEX",children:"Annex Campus"})]})]}),e.jsx(d,{type:"number",label:"Academic Year",name:"academic_year",value:a.academic_year,onChange:l}),e.jsx(d,{type:"number",label:"Current Term",name:"current_term",value:a.current_term,onChange:l,min:1,max:3})]},"step2"),t===3&&e.jsxs(g.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsx(d,{label:"Parent / Guardian Name",name:"parent_name",value:a.parent_name,onChange:l,required:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(d,{label:"Phone Number",name:"parent_phone",value:a.parent_phone,onChange:l,required:!0}),e.jsx(d,{type:"email",label:"Email Address",name:"parent_email",value:a.parent_email,onChange:l})]})]},"step3")]})}),e.jsxs("div",{className:"flex justify-between pt-8 border-t border-slate-100 dark:border-slate-800 mt-8",children:[e.jsx(y,{variant:"secondary",onClick:t===1?()=>c(`/students/${n}`):A,children:t===1?"Cancel":"Back"}),e.jsxs(y,{onClick:t===3?E:S,isLoading:N,className:"w-32",children:[t===3?"Save":"Next",t!==3?e.jsx(G,{size:18,className:"ml-2"}):e.jsx(I,{size:18,className:"ml-2"})]})]})]})]})})};export{X as default};

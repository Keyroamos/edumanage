import{r as l,j as e,m as w,A as M,e as i}from"./vendor-Cr6tcs86.js";import{B as n}from"./index-CiVwWrVG.js";import{S as o}from"./SearchableSelect-B_sdlaF3.js";import{v as P,$ as y,ah as O,X as B,h as G,aa as W}from"./ui-BBn2VFCU.js";const u=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY"],q=["08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00"],J=()=>{const[S,C]=l.useState([]),[x,A]=l.useState([]),[D,_]=l.useState([]),[p,E]=l.useState([]),[T,j]=l.useState(!0),[z,m]=l.useState(!1),[F,g]=l.useState(!1),[f,v]=l.useState(null),[h,b]=l.useState({grade:"",teacher:""}),[r,c]=l.useState({grade:"",teacher:"",subject:"",day:"MONDAY",start_time:"08:00",end_time:"09:00"}),N=async()=>{j(!0);try{const s=await i.get("/api/schedule/",{params:h});C(s.data.schedule||[])}catch(s){console.error("Error fetching schedule:",s)}finally{j(!1)}},L=async()=>{try{const[s,a,t]=await Promise.all([i.get("/api/grades/"),i.get("/api/subjects/"),i.get("/api/teachers/?per_page=100")]);A(s.data.grades||[]),_(a.data.subjects||[]),E(t.data.teachers||[])}catch(s){console.error("Error fetching options:",s)}};l.useEffect(()=>{L()},[]),l.useEffect(()=>{N()},[h]);const Y=async s=>{s.preventDefault(),g(!0),v(null);try{await i.post("/api/schedule/",r),m(!1),N(),c(a=>({...a,start_time:"08:00",end_time:"09:00"}))}catch(a){v(a.response?.data?.error||"Failed to create session")}finally{g(!1)}},R=u.reduce((s,a)=>(s[a]=S.filter(t=>t.day===a),s),{}),$=(s,a)=>R[s]?.filter(t=>t.start_time.startsWith(a.split(":")[0]))||[];return T&&!x.length?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"p-6 max-w-full mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Class Schedule"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Weekly timetable and lesson planning"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(n,{variant:"secondary",className:"hidden md:flex",children:[e.jsx(P,{size:18,className:"mr-2"}),"Export PDF"]}),e.jsxs(n,{onClick:()=>m(!0),children:[e.jsx(y,{size:18,className:"mr-2"}),"Add Session"]})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[e.jsx(O,{size:20,className:"text-slate-400 hidden md:block"}),e.jsx("div",{className:"w-full md:w-64",children:e.jsx(o,{options:x.map(s=>({value:s.id,label:s.name})),value:h.grade,onChange:s=>b(a=>({...a,grade:s})),placeholder:"All Grades/Classes"})}),e.jsx("div",{className:"w-full md:w-64",children:e.jsx(o,{options:p.map(s=>({value:s.id,label:s.full_name})),value:h.teacher,onChange:s=>b(a=>({...a,teacher:s})),placeholder:"All Teachers"})}),e.jsx(n,{variant:"ghost",onClick:()=>b({grade:"",teacher:""}),className:"ml-auto text-slate-500",children:"Clear Filters"})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-800 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[1000px]",children:[e.jsxs("div",{className:"grid grid-cols-6 bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-10",children:[e.jsx("div",{className:"p-4 font-semibold text-slate-600 dark:text-slate-400 text-sm border-r border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800",children:"Time"}),u.map(s=>e.jsx("div",{className:"p-4 text-center font-bold text-slate-800 dark:text-slate-200 text-sm border-r border-slate-200 dark:border-slate-700 last:border-r-0",children:s.charAt(0)+s.slice(1).toLowerCase()},s))]}),q.map((s,a)=>e.jsxs("div",{className:`grid grid-cols-6 border-b border-slate-100 dark:border-slate-800 ${a%2===0?"bg-white dark:bg-slate-900":"bg-slate-50/30 dark:bg-slate-800/20"}`,children:[e.jsx("div",{className:"p-4 border-r border-slate-200 dark:border-slate-700 flex items-start justify-center pt-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-slate-500 dark:text-slate-400",children:[e.jsx("span",{className:"text-sm font-bold",children:s}),e.jsx("span",{className:"text-[10px] uppercase text-slate-400",children:"00"})]})}),u.map(t=>{const k=$(t,s);return e.jsxs("div",{className:"p-1 border-r border-slate-200 dark:border-slate-700 last:border-r-0 min-h-[100px] relative",children:[k.map(d=>e.jsxs(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white dark:bg-slate-800/50 border-l-4 border-l-secondary-500 shadow-sm rounded-r-lg p-2 mb-2 hover:shadow-md transition-all cursor-pointer group border border-slate-100 dark:border-slate-700",children:[e.jsx("p",{className:"font-bold text-xs text-slate-800 dark:text-white truncate",children:d.subject}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"text-[10px] font-medium bg-slate-100 dark:bg-slate-700 px-1.5 py-0.5 rounded text-slate-600 dark:text-slate-300",children:d.grade}),e.jsxs("span",{className:"text-[10px] text-slate-400",children:[d.start_time,"-",d.end_time]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 pt-2 border-t border-slate-50 dark:border-slate-700/50",children:[d.avatar?e.jsx("img",{src:d.avatar,className:"w-4 h-4 rounded-full object-cover",alt:""}):e.jsx("div",{className:"w-4 h-4 rounded-full bg-secondary-100 text-secondary-600 flex items-center justify-center text-[8px] font-bold",children:d.teacher.charAt(0)}),e.jsx("span",{className:"text-[10px] text-slate-500 truncate max-w-[80px]",children:d.teacher})]})]},d.id)),k.length===0&&e.jsx("div",{className:"w-full h-full min-h-[80px] hover:bg-slate-50/50 dark:hover:bg-white/5 transition-colors flex items-center justify-center opacity-0 hover:opacity-100 group",children:e.jsx(y,{className:"text-slate-300",size:20})})]},`${t}-${s}`)})]},s))]})})}),e.jsx(M,{children:z&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-slate-900 rounded-2xl shadow-xl w-full max-w-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Planning Session"}),e.jsx("button",{onClick:()=>m(!1),className:"text-slate-400 hover:text-slate-600 transition-colors",children:e.jsx(B,{size:24})})]}),e.jsxs("form",{onSubmit:Y,className:"p-6 space-y-4",children:[f&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg text-sm flex items-center gap-2",children:[e.jsx(G,{size:16}),f]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Target Class *"}),e.jsx(o,{options:x.map(s=>({value:s.id,label:s.name})),value:r.grade,onChange:s=>{const a=x.find(t=>t.id.toString()===s.toString());c(t=>({...t,grade:s,teacher:a?.class_teacher_id||t.teacher}))},placeholder:"Select Class"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Subject *"}),e.jsx(o,{options:D.map(s=>({value:s.id,label:`${s.name} (${s.code})`})),value:r.subject,onChange:s=>c({...r,subject:s}),placeholder:"Select Subject"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Assigned Teacher *"}),e.jsx(o,{options:p.map(s=>({value:s.id,label:s.full_name})),value:r.teacher,onChange:s=>c({...r,teacher:s}),placeholder:"Select Teacher"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Day"}),e.jsx("select",{className:"w-full px-4 py-2.5 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 dark:text-white outline-none",value:r.day,onChange:s=>c({...r,day:s.target.value}),children:u.map(s=>e.jsx("option",{value:s,children:s.charAt(0)+s.slice(1).toLowerCase()},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Start Time"}),e.jsx("input",{type:"time",className:"w-full px-4 py-2.5 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 dark:text-white outline-none",required:!0,value:r.start_time,onChange:s=>c({...r,start_time:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"End Time"}),e.jsx("input",{type:"time",className:"w-full px-4 py-2.5 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 dark:text-white outline-none",required:!0,value:r.end_time,onChange:s=>c({...r,end_time:s.target.value})})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx(n,{type:"button",variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsxs(n,{type:"submit",isLoading:F,children:[e.jsx(W,{size:18,className:"mr-2"})," Save Session"]})]})]})]})})})]})};export{J as default};

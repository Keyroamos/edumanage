import{u as w,r as o,d as v,j as e,e as h}from"./vendor-Cr6tcs86.js";import{u as N,I as x,B as y}from"./index-BuYpWGYq.js";import{B as I,h as L,a4 as _,g as C,aQ as E}from"./ui-BBn2VFCU.js";const q=()=>{const f=w(),{config:l}=N(),[n,d]=o.useState({username:"",password:""}),[p,u]=o.useState(!1),[g,r]=o.useState(null),[j,i]=o.useState(null),[S,m]=o.useState(!0),c=new URLSearchParams(window.location.search),a=c.get("slug")||localStorage.getItem("portal_slug");c.get("slug")&&localStorage.setItem("portal_slug",c.get("slug")),v.useEffect(()=>{(async()=>{if(a)try{const s=await h.get("/api/config/",{headers:{"X-Portal-Slug":a}});i(s.data)}catch(s){console.error("Failed to fetch school config:",s),i(l)}finally{m(!1)}else i(l),m(!1)})()},[a,l]);const b=async t=>{t.preventDefault(),u(!0),r(null);try{const s=await h.post("/api/auth/login/",{...n,portal_slug:a});if(s.data.success)if(localStorage.setItem("user",JSON.stringify(s.data.user)),s.data.portal_slug&&localStorage.setItem("portal_slug",s.data.portal_slug),s.data.user.role==="teacher"){const P=s.data.user.id;f(s.data.redirect_url)}else r("This portal is only for staff/teachers.");else r(s.data.error||"Login failed")}catch(s){console.error(s),r(s.response?.data?.error||"Failed to connect to server")}finally{u(!1)}};return e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-slate-800 rounded-2xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"bg-indigo-600 p-8 text-center",children:[e.jsx("div",{className:"mx-auto bg-white/20 w-16 h-16 rounded-xl flex items-center justify-center backdrop-blur-sm mb-4",children:e.jsx(I,{size:32,className:"text-white"})}),S?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-indigo-500/50 rounded w-3/4 mx-auto mb-2"}),e.jsx("div",{className:"h-4 bg-indigo-500/50 rounded w-1/2 mx-auto"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:[j?.school_name||"School"," Teacher Portal"]}),e.jsx("p",{className:"text-indigo-100 mt-2",children:"Sign in to access your dashboard"}),a&&e.jsxs("p",{className:"mt-2 text-xs text-indigo-200 font-mono bg-white/10 px-2 py-1 rounded inline-block",children:["Portal: ",a]})]})]}),e.jsxs("div",{className:"p-8",children:[g&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mb-6 flex items-center gap-2 text-sm",children:[e.jsx(L,{size:16}),g]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsx(x,{label:"Email Address",icon:_,type:"email",placeholder:"Enter your email",value:n.username,onChange:t=>d(s=>({...s,username:t.target.value})),required:!0}),e.jsx(x,{label:"Password",icon:C,type:"password",placeholder:"••••••••",value:n.password,onChange:t=>d(s=>({...s,password:t.target.value})),required:!0}),e.jsxs(y,{type:"submit",className:"w-full bg-indigo-600 hover:bg-indigo-700",isLoading:p,children:[e.jsx(E,{size:18,className:"mr-2"})," Sign In"]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("a",{href:"/login",className:"text-sm text-slate-500 hover:text-indigo-600 transition-colors",children:"Admin/Student Login"})})]})]})})};export{q as default};

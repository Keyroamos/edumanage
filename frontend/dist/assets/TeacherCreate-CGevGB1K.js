import{u as L,r as c,j as e,m as g,A as B,e as j,d as H}from"./vendor-Cr6tcs86.js";import{I as n,B as y}from"./index-BuYpWGYq.js";import{K as O,h as U,u as w,m as E,F as R,N as G,ab as $}from"./ui-BBn2VFCU.js";const K=({currentStep:d})=>{const l=[{id:1,label:"Personal Details",icon:E},{id:2,label:"Professional Details",icon:$},{id:3,label:"Employment & Payroll",icon:R}];return e.jsx("div",{className:"flex items-center justify-between w-full mb-8 px-4",children:l.map((o,N)=>e.jsxs(H.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center relative z-10 w-24",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 border-2 ${d>=o.id?"bg-secondary-600 border-secondary-600 text-white shadow-lg shadow-secondary-500/30":"bg-white border-slate-200 text-slate-400"}`,children:e.jsx(o.icon,{size:18})}),e.jsx("span",{className:`text-xs mt-2 font-medium text-center ${d>=o.id?"text-secondary-700":"text-slate-400"}`,children:o.label})]}),N<l.length-1&&e.jsx("div",{className:"flex-1 h-[2px] mx-2 -mt-6 bg-slate-100 relative",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-secondary-500 transition-all duration-500 ease-out",style:{width:d>o.id?"100%":"0%"}})})]},o.id))})},Q=()=>{const d=L(),[l,o]=c.useState(1),[N,k]=c.useState(!1),[T,A]=c.useState([]),[P,I]=c.useState([]),[q,z]=c.useState([]),[C,_]=c.useState([]),[D,h]=c.useState(null),[s,b]=c.useState({first_name:"",last_name:"",email:"",phone:"",national_id:"",date_of_birth:"",gender:"M",marital_status:"SINGLE",religion:"CHRISTIAN",nationality:"Kenyan",address:"",tsc_number:"",position:"TEACHER",department:"",qualifications:"DEG",years_of_experience:0,subjects:[],is_class_teacher:!1,grade:"",basic_salary:"",branch:"",profile_picture:null,certificate:null});c.useEffect(()=>{(async()=>{try{const[r,i,m,p]=await Promise.all([j.get("/api/grades/"),j.get("/api/subjects/"),j.get("/api/branches/"),j.get("/api/departments/")]),x=Array.from(new Map(r.data.grades.map(v=>[v.name,v])).values());A(x),z(i.data.subjects),I(m.data.branches),_(p.data.departments)}catch(r){console.error("Error fetching form options:",r),C.length||_([{id:1,name:"Languages"},{id:2,name:"Sciences"},{id:3,name:"Humanities"}])}})()},[]);const t=a=>{const{name:r,value:i,type:m,checked:p,files:x,options:v}=a.target;if(m==="file")b(u=>({...u,[r]:x[0]}));else if(m==="checkbox")b(u=>({...u,[r]:p}));else if(r==="subjects"){const u=Array.from(v).filter(f=>f.selected).map(f=>f.value);b(f=>({...f,[r]:u}))}else b(u=>({...u,[r]:i}))},S=a=>{const i={1:["first_name","last_name","email","national_id","phone","date_of_birth","nationality"],2:["position","qualifications"],3:["basic_salary"]}[a];for(const m of i)if(!s[m])return!1;return!0},M=()=>{S(l)?(o(a=>a+1),h(null)):h("Please fill in all required fields marked with *")},F=async()=>{if(!S(3)){h("Please fill in required employment details");return}k(!0),h(null);const a=new FormData;Object.keys(s).forEach(r=>{s[r]!==null&&(r==="subjects"&&Array.isArray(s[r])?s[r].forEach(i=>a.append("subjects",i)):a.append(r,s[r]))});try{(await j.post("/api/teachers/create/",a)).data.success&&d("/teachers?success=true")}catch(r){console.error("Submission error:",r.response?.data);const i=r.response?.data;if(i?.errors){const p=Object.keys(i.errors)[0],x=i.errors[p];h(`${p.replace("_"," ").toUpperCase()}: ${Array.isArray(x)?x[0]:x}`)}else h(i?.error||"Failed to create teacher. Please check all fields.")}finally{k(!1)}};return e.jsxs("div",{className:"p-6 max-w-5xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{onClick:()=>d("/teachers"),className:"flex items-center gap-2 text-slate-500 hover:text-slate-800 cursor-pointer transition-colors",children:[e.jsx(O,{size:20}),e.jsx("span",{children:"Back to Teachers"})]})}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-xl overflow-hidden border border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"bg-gradient-to-r from-secondary-900 to-secondary-800 px-8 py-8 text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"}),e.jsx("h2",{className:"text-3xl font-bold relative z-10",children:"New Teacher Registration"}),e.jsx("p",{className:"text-secondary-100 text-sm mt-2 relative z-10 max-w-lg",children:"Complete the form below to register a new teaching staff member. Credentials will be generated automatically."})]}),e.jsxs("div",{className:"p-8",children:[e.jsx(K,{currentStep:l}),D&&e.jsxs(g.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-8 bg-red-50 text-red-600 p-4 rounded-xl flex items-center gap-3 text-sm border border-red-100",children:[e.jsx(U,{size:20,className:"shrink-0"}),D]}),e.jsx("div",{className:"min-h-[400px]",children:e.jsxs(B,{mode:"wait",children:[l===1&&e.jsxs(g.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n,{label:"First Name",name:"first_name",value:s.first_name,onChange:t,required:!0,placeholder:"e.g. John"}),e.jsx(n,{label:"Last Name",name:"last_name",value:s.last_name,onChange:t,required:!0,placeholder:"e.g. Doe"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n,{type:"email",label:"Email Address",name:"email",value:s.email,onChange:t,required:!0,placeholder:"john.doe@school.com"}),e.jsx(n,{label:"Phone Number",name:"phone",value:s.phone,onChange:t,placeholder:"+254..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n,{label:"National ID",name:"national_id",value:s.national_id,onChange:t,required:!0}),e.jsx(n,{type:"date",label:"Date of Birth",name:"date_of_birth",value:s.date_of_birth,onChange:t,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Gender"}),e.jsxs("select",{name:"gender",value:s.gender,onChange:t,className:"w-full h-11 rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 focus:ring-2 focus:ring-secondary-100 focus:border-secondary-500 transition-all outline-none",children:[e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Marital Status"}),e.jsxs("select",{name:"marital_status",value:s.marital_status,onChange:t,className:"w-full h-11 rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 focus:ring-2 focus:ring-secondary-100 focus:border-secondary-500 transition-all outline-none",children:[e.jsx("option",{value:"SINGLE",children:"Single"}),e.jsx("option",{value:"MARRIED",children:"Married"}),e.jsx("option",{value:"DIVORCED",children:"Divorced"}),e.jsx("option",{value:"WIDOWED",children:"Widowed"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Religion"}),e.jsxs("select",{name:"religion",value:s.religion,onChange:t,className:"w-full h-11 rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 focus:ring-2 focus:ring-secondary-100 focus:border-secondary-500 transition-all outline-none",children:[e.jsx("option",{value:"CHRISTIAN",children:"Christian"}),e.jsx("option",{value:"MUSLIM",children:"Muslim"}),e.jsx("option",{value:"HINDU",children:"Hindu"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]}),e.jsx(n,{label:"Nationality",name:"nationality",value:s.nationality,onChange:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Home Address"}),e.jsx("textarea",{name:"address",value:s.address,onChange:t,rows:"3",className:"w-full rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 py-3 focus:ring-2 focus:ring-secondary-100 focus:border-secondary-500 transition-all outline-none resize-none"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-slate-50 dark:bg-slate-900 p-6 rounded-2xl border border-slate-100 dark:border-slate-700",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[s.profile_picture?e.jsxs("div",{className:"w-32 h-32 rounded-full flex items-center justify-center mb-4 shadow-sm border border-slate-100 overflow-hidden relative group",children:[e.jsx("img",{src:URL.createObjectURL(s.profile_picture),alt:"Preview",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:e.jsx(w,{className:"text-white",size:24})}),e.jsx("input",{type:"file",name:"profile_picture",onChange:t,className:"absolute inset-0 opacity-0 cursor-pointer",accept:"image/*"})]}):e.jsxs("div",{className:"w-32 h-32 bg-white rounded-full flex items-center justify-center mb-4 shadow-sm border border-slate-100 overflow-hidden relative group",children:[e.jsx(E,{size:48,className:"text-slate-300"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:e.jsx(w,{className:"text-white",size:24})}),e.jsx("input",{type:"file",name:"profile_picture",onChange:t,className:"absolute inset-0 opacity-0 cursor-pointer",accept:"image/*"})]}),e.jsxs(y,{variant:"outline",size:"sm",className:"relative",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(w,{size:14})," Upload Photo"]}),e.jsx("input",{type:"file",name:"profile_picture",onChange:t,className:"absolute inset-0 opacity-0 cursor-pointer",accept:"image/*"})]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-3",children:["Allowed *.jpeg, *.jpg, *.png, *.gif ",e.jsx("br",{})," Max size of 3 MB"]})]})}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/10 p-5 rounded-2xl",children:[e.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-300 flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"})," Registration Guide"]}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-400 leading-relaxed",children:["Fill out all sections to register a new teacher. Mandatory fields include name, email, and position.",e.jsx("br",{}),e.jsx("br",{}),"The teacher uses their ",e.jsx("b",{children:"email address"})," as username and the default portal password set in Settings."]})]})]})]},"step1"),l===2&&e.jsxs(g.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n,{label:"TSC Number (Optional)",name:"tsc_number",value:s.tsc_number,onChange:t}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Position / Role"}),e.jsxs("select",{name:"position",value:s.position,onChange:t,className:"w-full h-11 rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 focus:ring-2 focus:ring-secondary-100 focus:border-secondary-500 transition-all outline-none",children:[e.jsx("option",{value:"TEACHER",children:"Teacher"}),e.jsx("option",{value:"HOD",children:"Head of Department"}),e.jsx("option",{value:"DEPUTY",children:"Deputy Principal"}),e.jsx("option",{value:"PRINCIPAL",children:"Principal"}),e.jsx("option",{value:"ADMIN",children:"Administrator"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Department"}),e.jsxs("select",{name:"department",value:s.department,onChange:t,className:"w-full h-11 rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 focus:ring-2 focus:ring-secondary-100 focus:border-secondary-500 transition-all outline-none",children:[e.jsx("option",{value:"",children:"Select Department"}),C.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Qualification"}),e.jsxs("select",{name:"qualifications",value:s.qualifications,onChange:t,className:"w-full h-11 rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 focus:ring-2 focus:ring-secondary-100 focus:border-secondary-500 transition-all outline-none",children:[e.jsx("option",{value:"CERT",children:"Certificate"}),e.jsx("option",{value:"DIP",children:"Diploma"}),e.jsx("option",{value:"DEG",children:"Degree"}),e.jsx("option",{value:"MAST",children:"Masters"}),e.jsx("option",{value:"PHD",children:"PhD"})]})]})]}),e.jsx("div",{className:"max-w-md",children:e.jsx(n,{type:"number",label:"Years of Experience",name:"years_of_experience",value:s.years_of_experience,onChange:t})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"Subjects (Hold Ctrl/Cmd to select multiple)"}),e.jsx("select",{name:"subjects",multiple:!0,value:s.subjects,onChange:t,className:"w-full h-40 rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:text-white dark:border-slate-700 px-4 py-3 focus:ring-2 focus:ring-secondary-100 focus:border-secondary-500 transition-all outline-none scrollbar-thin",children:q.map(a=>e.jsxs("option",{value:a.id,className:"py-1",children:[a.name," (",a.code,")"]},a.id))}),e.jsx("p",{className:"text-xs text-slate-400",children:"Select all subjects this teacher is qualified to teach."})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 p-6 rounded-2xl border border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",name:"is_class_teacher",checked:s.is_class_teacher,onChange:t,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 dark:bg-slate-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-100 dark:peer-focus:ring-blue-900/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-secondary-600"})]}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:"Designate as Class Teacher"})]})}),s.is_class_teacher&&e.jsxs(g.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-2",children:"Enable this to assign this teacher to a specific grade and section"}),e.jsxs("select",{name:"grade",value:s.grade,onChange:t,className:"w-full md:w-1/2 h-11 rounded-xl border border-slate-200 bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 focus:ring-2 focus:ring-secondary-100 outline-none",children:[e.jsx("option",{value:"",children:"Select Grade"}),T.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]})]},"step2"),l===3&&e.jsxs(g.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n,{type:"number",label:"Basic Salary (KES) *",name:"basic_salary",value:s.basic_salary,onChange:t,required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 ml-1",children:"School Branch (Optional)"}),e.jsxs("select",{name:"branch",value:s.branch,onChange:t,className:"w-full h-11 rounded-xl border border-slate-200 bg-slate-50 dark:bg-slate-900 dark:border-slate-700 dark:text-white px-4 focus:ring-2 focus:ring-secondary-100 focus:border-secondary-500 transition-all outline-none",children:[e.jsx("option",{value:"",children:"Select Branch (Default: Main School)"}),P.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-base font-medium text-slate-800 dark:text-slate-200",children:"Certificate Upload"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-2xl p-8 flex flex-col items-center justify-center text-center transition-colors bg-slate-50 dark:bg-slate-900/50 relative group",onDragOver:a=>{a.preventDefault(),a.currentTarget.classList.add("border-secondary-500","bg-secondary-50/50")},onDragLeave:a=>{a.preventDefault(),a.currentTarget.classList.remove("border-secondary-500","bg-secondary-50/50")},onDrop:a=>{a.preventDefault(),a.currentTarget.classList.remove("border-secondary-500","bg-secondary-50/50"),a.dataTransfer.files&&a.dataTransfer.files[0]&&b(r=>({...r,certificate:a.dataTransfer.files[0]}))},children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 dark:bg-blue-900/20 text-blue-500 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:e.jsx(R,{size:32})}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-1 font-medium",children:s.certificate?s.certificate.name:"Choose file or drag & drop"}),e.jsx("p",{className:"text-xs text-slate-400",children:"PDF or Image of highest qualification"}),e.jsx("input",{type:"file",name:"certificate",onChange:t,className:"hidden",id:"cert-upload",accept:".pdf,image/*"}),e.jsx(y,{variant:"outline",size:"sm",className:"mt-4 relative z-10",onClick:()=>document.getElementById("cert-upload").click(),children:s.certificate?"Change File":"Browse Files"})]})]})]},"step3")]})}),e.jsxs("div",{className:"flex justify-between pt-8 border-t border-slate-100 mt-8",children:[e.jsx(y,{variant:"secondary",onClick:l===1?()=>d("/teachers"):()=>o(a=>a-1),className:"bg-slate-100 text-slate-600 hover:bg-slate-200 border-none",children:l===1?"Cancel":"Back"}),e.jsxs(y,{onClick:l===3?F:M,isLoading:N,className:"w-36 bg-secondary-600 hover:bg-secondary-700 text-white shadow-lg shadow-secondary-500/30",children:[l===3?"Complete Registration":"Next Step",l!==3&&e.jsx(G,{size:18,className:"ml-2"})]})]})]})]})]})};export{Q as default};

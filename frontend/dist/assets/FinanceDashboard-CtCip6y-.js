import{r as d,e as y,j as e,m as k,u as le,A as ie}from"./vendor-Cr6tcs86.js";import de from"./Salaries-DE2x9DgF.js";import{s as A,U as C,h as T,w as q,t as L,V as ne,aC as oe,D as Q,a8 as ce,Y as $,aD as xe,j as he,aj as me,ag as pe,c as be,F as ge,aA as fe,aB as ue,$ as je}from"./ui-BBn2VFCU.js";import{R as w,P as B,b as M,c as G,T as S,L as I,B as Z,C as R,X as D,Y as _,d as P,A as ee,a as W}from"./charts-Fmv3L88u.js";import{l as Ne}from"./index-D0pjtuUa.js";import{B as te,u as ke}from"./index-wvMzqk1Z.js";const ve=()=>{const[o,u]=d.useState(null),[m,g]=d.useState(!0);d.useEffect(()=>{f()},[]);const f=async()=>{o||g(!0);try{const s=await y.get("/api/finance/transport-summary/");u(s.data)}catch(s){console.error("Error fetching transport finance summary:",s)}finally{g(!1)}};if(m&&!o)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-slate-200 border-t-indigo-600 animate-spin"})});if(!o)return null;const{counts:i,totals:l,route_breakdown:p,expense_breakdown:b}=o,N=[{name:"Debtors",value:i.debtors,color:"#f43f5e"},{name:"Settled",value:i.settled,color:"#10b981"}].filter(s=>s.value>0),r=({title:s,value:n,icon:x,color:t,subtext:h})=>e.jsx("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${t} text-white`,children:e.jsx(x,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-slate-500 tracking-wider font-mono",children:s}),e.jsx("h3",{className:"text-2xl font-black text-slate-900 dark:text-white mt-1",children:n}),h&&e.jsx("p",{className:"text-[10px] text-slate-400 mt-1 font-bold",children:h})]})]})});return e.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-slate-900 dark:text-white tracking-tight",children:"Transport Analytics"}),e.jsx("p",{className:"text-slate-500 font-bold uppercase text-[10px] tracking-widest mt-1",children:"Fleet Revenue & Operational Expenditure"})]}),e.jsx("button",{onClick:f,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors text-slate-400",children:e.jsx(A,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(r,{title:"Active Students",value:i.total_students,icon:C,color:"bg-indigo-500",subtext:"Using transport services"}),e.jsx(r,{title:"Transport Debtors",value:i.debtors,icon:T,color:"bg-rose-500",subtext:`${(i.debtors/i.total_students*100).toFixed(1)}% of users`}),e.jsx(r,{title:"Revenue",value:`KES ${(l.revenue/1e3).toFixed(1)}k`,icon:q,color:"bg-emerald-500",subtext:"Collected this period"}),e.jsx(r,{title:"Operations Cost",value:`KES ${(l.expenses/1e3).toFixed(1)}k`,icon:L,color:"bg-rose-500",subtext:"Fuel & Maintenance"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-slate-900 p-8 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col",children:[e.jsx("h3",{className:"text-lg font-black text-slate-900 dark:text-white mb-6",children:"User Payment Status"}),e.jsx("div",{className:"h-[300px] min-h-[300px] w-full",children:e.jsx(w,{width:"100%",height:"100%",minWidth:0,minHeight:0,children:e.jsxs(B,{children:[e.jsx(M,{data:N,innerRadius:80,outerRadius:100,paddingAngle:5,dataKey:"value",animationDuration:1500,children:N.map((s,n)=>e.jsx(G,{fill:s.color,strokeWidth:0},`cell-${n}`))}),e.jsx(S,{contentStyle:{background:"#0f172a",border:"none",borderRadius:"12px",color:"#fff"},itemStyle:{fontSize:"12px",fontWeight:"bold"}}),e.jsx(I,{verticalAlign:"bottom",height:36})]})})}),e.jsx("div",{className:"mt-6 flex flex-col gap-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Net Margin"})]}),e.jsxs("span",{className:`text-sm font-black ${l.net>=0?"text-emerald-600":"text-rose-600"}`,children:["KES ",(l.net/1e3).toFixed(1),"k"]})]})})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-slate-900 p-8 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h3",{className:"text-lg font-black text-slate-900 dark:text-white",children:"Student Enrollment by Route"}),e.jsx("div",{className:"flex items-center gap-4 text-[10px] font-black uppercase text-slate-400 font-mono tracking-tighter",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"})," Count"]})})]}),e.jsx("div",{className:"h-[400px] min-h-[400px] w-full",children:e.jsx(w,{width:"100%",height:"100%",minWidth:0,minHeight:0,children:e.jsxs(Z,{data:p,layout:"vertical",margin:{top:20,right:30,left:40,bottom:5},children:[e.jsx(R,{strokeDasharray:"3 3",horizontal:!1,strokeOpacity:.1}),e.jsx(D,{type:"number",hide:!0}),e.jsx(_,{dataKey:"name",type:"category",axisLine:!1,tickLine:!1,tick:{fill:"#64748b",fontSize:10,fontWeight:800}}),e.jsx(S,{cursor:{fill:"rgba(99, 102, 241, 0.05)"},contentStyle:{background:"#0f172a",border:"none",borderRadius:"12px",color:"#fff"}}),e.jsx(P,{dataKey:"count",fill:"#6366f1",radius:[0,6,6,0],barSize:20})]})})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-black text-slate-900 dark:text-white",children:"Route Performance Matrix"}),e.jsx(ne,{size:20,className:"text-slate-300"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50/50 dark:bg-slate-800/50 text-[10px] font-black uppercase text-slate-500 tracking-widest border-b border-slate-100 dark:border-slate-800",children:[e.jsx("th",{className:"px-8 py-4",children:"Route Name"}),e.jsx("th",{className:"px-8 py-4",children:"Students"}),e.jsx("th",{className:"px-8 py-4 text-right",children:"Term Cost"}),e.jsx("th",{className:"px-8 py-4 text-right",children:"Est. Potential"}),e.jsx("th",{className:"px-8 py-4 text-right",children:"Realized Revenue"}),e.jsx("th",{className:"px-8 py-4 text-center",children:"Collection %"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:p.map((s,n)=>{const x=s.count*s.cost,t=x>0?s.revenue/x*100:0;return e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx("td",{className:"px-8 py-4 text-sm font-bold text-slate-900 dark:text-white",children:s.name}),e.jsx("td",{className:"px-8 py-4",children:e.jsxs("span",{className:"px-2.5 py-1 rounded-lg bg-indigo-50 dark:bg-indigo-500/10 text-[10px] font-bold text-indigo-600 uppercase tracking-wider",children:[s.count," Assigned"]})}),e.jsxs("td",{className:"px-8 py-4 text-right text-xs font-bold text-slate-600 dark:text-slate-400 font-mono",children:["KES ",s.cost.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-4 text-right text-xs font-bold text-slate-600 dark:text-slate-400 font-mono",children:["KES ",x.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-4 text-right text-xs font-black text-emerald-600 font-mono",children:["KES ",s.revenue.toLocaleString()]}),e.jsx("td",{className:"px-8 py-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-12 h-1.5 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-1000",style:{width:`${t}%`}})}),e.jsxs("span",{className:"text-[10px] font-black text-slate-500",children:[t.toFixed(0),"%"]})]})})]},n)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-slate-900 text-white font-black uppercase text-[10px] tracking-[0.2em]",children:[e.jsx("td",{className:"px-8 py-6",children:"Aggregated Fleet Data"}),e.jsxs("td",{className:"px-8 py-6",children:[i.total_students," Users"]}),e.jsx("td",{className:"px-8 py-6 text-right",children:"-"}),e.jsx("td",{className:"px-8 py-6 text-right",children:"-"}),e.jsxs("td",{className:"px-8 py-6 text-right text-emerald-400",children:["KES ",l.revenue.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-6 text-center text-emerald-400",children:["Arrears: KES ",l.arrears.toLocaleString()]})]})})]})})]}),b.length>0&&e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-8 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-black text-slate-900 dark:text-white mb-6",children:"Operations Expense Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:b.map((s,n)=>e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/30 rounded-2xl border border-slate-100 dark:border-slate-800",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase mb-1",children:s.name}),e.jsxs("h4",{className:"text-lg font-black text-rose-600",children:["KES ",s.value.toLocaleString()]}),e.jsx("div",{className:"mt-2 w-full h-1 bg-slate-200 dark:bg-slate-700 rounded-full",children:e.jsx("div",{className:"h-full bg-rose-500 rounded-full",style:{width:`${s.value/l.expenses*100}%`}})})]},n))})]})]})},V=["#f59e0b","#10b981","#6366f1","#f43f5e","#8b5cf6"],ye=()=>{const[o,u]=d.useState(null),[m,g]=d.useState(!0);d.useEffect(()=>{f()},[]);const f=async()=>{o||g(!0);try{const s=await y.get("/api/finance/catering-summary/");u(s.data)}catch(s){console.error("Error fetching food finance summary:",s)}finally{g(!1)}};if(m&&!o)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-slate-200 border-t-orange-600 animate-spin"})});if(!o)return null;const{totals:i,daily_trend:l,sources:p,counts:b,meal_breakdown:N}=o;[{name:"Debtors",value:b.debtors,color:"#f43f5e"},{name:"Settled",value:b.settled,color:"#10b981"}].filter(s=>s.value>0);const r=({title:s,value:n,icon:x,color:t,subtext:h})=>e.jsx("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm transition-all hover:shadow-md",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${t} text-white`,children:e.jsx(x,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-slate-500 tracking-wider font-mono",children:s}),e.jsx("h3",{className:"text-2xl font-black text-slate-900 dark:text-white mt-1",children:n}),h&&e.jsx("p",{className:"text-[10px] text-slate-400 mt-1 font-bold",children:h})]})]})});return e.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-slate-900 dark:text-white tracking-tight",children:"Catering Analytics"}),e.jsx("p",{className:"text-slate-500 font-bold uppercase text-[10px] tracking-widest mt-1",children:"Kitchen Revenue & Expenditure Insights"})]}),e.jsx(oe,{size:32,className:"text-orange-500/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(r,{title:"Active Subscribers",value:b.total_students,icon:C,color:"bg-indigo-500",subtext:"Participating students"}),e.jsx(r,{title:"Meal Debtors",value:b.debtors,icon:T,color:"bg-rose-500",subtext:`KES ${(i.arrears/1e3).toFixed(1)}k outstanding`}),e.jsx(r,{title:"Realized Revenue",value:`KES ${(i.revenue/1e3).toFixed(1)}k`,icon:A,color:"bg-emerald-500",subtext:"Collected meal payments"}),e.jsx(r,{title:"Net Margin",value:`KES ${(i.net/1e3).toFixed(1)}k`,icon:Q,color:i.net>=0?"bg-orange-500":"bg-rose-600",subtext:"Operations surplus"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-8 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col",children:[e.jsxs("h3",{className:"text-lg font-black text-slate-900 dark:text-white mb-6 flex items-center gap-2",children:[e.jsx(ce,{size:18,className:"text-orange-500"})," Revenue Distribution"]}),e.jsx("div",{className:"h-[300px] min-h-[300px] w-full",children:e.jsx(w,{width:"100%",height:"100%",minWidth:0,minHeight:0,children:e.jsxs(B,{children:[e.jsx(M,{data:p,innerRadius:70,outerRadius:90,paddingAngle:8,dataKey:"value",animationDuration:1500,children:p.map((s,n)=>e.jsx(G,{fill:V[n%V.length],strokeWidth:0},`cell-${n}`))}),e.jsx(S,{contentStyle:{background:"#0f172a",border:"none",borderRadius:"12px",color:"#fff"},itemStyle:{fontSize:"12px",fontWeight:"bold"}}),e.jsx(I,{verticalAlign:"bottom",height:36})]})})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-8 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col",children:[e.jsxs("h3",{className:"text-lg font-black text-slate-900 dark:text-white mb-6 flex items-center gap-2",children:[e.jsx($,{size:18,className:"text-emerald-500"})," Daily Revenue (7D)"]}),e.jsx("div",{className:"h-[300px] min-h-[300px] w-full",children:e.jsx(w,{width:"100%",height:"100%",minWidth:0,minHeight:0,children:e.jsxs(ee,{data:l,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorAmt",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f59e0b",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#f59e0b",stopOpacity:0})]})}),e.jsx(R,{strokeDasharray:"3 3",vertical:!1,strokeOpacity:.05}),e.jsx(D,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fill:"#64748b",fontSize:10,fontWeight:800}}),e.jsx(_,{hide:!0}),e.jsx(S,{contentStyle:{background:"#0f172a",border:"none",borderRadius:"12px",color:"#fff"}}),e.jsx(W,{type:"monotone",dataKey:"amount",stroke:"#f59e0b",strokeWidth:4,fillOpacity:1,fill:"url(#colorAmt)"})]})})}),e.jsx("div",{className:"mt-4 p-4 bg-orange-50 dark:bg-orange-900/10 rounded-2xl border border-orange-100 dark:border-orange-500/20 text-center",children:e.jsxs("p",{className:"text-[10px] font-bold text-orange-600 uppercase tracking-widest",children:["Surplus from operations: KES ",i.net.toLocaleString()]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-black text-slate-900 dark:text-white",children:"Subscription Matrix"}),e.jsx(xe,{size:20,className:"text-slate-300"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50/50 dark:bg-slate-800/50 text-[10px] font-black uppercase text-slate-500 tracking-widest border-b border-slate-100 dark:border-slate-800",children:[e.jsx("th",{className:"px-8 py-4",children:"Meal Plan"}),e.jsx("th",{className:"px-8 py-4",children:"Subscribers"}),e.jsx("th",{className:"px-8 py-4 text-right",children:"Subscription Cost"}),e.jsx("th",{className:"px-8 py-4 text-right",children:"Potential Revenue"}),e.jsx("th",{className:"px-8 py-4 text-right",children:"Realized Revenue"}),e.jsx("th",{className:"px-8 py-4 text-center",children:"Collection %"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:N.map((s,n)=>{const x=s.count*s.cost,t=x>0?s.revenue/x*100:0;return e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx("td",{className:"px-8 py-4 text-sm font-bold text-slate-900 dark:text-white",children:s.name}),e.jsx("td",{className:"px-8 py-4",children:e.jsxs("span",{className:"px-2.5 py-1 rounded-lg bg-orange-50 dark:bg-orange-500/10 text-[10px] font-bold text-orange-600 uppercase tracking-wider",children:[s.count," Students"]})}),e.jsxs("td",{className:"px-8 py-4 text-right text-xs font-bold text-slate-600 dark:text-slate-400 font-mono",children:["KES ",s.cost.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-4 text-right text-xs font-bold text-slate-600 dark:text-slate-400 font-mono",children:["KES ",x.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-4 text-right text-xs font-black text-emerald-600 font-mono",children:["KES ",s.revenue.toLocaleString()]}),e.jsx("td",{className:"px-8 py-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-12 h-1.5 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-1000",style:{width:`${t}%`}})}),e.jsxs("span",{className:"text-[10px] font-black text-slate-500",children:[t.toFixed(0),"%"]})]})})]},n)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-slate-900 text-white font-black uppercase text-[10px] tracking-[0.2em]",children:[e.jsx("td",{className:"px-8 py-6",children:"Aggregated Catering Data"}),e.jsxs("td",{className:"px-8 py-6",children:[b.total_students," Users"]}),e.jsx("td",{className:"px-8 py-6 text-right",children:"-"}),e.jsx("td",{className:"px-8 py-6 text-right",children:"-"}),e.jsxs("td",{className:"px-8 py-6 text-right text-emerald-400",children:["KES ",i.revenue.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-6 text-center text-emerald-400",children:["Arrears: KES ",i.arrears.toLocaleString()]})]})})]})})]})]})},we=()=>{const[o,u]=d.useState(null),[m,g]=d.useState(!0);d.useEffect(()=>{f()},[]);const f=async()=>{o||g(!0);try{const r=await y.get("/api/finance/student-fee-summary/");u(r.data)}catch(r){console.error("Error fetching student fee summary:",r)}finally{g(!1)}};if(m&&!o)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-slate-200 border-t-indigo-600 animate-spin"})});if(!o)return null;const i=o?.counts||{total:0,debtors:0,settled:0,credit:0},l=o?.totals||{billed:0,paid:0,outstanding:0},p=o?.grade_breakdown||[],b=[{name:"Debtors",value:i?.debtors||0,color:"#f43f5e"},{name:"Settled",value:i?.settled||0,color:"#10b981"},{name:"In Credit",value:i?.credit||0,color:"#6366f1"}].filter(r=>r.value>0),N=({title:r,value:s,icon:n,color:x,subtext:t})=>e.jsx("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${x} text-white`,children:e.jsx(n,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-slate-500 tracking-wider font-mono",children:r}),e.jsx("h3",{className:"text-2xl font-black text-slate-900 dark:text-white mt-1",children:s}),t&&e.jsx("p",{className:"text-[10px] text-slate-400 mt-1 font-bold",children:t})]})]})});return e.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-slate-900 dark:text-white tracking-tight",children:"Student Fee Analytics"}),e.jsx("p",{className:"text-slate-500 font-bold uppercase text-[10px] tracking-widest mt-1",children:"Institutional Billing & Collection Summary"})]}),e.jsx("button",{onClick:f,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors text-slate-400",children:e.jsx(A,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(N,{title:"Total Students",value:i.total,icon:C,color:"bg-indigo-500",subtext:"Active enrollment"}),e.jsx(N,{title:"Fee Debtors",value:i.debtors,icon:T,color:"bg-rose-500",subtext:`${(i.debtors/i.total*100).toFixed(1)}% of student body`}),e.jsx(N,{title:"Settled Accounts",value:i.settled,icon:q,color:"bg-emerald-500",subtext:"Full payments made"}),e.jsx(N,{title:"Total Arrears",value:`KES ${(l.outstanding/1e3).toFixed(1)}k`,icon:L,color:"bg-amber-500",subtext:"Collectable revenue"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-slate-900 p-8 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col",children:[e.jsx("h3",{className:"text-lg font-black text-slate-900 dark:text-white mb-6",children:"Payment Status"}),e.jsx("div",{className:"h-[300px] w-full min-h-[300px] relative",children:e.jsx(w,{width:"99%",height:300,minHeight:300,children:e.jsxs(B,{children:[e.jsx(M,{data:b,innerRadius:80,outerRadius:100,paddingAngle:5,dataKey:"value",animationDuration:1500,children:b.map((r,s)=>e.jsx(G,{fill:r.color,strokeWidth:0},`cell-${s}`))}),e.jsx(S,{contentStyle:{background:"#0f172a",border:"none",borderRadius:"12px",color:"#fff"},itemStyle:{fontSize:"12px",fontWeight:"bold"}}),e.jsx(I,{verticalAlign:"bottom",height:36})]})})}),e.jsx("div",{className:"mt-6 flex flex-col gap-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Collection Rate"})]}),e.jsxs("span",{className:"text-sm font-black text-emerald-600",children:[(l.paid/l.billed*100).toFixed(1),"%"]})]})})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-slate-900 p-8 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h3",{className:"text-lg font-black text-slate-900 dark:text-white",children:"Arrears by Grade"}),e.jsxs("div",{className:"flex items-center gap-4 text-[10px] font-black uppercase text-slate-400 font-mono tracking-tighter",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"})," Billed"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"})," Paid"]})]})]}),e.jsx("div",{className:"h-[400px] w-full min-h-[400px] relative",children:e.jsx(w,{width:"99%",height:400,minHeight:400,children:e.jsxs(Z,{data:p,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(R,{strokeDasharray:"3 3",vertical:!1,strokeOpacity:.1}),e.jsx(D,{dataKey:"grade",axisLine:!1,tickLine:!1,tick:{fill:"#64748b",fontSize:10,fontWeight:800}}),e.jsx(_,{axisLine:!1,tickLine:!1,tick:{fill:"#64748b",fontSize:10,fontWeight:800},tickFormatter:r=>`${r/1e3}k`}),e.jsx(S,{cursor:{fill:"rgba(99, 102, 241, 0.05)"},contentStyle:{background:"#0f172a",border:"none",borderRadius:"12px",color:"#fff"}}),e.jsx(P,{dataKey:"billed",fill:"#6366f1",radius:[6,6,0,0],barSize:20}),e.jsx(P,{dataKey:"paid",fill:"#10b981",radius:[6,6,0,0],barSize:20})]})})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800",children:e.jsx("h3",{className:"text-lg font-black text-slate-900 dark:text-white",children:"Grade Performance Breakdown"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50/50 dark:bg-slate-800/50 text-[10px] font-black uppercase text-slate-500 tracking-widest border-b border-slate-100 dark:border-slate-800",children:[e.jsx("th",{className:"px-8 py-4",children:"Grade"}),e.jsx("th",{className:"px-8 py-4",children:"Students"}),e.jsx("th",{className:"px-8 py-4 text-right",children:"Total Billed"}),e.jsx("th",{className:"px-8 py-4 text-right",children:"Total Paid"}),e.jsx("th",{className:"px-8 py-4 text-right",children:"Outstanding"}),e.jsx("th",{className:"px-8 py-4 text-center",children:"Collection %"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:p.map((r,s)=>e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx("td",{className:"px-8 py-4 text-sm font-bold text-slate-900 dark:text-white",children:r.grade}),e.jsx("td",{className:"px-8 py-4",children:e.jsxs("span",{className:"px-2.5 py-1 rounded-lg bg-slate-100 dark:bg-slate-800 text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:[r.count," Students"]})}),e.jsxs("td",{className:"px-8 py-4 text-right text-xs font-bold text-slate-600 dark:text-slate-400 font-mono",children:["KES ",r.billed.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-4 text-right text-xs font-black text-emerald-600 font-mono",children:["KES ",r.paid.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-4 text-right text-xs font-black text-rose-600 font-mono",children:["KES ",r.balance.toLocaleString()]}),e.jsx("td",{className:"px-8 py-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-12 h-1.5 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-1000",style:{width:`${r.billed>0?r.paid/r.billed*100:0}%`}})}),e.jsxs("span",{className:"text-[10px] font-black text-slate-500",children:[r.billed>0?(r.paid/r.billed*100).toFixed(0):0,"%"]})]})})]},s))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-slate-900 text-white font-black uppercase text-[10px] tracking-[0.2em]",children:[e.jsx("td",{className:"px-8 py-6",children:"Aggregated Total"}),e.jsxs("td",{className:"px-8 py-6",children:[i.total," Total"]}),e.jsxs("td",{className:"px-8 py-6 text-right",children:["KES ",l.billed.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-6 text-right text-emerald-400",children:["KES ",l.paid.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-6 text-right text-rose-400",children:["KES ",l.outstanding.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-6 text-center text-emerald-400",children:[(l.paid/l.billed*100).toFixed(1),"% Net"]})]})})]})})]})]})},Se=()=>{const[o,u]=d.useState([]),[m,g]=d.useState([]),[f,i]=d.useState(!0),[l,p]=d.useState({grade:"ALL",min_balance:1,search:""}),b=d.useRef();d.useEffect(()=>{N(),r()},[]),d.useEffect(()=>{const t=setTimeout(()=>{r()},500);return()=>clearTimeout(t)},[l.grade,l.min_balance]);const N=async()=>{try{const t=await y.get("/api/grades/");g(t.data.grades||[])}catch(t){console.error("Error fetching grades:",t)}},r=async()=>{i(!0);try{const t=await y.get("/api/finance/arrears/",{params:{grade:l.grade,min_balance:l.min_balance}});u(t.data.students||[])}catch(t){console.error("Error fetching arrears:",t)}finally{i(!1)}},s=Ne.useReactToPrint({contentRef:b,documentTitle:`Fee_Arrears_Report_${new Date().toISOString().split("T")[0]}`}),n=o.filter(t=>t.name.toLowerCase().includes(l.search.toLowerCase())||t.admission_number.toLowerCase().includes(l.search.toLowerCase())),x=o.reduce((t,h)=>t+h.balance,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center justify-between bg-white dark:bg-slate-900/40 backdrop-blur-md p-6 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(he,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search name or admission...",className:"w-full bg-slate-50 dark:bg-slate-800/50 border-none rounded-2xl py-3 pl-12 pr-4 text-sm focus:ring-2 focus:ring-indigo-500/20 transition-all font-bold",value:l.search,onChange:t=>p(h=>({...h,search:t.target.value}))})]}),e.jsxs("select",{className:"bg-slate-50 dark:bg-slate-800/50 border-none rounded-2xl py-3 px-6 text-sm font-black uppercase tracking-widest text-slate-600 dark:text-slate-300 focus:ring-2 focus:ring-indigo-500/20",value:l.grade,onChange:t=>p(h=>({...h,grade:t.target.value})),children:[e.jsx("option",{value:"ALL",children:"All Classes"}),m.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 dark:bg-slate-800/50 px-4 py-3 rounded-2xl border border-transparent hover:border-slate-200 dark:hover:border-slate-700 transition-all",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:"Min Balance:"}),e.jsx("input",{type:"number",className:"bg-transparent border-none p-0 w-20 text-sm font-black focus:ring-0",value:l.min_balance,onChange:t=>p(h=>({...h,min_balance:t.target.value}))})]})]}),e.jsx("div",{className:"flex items-center gap-3 w-full lg:w-auto",children:e.jsxs(te,{variant:"outline",onClick:s,className:"flex-1 lg:flex-initial h-12 rounded-2xl border-slate-200 dark:border-slate-800 font-black uppercase tracking-widest text-[11px] gap-2",children:[e.jsx(me,{size:16})," Print Report"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-indigo-600 rounded-[2rem] p-8 text-white shadow-lg shadow-indigo-500/20",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] opacity-80 mb-2",children:"Total Arrears"}),e.jsxs("h2",{className:"text-4xl font-black tracking-tighter",children:["KES ",x.toLocaleString()]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-[10px] font-bold bg-white/10 w-fit px-3 py-1 rounded-full",children:[e.jsx(C,{size:12})," ",o.length," Students listed"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-[2rem] p-8 border border-slate-200 dark:border-slate-800",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 mb-2",children:"Selected Class"}),e.jsx("h2",{className:"text-3xl font-black text-slate-900 dark:text-white",children:l.grade==="ALL"?"Platform Wide":m.find(t=>t.id.toString()===l.grade.toString())?.name||"Loading..."})]}),e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-[2rem] p-8 border border-slate-200 dark:border-slate-800 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 mb-2",children:"Filters Applied"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"px-3 py-1 bg-slate-100 dark:bg-slate-800 rounded-full text-[10px] font-black uppercase tracking-tighter",children:l.grade==="ALL"?"All Grades":"1 Grade"}),e.jsxs("span",{className:"px-3 py-1 bg-slate-100 dark:bg-slate-800 rounded-full text-[10px] font-black uppercase tracking-tighter",children:["Min KES ",parseInt(l.min_balance).toLocaleString()]})]})]})})]}),e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-[2rem] border border-slate-200 dark:border-slate-800 overflow-hidden shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 dark:bg-slate-800/50 text-[10px] font-black uppercase tracking-widest text-slate-500",children:[e.jsx("th",{className:"px-8 py-5",children:"Student Information"}),e.jsx("th",{className:"px-8 py-5",children:"Term 1"}),e.jsx("th",{className:"px-8 py-5",children:"Term 2"}),e.jsx("th",{className:"px-8 py-5",children:"Term 3"}),e.jsx("th",{className:"px-8 py-5",children:"Yearly Fees"}),e.jsx("th",{className:"px-8 py-5 text-right",children:"Balance Due"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:f?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"px-8 py-20 text-center",children:[e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-indigo-600/20 border-t-indigo-600 rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-xs font-black uppercase tracking-widest text-slate-400",children:"Fetching Records..."})]})}):n.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"px-8 py-20 text-center",children:[e.jsx("div",{className:"bg-slate-50 dark:bg-slate-800 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(T,{className:"text-slate-300",size:32})}),e.jsx("p",{className:"text-sm font-black text-slate-400 uppercase tracking-widest",children:"No arrears found matching filters"})]})}):n.map((t,h)=>e.jsxs(k.tr,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:h*.03},className:"group hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors",children:[e.jsx("td",{className:"px-8 py-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-800 flex items-center justify-center font-black text-xs text-slate-500 group-hover:bg-indigo-600 group-hover:text-white transition-all",children:t.name[0]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-slate-900 dark:text-white",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-tighter",children:["Adm: ",t.admission_number]}),e.jsx("span",{className:"w-1 h-1 bg-slate-300 rounded-full"}),e.jsx("span",{className:"text-[10px] font-bold text-indigo-500 uppercase tracking-tighter bg-indigo-500/10 px-1.5 rounded",children:t.grade})]})]})]})}),e.jsxs("td",{className:"px-8 py-5 text-xs font-bold text-slate-600 dark:text-slate-400",children:["KES ",t.term1_fees.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-5 text-xs font-bold text-slate-600 dark:text-slate-400",children:["KES ",t.term2_fees.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-5 text-xs font-bold text-slate-600 dark:text-slate-400",children:["KES ",t.term3_fees.toLocaleString()]}),e.jsxs("td",{className:"px-8 py-5 text-xs font-black text-slate-900 dark:text-white",children:["KES ",t.yearly_fees.toLocaleString()]}),e.jsx("td",{className:"px-8 py-5 text-right",children:e.jsxs("span",{className:"text-sm font-black text-rose-600 bg-rose-50 dark:bg-rose-500/10 px-4 py-2 rounded-2xl ring-1 ring-rose-600/20",children:["KES ",t.balance.toLocaleString()]})})]},t.id))})]})})}),e.jsx("div",{style:{display:"none"},children:e.jsxs("div",{ref:b,className:"p-12 text-slate-900",style:{fontFamily:"'Inter', sans-serif"},children:[e.jsxs("div",{className:"flex justify-between items-start mb-12 border-b-2 border-slate-900 pb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black uppercase tracking-tight",children:"Fee Arrears Report"}),e.jsxs("p",{className:"text-slate-500 font-bold uppercase tracking-widest text-xs mt-2",children:["Class: ",l.grade==="ALL"?"All Classes":n[0]?.grade||l.grade]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-black uppercase text-slate-400",children:"Generated On"}),e.jsx("p",{className:"font-bold",children:new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})})]})]}),e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-900 text-white text-[10px] uppercase font-black tracking-widest",children:[e.jsx("th",{className:"p-4 border border-slate-900 text-left",children:"Student"}),e.jsx("th",{className:"p-4 border border-slate-900 text-left",children:"Adm No"}),e.jsx("th",{className:"p-4 border border-slate-900 text-left",children:"Class"}),e.jsx("th",{className:"p-4 border border-slate-900 text-right",children:"Term 1"}),e.jsx("th",{className:"p-4 border border-slate-900 text-right",children:"Term 2"}),e.jsx("th",{className:"p-4 border border-slate-900 text-right",children:"Term 3"}),e.jsx("th",{className:"p-4 border border-slate-900 text-right",children:"Yearly"}),e.jsx("th",{className:"p-4 border border-slate-900 text-right",children:"Balance"})]})}),e.jsx("tbody",{children:n.map(t=>e.jsxs("tr",{className:"text-[11px] font-medium border-b border-slate-200",children:[e.jsx("td",{className:"p-4 font-bold border-x border-slate-100",children:t.name}),e.jsx("td",{className:"p-4 border-r border-slate-100",children:t.admission_number}),e.jsx("td",{className:"p-4 border-r border-slate-100",children:t.grade}),e.jsx("td",{className:"p-4 text-right border-r border-slate-100",children:t.term1_fees.toLocaleString()}),e.jsx("td",{className:"p-4 text-right border-r border-slate-100",children:t.term2_fees.toLocaleString()}),e.jsx("td",{className:"p-4 text-right border-r border-slate-100",children:t.term3_fees.toLocaleString()}),e.jsx("td",{className:"p-4 text-right font-bold border-r border-slate-100",children:t.yearly_fees.toLocaleString()}),e.jsx("td",{className:"p-4 text-right font-black text-rose-600 border-x border-slate-100 bg-rose-50/30",children:t.balance.toLocaleString()})]},t.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-slate-50 font-black",children:[e.jsx("td",{colSpan:"7",className:"p-4 text-right uppercase tracking-widest text-xs",children:"Total Outstanding Arrears"}),e.jsxs("td",{className:"p-4 text-right text-lg text-rose-600 bg-rose-50 border-2 border-rose-600 uppercase",children:["KES ",x.toLocaleString()]})]})})]}),e.jsxs("div",{className:"mt-20 flex justify-between",children:[e.jsx("div",{className:"text-center w-64 pt-4 border-t border-slate-300",children:e.jsx("p",{className:"text-[10px] font-black uppercase text-slate-400",children:"Finance Manager Signature"})}),e.jsx("div",{className:"text-center w-64 pt-4 border-t border-slate-300",children:e.jsx("p",{className:"text-[10px] font-black uppercase text-slate-400",children:"School Principal Signature"})})]}),e.jsx("div",{className:"mt-12 text-center text-[8px] text-slate-300 font-bold uppercase tracking-[0.5em]",children:"Internal Use Only - Confidential Data"})]})})]})},K=({title:o,value:u,subtext:m,icon:g,color:f,trend:i,delay:l,net:p})=>e.jsx(k.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:l,duration:.4},className:"p-6 rounded-3xl transition-all duration-300 group hover:bg-slate-100 dark:hover:bg-white/5",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-4 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl ${f} flex items-center justify-center shadow-lg shadow-${f.split("-")[1]}-500/20 group-hover:scale-110 transition-transform`,children:e.jsx(g,{size:20,className:"text-white"})}),e.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-slate-400 dark:text-slate-500",children:o})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-2xl font-black tracking-tight ${p?u.includes("-")?"text-rose-600":"text-emerald-500":"text-slate-900 dark:text-white"}`,children:u}),e.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold uppercase mt-1",children:m})]})]}),i!==void 0&&e.jsxs("div",{className:`flex items-center gap-1 px-2.5 py-1 rounded-full text-[10px] font-black ${i>=0?"text-emerald-500 bg-emerald-500/10":"text-rose-500 bg-rose-500/10"}`,children:[i>=0?e.jsx(A,{size:12}):e.jsx(L,{size:12}),e.jsxs("span",{children:[Math.abs(i),"%"]})]})]})}),Te=()=>{le();const{config:o,hasFeature:u}=ke(),[m,g]=d.useState(null),[f,i]=d.useState([]),[l,p]=d.useState({}),[b,N]=d.useState(!1),[r,s]=d.useState(!1),[n,x]=d.useState([]),[t,h]=d.useState(!1),[U,H]=d.useState(!0),[j,se]=d.useState("overview"),X=u("TRANSPORT_MANAGEMENT"),Y=u("FOOD_MANAGEMENT");d.useEffect(()=>{ae()},[]),d.useEffect(()=>{j==="transactions"&&z("ALL"),j==="expenses"&&z("EXPENSE")},[j]);const ae=async()=>{m||H(!0);try{const a=await y.get("/api/finance/");g(a.data)}catch(a){console.error("Error fetching finance:",a)}finally{H(!1)}},z=async(a="ALL")=>{h(!0);try{const c=await y.get(`/api/finance/transactions/all/?source=${a}`);x(c.data.transactions||[])}catch(c){console.error("Error fetching all transactions:",c)}finally{h(!1)}},v=({id:a,label:c,icon:re})=>e.jsxs("button",{onClick:()=>se(a),className:`flex items-center gap-2 px-4 py-2 text-[11px] font-black uppercase tracking-widest transition-all rounded-xl whitespace-nowrap min-w-fit ${j===a?"text-indigo-400 bg-indigo-500/10 border border-indigo-500/20 shadow-lg shadow-indigo-500/5":"text-slate-400 hover:text-slate-200 hover:bg-slate-800 border border-transparent"}`,children:[e.jsx(re,{size:14,className:j===a?"text-indigo-400":"text-slate-500"}),c]});if(U&&!m)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-50 dark:bg-slate-950",children:e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-slate-200 dark:border-slate-800 border-t-indigo-600 animate-spin"})});if(!m)return null;const E=m.summary||{},J=m.chart_data||[],O=E.total_expenses||0,F=E.expense_breakdown||{};return f.reduce((a,c)=>(a[c.grade]||(a[c.grade]={}),a[c.grade][c.term]||(a[c.grade][c.term]=[]),a[c.grade][c.term].push(c),a),{}),e.jsxs("div",{className:"p-4 md:p-8 max-w-[1400px] mx-auto space-y-6 min-h-screen bg-slate-50/50 dark:bg-slate-950/20 text-slate-900 dark:text-white",children:[(U||r)&&e.jsx("div",{className:"fixed top-0 left-0 right-0 h-1 z-[60] overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 animate-progress w-full shadow-[0_0_10px_#4f46e5]"})}),e.jsxs("div",{className:"space-y-6 pb-2",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:e.jsx("div",{className:"space-y-1",children:e.jsxs("h1",{className:"text-4xl font-black tracking-tight flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-10 bg-indigo-600 rounded-full"}),"Finance Hub"]})})}),e.jsxs("div",{className:"flex flex-wrap items-center bg-slate-900/50 backdrop-blur-md p-1.5 rounded-2xl border border-slate-800 shadow-xl gap-1 overflow-x-auto no-scrollbar",children:[e.jsx(v,{id:"overview",label:"Overview",icon:pe}),e.jsx(v,{id:"transactions",label:"Collections",icon:$}),e.jsx(v,{id:"payroll",label:"Payroll",icon:C}),e.jsx(v,{id:"expenses",label:"Expenses",icon:L}),e.jsx(v,{id:"students",label:"Student Fees",icon:be}),e.jsx(v,{id:"arrears",label:"Fee Balances",icon:ge}),X&&e.jsx(v,{id:"transport",label:"Transport",icon:fe}),Y&&e.jsx(v,{id:"food",label:"Catering",icon:ue})]})]}),e.jsx("div",{className:"relative",children:e.jsxs(ie,{mode:"wait",children:[j==="overview"&&e.jsxs(k.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(K,{title:"Net Balance",value:`KES ${((E.net_profit||0)/1e3).toFixed(1)}k`,subtext:"Income - Expenses",icon:Q,color:"bg-indigo-600",net:!0,delay:0}),e.jsx(K,{title:"Total Income",value:`KES ${((E.total_revenue||0)/1e3).toFixed(1)}k`,subtext:"Fees & others",icon:A,color:"bg-emerald-600",trend:12,delay:.1}),e.jsx(K,{title:"Total Expenses",value:`KES ${(O/1e3).toFixed(1)}k`,subtext:"Salaries & Ops",icon:L,color:"bg-rose-600",delay:.2}),e.jsx(K,{title:"Runway",value:`${E.runway||0} Mo`,subtext:"Burn rate based",icon:$,color:"bg-amber-600",delay:.3})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsxs("div",{className:"lg:col-span-8 bg-white dark:bg-slate-900/40 backdrop-blur-md p-8 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm relative overflow-hidden",children:[e.jsx("h3",{className:"text-xl font-black mb-6",children:"Cash Flow"}),e.jsx("div",{className:"h-[400px] w-full min-h-[400px]",children:e.jsx(w,{width:"100%",height:400,minHeight:400,children:e.jsxs(ee,{data:J.length>0?J:[{month:"N/A",revenue:0,expenses:0}],margin:{left:-20,top:10},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"gIncome",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#6366f1",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#6366f1",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"gExpense",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f43f5e",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#f43f5e",stopOpacity:0})]})]}),e.jsx(R,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0",strokeOpacity:.05}),e.jsx(D,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fill:"#64748b",fontSize:10,fontWeight:800},dy:15}),e.jsx(_,{axisLine:!1,tickLine:!1,tick:{fill:"#64748b",fontSize:10,fontWeight:800},tickFormatter:a=>`${a/1e3}k`}),e.jsx(S,{contentStyle:{borderRadius:"20px",border:"none",background:"rgba(15, 23, 42, 0.95)",backdropFilter:"blur(10px)",padding:"15px",color:"#fff"}}),e.jsx(W,{type:"monotone",dataKey:"revenue",stroke:"#6366f1",strokeWidth:6,fill:"url(#gIncome)",animationDuration:1e3,dot:{r:4,fill:"#6366f1",strokeWidth:2,stroke:"#fff"}}),e.jsx(W,{type:"monotone",dataKey:"expenses",stroke:"#f43f5e",strokeWidth:6,fill:"url(#gExpense)",animationDuration:1e3,dot:{r:4,fill:"#f43f5e",strokeWidth:2,stroke:"#fff"}})]})})})]}),e.jsxs("div",{className:"lg:col-span-4 bg-white dark:bg-slate-900/40 p-8 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col",children:[e.jsx("h3",{className:"text-xl font-black mb-6",children:"Breakdown"}),e.jsx("div",{className:"flex-1 space-y-8",children:[{name:"Salaries",value:F.salaries||0,color:"#6366f1"},X&&{name:"Transport",value:F.transport||0,color:"#3b82f6"},Y&&{name:"Food",value:F.food||0,color:"#f59e0b"},{name:"Other",value:F.other||0,color:"#94a3b8"}].filter(Boolean).map((a,c)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-2",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:a.name}),e.jsxs("p",{className:"text-sm font-black",children:["KES ",(a.value/1e3).toFixed(1),"k"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full",style:{width:O>0?`${a.value/O*100}%`:0,backgroundColor:a.color}})})]},c))})]})]})]},"overview"),j==="transactions"&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-[2rem] border border-slate-200 dark:border-slate-800 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-black",children:"Ledger"}),e.jsxs("select",{onChange:a=>z(a.target.value),className:"bg-slate-100 dark:bg-slate-800 p-2 rounded-xl text-xs font-bold focus:outline-none text-slate-900 dark:text-white",children:[e.jsx("option",{value:"ALL",children:"All Sources"}),e.jsx("option",{value:"FEES",children:"Fees"}),e.jsx("option",{value:"TRANSPORT",children:"Transport"}),e.jsx("option",{value:"FOOD",children:"Food"}),e.jsx("option",{value:"EXPENSE",children:"Expenses"})]})]}),e.jsx("div",{className:"overflow-x-auto min-h-[400px]",children:t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-slate-200 border-t-indigo-600 animate-spin"})}):e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800/50",children:e.jsxs("tr",{className:"text-[10px] font-black uppercase text-slate-500",children:[e.jsx("th",{className:"px-8 py-4",children:"Title"}),e.jsx("th",{className:"px-8 py-4",children:"Ref"}),e.jsx("th",{className:"px-8 py-4 text-right",children:"Amount"}),e.jsx("th",{className:"px-8 py-4",children:"Date"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:n.map((a,c)=>e.jsxs("tr",{className:"hover:bg-slate-50/50",children:[e.jsx("td",{className:"px-8 py-4 font-bold text-xs",children:a.title}),e.jsx("td",{className:"px-8 py-4 text-xs font-mono",children:a.reference}),e.jsxs("td",{className:`px-8 py-4 text-right text-xs font-black ${a.type==="OUTFLOW"?"text-rose-600":"text-emerald-600"}`,children:["KES ",a.amount.toLocaleString()]}),e.jsx("td",{className:"px-8 py-4 text-xs",children:a.date})]},c))})]})})]})},"transactions"),j==="expenses"&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-[2rem] border border-slate-200 dark:border-slate-800 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-black",children:"Expense Journal"}),e.jsxs(te,{variant:"primary",className:"h-9 text-xs font-semibold bg-rose-600 border-none px-4",children:[e.jsx(je,{size:14,className:"mr-2"})," Record Expense"]})]}),e.jsx("div",{className:"overflow-x-auto min-h-[400px]",children:t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-slate-200 border-t-rose-600 animate-spin"})}):e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800/50",children:e.jsxs("tr",{className:"text-[10px] font-black uppercase text-slate-500",children:[e.jsx("th",{className:"px-8 py-4",children:"Title"}),e.jsx("th",{className:"px-8 py-4",children:"Ref"}),e.jsx("th",{className:"px-8 py-4 text-right",children:"Amount"}),e.jsx("th",{className:"px-8 py-4",children:"Date"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:n.filter(a=>a.type==="OUTFLOW"||a.source==="EXPENSE").map((a,c)=>e.jsxs("tr",{className:"hover:bg-slate-50/50",children:[e.jsx("td",{className:"px-8 py-4 font-bold text-xs",children:a.title}),e.jsx("td",{className:"px-8 py-4 text-xs font-mono",children:a.reference}),e.jsxs("td",{className:"px-8 py-4 text-right text-xs font-black text-rose-600",children:["KES ",a.amount.toLocaleString()]}),e.jsx("td",{className:"px-8 py-4 text-xs",children:a.date})]},c))})]})})]})},"expenses"),j==="students"&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(we,{})},"students"),j==="arrears"&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Se,{})},"arrears"),j==="payroll"&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(de,{})},"payroll"),j==="transport"&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(ve,{})},"transport"),j==="food"&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(ye,{})},"food")]})})]})};export{Te as default};

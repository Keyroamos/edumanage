import{k as Y,r,j as e,e as j}from"./vendor-Cr6tcs86.js";import{I as N,B as p}from"./index-CiVwWrVG.js";import{C as q,h as A,w as n,D as R,$ as _,_ as B,q as z}from"./ui-BBn2VFCU.js";const O=({teacher:d,onRefresh:y})=>{const{id:c}=Y(),[t,f]=r.useState(d||null),[k,i]=r.useState("list"),[w,u]=r.useState(!1),[S,C]=r.useState(!d),[h,o]=r.useState(null),[b,g]=r.useState(null);r.useEffect(()=>{!d&&c?(async()=>{try{C(!0);const a=await j.get(`/api/teachers/${c}/`);f(a.data.teacher)}catch(a){console.error("Error fetching teacher:",a),o("Failed to load profile.")}finally{C(!1)}})():d&&f(d)},[d,c]);const E=()=>{y?y():c&&(async()=>{try{const a=await j.get(`/api/teachers/${c}/`);f(a.data.teacher)}catch(a){console.error("Error fetching teacher:",a)}})()},x=d?"":"p-4 md:p-8 max-w-7xl mx-auto space-y-6 md:space-y-8 pb-20",[l,v]=r.useState({leave_type:"CASUAL",start_date:"",end_date:"",reason:""}),[m,D]=r.useState({amount:"",reason:""}),P=async s=>{s.preventDefault(),u(!0),o(null);try{await j.post(`/api/teachers/${t.personal.id}/request-leave/`,l),g("Leave request submitted successfully!"),setTimeout(()=>{g(null),i("list"),E()},2e3)}catch(a){o(a.response?.data?.error||"Failed to submit leave request")}finally{u(!1)}},T=async s=>{s.preventDefault(),u(!0),o(null);try{await j.post(`/api/teachers/${t.personal.id}/request-advance/`,m),g("Salary advance request submitted successfully!"),setTimeout(()=>{g(null),i("list"),E()},2e3)}catch(a){o(a.response?.data?.error||"Failed to submit advance request")}finally{u(!1)}},L=({status:s})=>{const a={PENDING:"bg-yellow-100 text-yellow-800 border-yellow-200",APPROVED:"bg-green-100 text-green-800 border-green-200",REJECTED:"bg-red-100 text-red-800 border-red-200"},$={PENDING:z,APPROVED:n,REJECTED:B}[s]||z;return e.jsxs("span",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold border ${a[s]||a.PENDING}`,children:[e.jsx($,{size:12}),s]})},I=[{value:"SICK",label:"Sick Leave"},{value:"CASUAL",label:"Casual Leave"},{value:"ANNUAL",label:"Annual Leave"},{value:"MATERNITY",label:"Maternity Leave"},{value:"PATERNITY",label:"Paternity Leave"},{value:"STUDY",label:"Study Leave"},{value:"COMPASSIONATE",label:"Compassionate Leave"}];return S?e.jsx("div",{className:`flex justify-center items-center min-h-[400px] ${x}`,children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):!t&&!S?e.jsx("div",{className:`p-10 text-center ${x}`,children:"Teacher profile not found."}):k==="leave"?e.jsx("div",{className:x,children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(q,{className:"text-indigo-500"})," Request Leave"]}),e.jsx("button",{onClick:()=>i("list"),className:"text-sm text-slate-500 hover:text-indigo-600",children:"Cancel"})]}),h&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mb-4 flex items-center gap-2 text-sm",children:[e.jsx(A,{size:16})," ",h]}),b&&e.jsxs("div",{className:"bg-green-50 text-green-600 p-3 rounded-lg mb-4 flex items-center gap-2 text-sm",children:[e.jsx(n,{size:16})," ",b]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Leave Type"}),e.jsx("select",{className:"w-full rounded-xl border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50 focus:ring-2 focus:ring-indigo-500 transition-all p-2.5",value:l.leave_type,onChange:s=>v({...l,leave_type:s.target.value}),required:!0,children:I.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(N,{label:"Start Date",type:"date",value:l.start_date,onChange:s=>v({...l,start_date:s.target.value}),required:!0}),e.jsx(N,{label:"End Date",type:"date",value:l.end_date,onChange:s=>v({...l,end_date:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Reason"}),e.jsx("textarea",{className:"w-full rounded-xl border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50 focus:ring-2 focus:ring-indigo-500 transition-all p-3",rows:"4",value:l.reason,onChange:s=>v({...l,reason:s.target.value}),required:!0,placeholder:"Please provide a detailed reason for your leave request..."})]}),e.jsx("div",{className:"pt-2",children:e.jsx(p,{type:"submit",isLoading:w,className:"w-full",children:"Submit Request"})})]})]})}):k==="advance"?e.jsx("div",{className:x,children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(R,{className:"text-green-500"})," Request Salary Advance"]}),e.jsx("button",{onClick:()=>i("list"),className:"text-sm text-slate-500 hover:text-indigo-600",children:"Cancel"})]}),h&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mb-4 flex items-center gap-2 text-sm",children:[e.jsx(A,{size:16})," ",h]}),b&&e.jsxs("div",{className:"bg-green-50 text-green-600 p-3 rounded-lg mb-4 flex items-center gap-2 text-sm",children:[e.jsx(n,{size:16})," ",b]}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl mb-4",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Note:"})," Salary advances are subject to approval and will be deducted from your next payslip. Your current basic salary is ",e.jsxs("strong",{children:["KES ",t.financial?.basic_salary?.toLocaleString()]}),"."]})}),e.jsx(N,{label:"Amount (KES)",type:"number",min:"1",max:t.financial?.basic_salary||5e4,value:m.amount,onChange:s=>D({...m,amount:s.target.value}),required:!0,placeholder:"e.g. 5000"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Reason"}),e.jsx("textarea",{className:"w-full rounded-xl border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50 focus:ring-2 focus:ring-indigo-500 transition-all p-3",rows:"4",value:m.reason,onChange:s=>D({...m,reason:s.target.value}),required:!0,placeholder:"Why do you need this advance?"})]}),e.jsx("div",{className:"pt-2",children:e.jsx(p,{type:"submit",isLoading:w,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:"Submit Request"})})]})]})}):e.jsx("div",{className:x,children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50/50 dark:bg-slate-800/50",children:[e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(q,{size:18,className:"text-indigo-500"})," Leave History"]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>i("leave"),children:[e.jsx(_,{size:16,className:"mr-1"})," New Request"]})]}),e.jsx("div",{className:"p-0",children:t.leaves&&t.leaves.length>0?e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:t.leaves.map((s,a)=>e.jsxs("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h4",{className:"font-medium text-slate-900 dark:text-white",children:s.type}),e.jsx(L,{status:s.status})]}),e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400 flex flex-wrap gap-4 mb-2",children:e.jsxs("span",{children:[s.start_date," - ",s.end_date]})}),s.reason&&e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-900/50 p-2 rounded-lg italic",children:['"',s.reason,'"']})]},a))}):e.jsx("div",{className:"p-8 text-center text-slate-500",children:e.jsx("p",{children:"No leave history found."})})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50/50 dark:bg-slate-800/50",children:[e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(R,{size:18,className:"text-green-500"})," Advance History"]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>i("advance"),children:[e.jsx(_,{size:16,className:"mr-1"})," New Advance"]})]}),e.jsx("div",{className:"p-0",children:t.advances&&t.advances.length>0?e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:t.advances.map((s,a)=>e.jsxs("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("h4",{className:"font-bold text-slate-900 dark:text-white",children:["KES ",s.amount.toLocaleString()]}),e.jsx(L,{status:s.status})]}),e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 mb-2",children:["Requested on ",s.date]}),s.reason&&e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-900/50 p-2 rounded-lg italic",children:['"',s.reason,'"']})]},a))}):e.jsx("div",{className:"p-8 text-center text-slate-500",children:e.jsx("p",{children:"No salary advance history found."})})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-indigo-600 rounded-2xl p-6 text-white shadow-lg",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"HR Guidelines"}),e.jsxs("ul",{className:"space-y-3 text-indigo-100 text-sm",children:[e.jsxs("li",{className:"flex gap-2",children:[e.jsx(n,{size:16,className:"shrink-0 mt-0.5"}),e.jsx("span",{children:"Leave requests should be submitted at least 3 days in advance unless it's an emergency."})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx(n,{size:16,className:"shrink-0 mt-0.5"}),e.jsx("span",{children:"Salary advances cannot exceed 50% of your basic salary."})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx(n,{size:16,className:"shrink-0 mt-0.5"}),e.jsx("span",{children:"Approvals are processed by your supervisor and the HR department."})]})]})]})})]})})};export{O as default};

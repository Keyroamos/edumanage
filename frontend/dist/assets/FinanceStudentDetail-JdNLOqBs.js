import{k as E,u as T,r as d,e as h,j as e}from"./vendor-Cr6tcs86.js";import{B as u}from"./index-BuYpWGYq.js";import{p as A,v as P,$ as f,m as z,s as M,t as I,w as $,a2 as F,W as g,C as D,F as j}from"./ui-BBn2VFCU.js";const Y=()=>{const{id:o}=E(),c=T(),[x,N]=d.useState(null),[k,v]=d.useState(!0),[w,i]=d.useState(!1),[a,l]=d.useState({type:"PAYMENT",amount:"",description:"",payment_method:"CASH",reference:""}),[m,b]=d.useState(!1);d.useEffect(()=>{p()},[o]);const p=async()=>{try{const t=await h.get(`/api/finance/students/${o}/`);N(t.data)}catch(t){console.error("Error fetching ledger",t)}finally{v(!1)}},y=async t=>{t.preventDefault(),b(!0);try{await h.post(`/api/finance/students/${o}/`,a),i(!1),l({type:"PAYMENT",amount:"",description:"",payment_method:"CASH",reference:""}),p()}catch{alert("Failed to record transaction")}finally{b(!1)}};if(k)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600"})});if(!x)return e.jsx("div",{className:"p-12 text-center text-slate-500 text-lg",children:"Student account not found."});const{student:r,transactions:n}=x,S=r.total_billed||0,C=r.total_paid||0,s=r.balance||0;return n.length>0&&n[0],e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-8 animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>c("/finance-portal/accounts"),className:"p-2 -ml-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-500 transition-colors",children:e.jsx(A,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Student Ledger"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"Financial history and billing management"})]}),e.jsxs("div",{className:"ml-auto flex gap-3",children:[e.jsxs(u,{variant:"outline",className:"gap-2 hidden md:flex",children:[e.jsx(P,{size:18})," Export Statement"]}),e.jsxs(u,{onClick:()=>i(!0),className:"gap-2 bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg shadow-emerald-600/20",children:[e.jsx(f,{size:18})," New Transaction"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-slate-100 dark:border-slate-700 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-24 bg-gradient-to-r from-emerald-600 to-teal-500 opacity-10"}),e.jsxs("div",{className:"relative flex flex-col items-center text-center",children:[e.jsx("div",{className:"h-28 w-28 rounded-full p-1 bg-white dark:bg-slate-800 shadow-md mb-4 ring-2 ring-emerald-100 dark:ring-emerald-900/30",children:e.jsx("div",{className:"h-full w-full rounded-full overflow-hidden bg-slate-100 dark:bg-slate-700",children:r.avatar?e.jsx("img",{src:r.avatar,alt:r.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full w-full text-slate-400",children:e.jsx(z,{size:48})})})}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-1",children:r.name}),e.jsx("p",{className:"text-sm font-medium text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-3 py-1 rounded-full border border-emerald-100 dark:border-emerald-800/50",children:r.admission_number}),e.jsxs("div",{className:"mt-6 w-full grid grid-cols-2 gap-4 border-t border-slate-100 dark:border-slate-700 pt-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wider font-semibold",children:"Grade"}),e.jsx("p",{className:"text-slate-900 dark:text-white font-medium",children:r.grade||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wider font-semibold",children:"Status"}),e.jsx("p",{className:"text-slate-900 dark:text-white font-medium",children:"Active"})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-slate-100 dark:border-slate-700",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-6",children:"Financial Overview"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`p-5 rounded-xl border ${s>0?"bg-amber-50 dark:bg-amber-900/10 border-amber-100 dark:border-amber-800/30":s<0?"bg-emerald-50 dark:bg-emerald-900/10 border-emerald-100 dark:border-emerald-800/30":"bg-slate-50 dark:bg-slate-800 border-slate-100 dark:border-slate-700"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("p",{className:`text-xs font-bold uppercase tracking-wide ${s>0?"text-amber-600 dark:text-amber-400":s<0?"text-emerald-600 dark:text-emerald-400":"text-slate-500"}`,children:"Current Balance"}),s>0?e.jsx(M,{size:16,className:"text-amber-500"}):s<0?e.jsx(I,{size:16,className:"text-emerald-500"}):e.jsx($,{size:16,className:"text-slate-400"})]}),e.jsxs("div",{className:`text-3xl font-extrabold ${s>0?"text-amber-700 dark:text-amber-400":s<0?"text-emerald-700 dark:text-emerald-400":"text-slate-700 dark:text-slate-300"}`,children:[s>0?"":s<0?"+":"",Math.abs(s).toLocaleString()," KES"]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:s>0?"Student owes this amount":s<0?"Student has excess credit":"Account is fully settled"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-slate-500",children:[e.jsx(F,{size:14}),e.jsx("span",{className:"text-xs font-semibold uppercase",children:"Total Billed"})]}),e.jsx("p",{className:"text-lg font-bold text-slate-800 dark:text-white",children:S.toLocaleString()})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-slate-500",children:[e.jsx(g,{size:14}),e.jsx("span",{className:"text-xs font-semibold uppercase",children:"Total Paid"})]}),e.jsx("p",{className:"text-lg font-bold text-emerald-600 dark:text-emerald-400",children:C.toLocaleString()})]})]})]})]})]}),e.jsx("div",{className:"lg:col-span-2 space-y-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 flex flex-col h-full",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(D,{size:18,className:"text-emerald-500"}),"Transaction History"]}),e.jsxs("span",{className:"text-xs font-medium text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-md",children:[n.length," records"]})]}),e.jsx("div",{className:"overflow-x-auto flex-1",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 border-b border-slate-100 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider",children:"Reference"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right",children:"Amount"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[n.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors group cursor-pointer",onClick:()=>c(`/finance-portal/transactions/${t.id}`),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500 font-medium",children:t.date}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-slate-900 dark:text-white",children:t.description}),e.jsxs("span",{className:"text-xs text-slate-400 hidden group-hover:inline-block transition-opacity",children:["Created via ",t.method]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-xs font-mono text-slate-500",children:t.reference||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold ${t.type==="INVOICE"?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400 border border-blue-100 dark:border-blue-800":"bg-emerald-50 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-400 border border-emerald-100 dark:border-emerald-800"}`,children:t.type==="INVOICE"?"BILLING":"PAYMENT"})}),e.jsxs("td",{className:`px-6 py-4 whitespace-nowrap text-right font-mono font-bold text-sm ${t.type==="INVOICE"?"text-slate-800 dark:text-slate-200":"text-emerald-600 dark:text-emerald-400"}`,children:[t.type==="PAYMENT"?"-":"",t.amount.toLocaleString()]})]},t.id)),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400 space-y-2",children:[e.jsx(j,{size:48,className:"opacity-20"}),e.jsx("p",{className:"font-medium",children:"No transactions found"}),e.jsx("p",{className:"text-xs",children:"Record a payment or invoice to get started"})]})})})]})]})})]})})]}),w&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-lg shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-700 transform transition-all scale-100",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Record Transaction"}),e.jsx("button",{onClick:()=>i(!1),className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(f,{size:24,className:"rotate-45"})})]}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Transaction Type"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>l({...a,type:"PAYMENT",description:""}),className:`flex items-center justify-center gap-2 p-3 rounded-xl text-sm font-bold border-2 transition-all ${a.type==="PAYMENT"?"bg-emerald-50 border-emerald-500 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-400":"border-slate-100 dark:border-slate-800 text-slate-500 hover:border-slate-300 dark:hover:border-slate-700"}`,children:[e.jsx(g,{size:18})," Receive Payment"]}),e.jsxs("button",{type:"button",onClick:()=>l({...a,type:"INVOICE",description:""}),className:`flex items-center justify-center gap-2 p-3 rounded-xl text-sm font-bold border-2 transition-all ${a.type==="INVOICE"?"bg-blue-50 border-blue-500 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400":"border-slate-100 dark:border-slate-800 text-slate-500 hover:border-slate-300 dark:hover:border-slate-700"}`,children:[e.jsx(j,{size:18})," Bill Student"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Amount (KES)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-bold",children:"Ksh"}),e.jsx("input",{type:"number",required:!0,className:"w-full pl-12 pr-4 py-3 border border-slate-300 dark:border-slate-700 rounded-xl dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-emerald-500 outline-none font-mono font-medium text-lg",value:a.amount,onChange:t=>l({...a,amount:t.target.value}),placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Description (Optional)"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-slate-300 dark:border-slate-700 rounded-xl dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-emerald-500 outline-none",value:a.description,onChange:t=>l({...a,description:t.target.value}),placeholder:a.type==="PAYMENT"?"e.g. Term 1 Fees":"e.g. Library Fine"})]}),a.type==="PAYMENT"&&e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl space-y-4 border border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Payment Method"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["CASH","MPESA","BANK"].map(t=>e.jsx("button",{type:"button",onClick:()=>l({...a,payment_method:t}),className:`px-2 py-2 text-xs font-bold rounded-lg border ${a.payment_method===t?"bg-slate-800 text-white border-slate-800 dark:bg-white dark:text-slate-900 dark:border-white":"bg-white text-slate-600 border-slate-200 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700"}`,children:t},t))})]}),a.payment_method!=="CASH"&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Reference Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,className:"w-full p-3 border border-slate-300 dark:border-slate-700 rounded-xl dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-emerald-500 outline-none font-mono text-sm uppercase",value:a.reference,onChange:t=>l({...a,reference:t.target.value}),placeholder:a.payment_method==="MPESA"?"QDF23...":"Ref No."})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"flex-1 px-4 py-3 text-slate-600 hover:bg-slate-100 border border-slate-200 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800 rounded-xl font-medium transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m,className:"flex-1 px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold shadow-lg shadow-emerald-500/20 transition-all disabled:opacity-70 disabled:cursor-not-allowed",children:m?"Processing...":"Confirm Transaction"})]})]})]})})]})};export{Y as default};

# --- EDU-MANAGE ULTRA-STABLE CPANEL CONFIG ---
# This file optimizes static file serving to prevent "Max Children" errors.

<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # 1. SERVE MEDIA FILES DIRECTLY (Images, Logos, Uploads)
    RewriteRule ^media/(.*)$ media/$1 [L]
    
    # 2. SERVE STATIC FILES DIRECTLY (CSS, JS, Assets)
    RewriteRule ^static/(.*)$ static/$1 [L]

    # 3. OPTIMIZATION: BYPASS PYTHON FOR PHYSICAL FILES
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^(.*)$ - [L]

    # 4. DJANGO ROUTING (Everything else goes to Python)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^(.*)$ passenger_wsgi.py/$1 [QSA,L]
</IfModule>

# PREVENT CACHING OF ENTRY POINT
# This ensures the browser always sees the new JS file hashes after an update.
<FilesMatch "\.(html|webmanifest)$">
    FileETag None
    <IfModule mod_headers.c>
        Header set Cache-Control "max-age=0, no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "Wed, 11 Jan 1984 05:00:00 GMT"
    </IfModule>
</FilesMatch>

# CACHE STATIC ASSETS AGGRESSIVELY (Versioning is handled by Vite hashes)
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 year"
</IfModule>

FileETag MTime Size
